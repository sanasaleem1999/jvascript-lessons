/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2014 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/

/*************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2014 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and may be covered by U.S. and Foreign Patents,
* patents in process, and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/

/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2013 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/

/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/

/*************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 201 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and may be covered by U.S. and Foreign Patents,
* patents in process, and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/

define("pdmplugins/send-for-sign/js/ac-send-for-sign",["plugins-common/ac-plugins"],function(e){var i=e.SendForSign;return i||(i=e.SendForSign={}),i.PLUGIN_ID||(i.PLUGIN_ID="send_for_sign"),i}),define("pdmplugins/esign/js/ac-esign",["plugins-common/ac-plugins"],function(e){var i=e.EchoSign;return i||(i=e.EchoSign={}),i}),define("pdmplugins/esign/js/models/es-limits-model",["pdmplugins/esign/js/ac-esign","aicx/ac-aicx","aicx/models/aicx-model"],function(e,i){return e.EchoSignLimitsModel=i.AicxModel.extend({url:function(){return i.baseAicUrisModel.get("api")+"users/me/limits/esign"}}),e.EchoSignLimitsModel}),define("pdmplugins/esign/js/models/model-factory",["core/ac-core","pdmplugins/esign/js/ac-esign","core/models/model","pdmplugins/esign/js/models/es-limits-model"],function(e,i){return i.ModelFactory=e.Model.extend({create:function(e,t,s){var n=i[e];return n?new n(t,s):void LOG(0,"AcEchoSign.ModelFactory.create: Unrecognized class: "+e)}}),i.ModelFactory}),define("pdmplugins/esign/js/models/ui/es-auth-ui-model",["core/ac-core","pdmplugins/esign/js/ac-esign","core/models/ui/ui-model"],function(e,i){return i.EchoSignAuthUiModel=e.UiModel.extend({recognized:{access_token:{type:"string",optional:!0},expiration_time:{type:"number",optional:!0},expiration_check_time:{type:"number",optional:!0},auth_status:{type:"string",optional:!0},api_access_point:{type:"string",optional:!0},web_access_point:{type:"string",optional:!0}},defaults:{expiration_check_time:12e4,expiration_time:0,auth_status:"",access_token:"",api_access_point:"",web_access_point:""},clearLastAuthState:function(){this.set("auth_status","",{silent:!0})},resetToDefaults:function(){this.set(this.defaults,{silent:!0})}}),i.EchoSignAuthUiModel}),define("pdmplugins/esign/js/models/ui/es-doc-upload-progress-ui-model",["core/ac-core","pdmplugins/esign/js/ac-esign","core/models/ui/ui-model"],function(e,i){return i.ESDocUploadProgressUiModel=e.UiModel.extend({recognized:{upload_response:{type:"object",optional:!0},progress_status:{type:"string",optional:!0},progress_obj:{type:"object",optional:!0},bytes_uploaded:{type:"number",optional:!0},bytes_total:{type:"number",optional:!0}},defaults:{upload_response:void 0,progress_status:"",progress_obj:void 0,bytes_uploaded:0,bytes_total:0}}),i.ESDocUploadProgressUiModel}),define("pdmplugins/esign/js/models/ui/es-offline-ui-model",["core/ac-core","pdmplugins/esign/js/ac-esign","core/models/ui/ui-model"],function(e,i){return i.EchoSignOfflineUiModel=e.UiModel.extend({recognized:{is_visible:{type:"boolean",optional:!0},user_action:{type:"string",optional:!0}},defaults:{is_visible:!1,user_action:""},resetToDefaults:function(){this.set(this.defaults,{silent:!0})}}),i.EchoSignOfflineUiModel}),define("pdmplugins/esign/js/models/ui/ui-model-factory",["core/ac-core","pdmplugins/esign/js/ac-esign","core/models/model","pdmplugins/esign/js/models/ui/es-auth-ui-model","pdmplugins/esign/js/models/ui/es-doc-upload-progress-ui-model","pdmplugins/esign/js/models/ui/es-offline-ui-model"],function(e,i){return i.UiModelFactory=e.Model.extend({create:function(e,t,s){var n=i[e];return n?new n(t,s):void LOG(0,"AcEchoSign.UiModelFactory.create: Unrecognized class: "+e)}}),i.UiModelFactory}),define("pdmplugins/esign/js/ops/fetch-existing-es-auth-session-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.FetchExistingESAuthSessionOp=i.Op.extend({run:function(){var e=(this.options,$.Deferred());return this.options.appApi.rnaApi.done(_.bind(function(i){i.esApi.invokeMethod({methodName:"fetchESAuthSession"}).then(function(i){e.resolve(i)},function(){e.reject()})},this)),e}}),e.FetchExistingESAuthSessionOp}),define("pdmplugins/esign/js/ops/creating-new-es-auth-session-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){var t="";return t+="{",t+='"ims_client_id":"<%= imsClientId %>",',t+='"ims_access_token":"<%= imsAccessToken %>",',t+='"es_client_id":"<%= esClientId %>",',t+='"es_client_secret":"<%= esClientSecret %>"',t+="}",e.CreatingNewESAuthSessionOp=i.Op.extend({run:function(){var e=this.options,i=$.Deferred();return e.appApi.rnaApi.done(_.bind(function(t){e.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){this.createNewSession(t,i)},this),_.bind(function(e){e&&"NoAccessToPdfServices"===e.errorString?this.createNewSession(t,i):i.reject()},this))},this)),i},createNewSession:function(e,i){var s,n,o,r,a,l,p,d,c,h=this.options;return n=e.esApi.getEchoSignServiceParams(),o=n.baseURL,r=n.esClientId,a=n.esClientSecret,l=h.appApi.options.sessionUiModel.get("primary_token"),p=n.imsClientId,_.isEmpty(o)||_.isEmpty(r)||_.isEmpty(a)||_.isEmpty(l)||_.isEmpty(p)?void i.reject():(s=o+"/oauth/exchange/access_token",d=_.template(t,{imsAccessToken:l,imsClientId:p,esClientId:r,esClientSecret:a}),c={Accept:"application/json"},void $.ajax({url:s,modal:!1,global:!1,data:d,headers:c,contentType:"application/json",type:"POST",dataType:"json",success:function(e){i.resolve(e)},error:function(){i.reject()}}))}}),e.CreatingNewESAuthSessionOp}),define("pdmplugins/esign/js/ops/storing-es-auth-session-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.StoringESAuthSessionOp=i.Op.extend({run:function(){var e=this.options,i=$.Deferred(),t=e.esAuthUiModel.get("access_token"),s=e.esAuthUiModel.get("expiration_time"),n=e.esAuthUiModel.get("refresh_token"),o=e.esAuthUiModel.get("api_access_point"),r=e.esAuthUiModel.get("web_access_point");return this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.setEchoSignApiURL(o),e.esApi.setEchoSignWebURL(r),e.esApi.invokeMethod({methodName:"storeESAuthSession",methodArgs:[n,t,s.toString(),o,r]}).then(function(){i.resolve()},function(){i.reject()})},this)),i}}),e.StoringESAuthSessionOp}),define("pdmplugins/esign/js/ops/upload-document-to-echosign-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.UploadDocumentToEchoSignOp=i.Op.extend({UPLOAD_STATES:{STARTED:0,FINISHED:1,QUEUED:2},run:function(){var e=this.options,i=$.Deferred();if(_.isEmpty(e.docToUpload)||_.isEmpty(e.esAccessToken)||_.isEmpty(e.esUploadEndpoint)||_.isEmpty(e.mimeType))return this._getRejectedPromise();var t={file:e.docToUpload._proxy,accessToken:e.esAccessToken,uploadEndpoint:e.esUploadEndpoint,mimeType:e.mimeType};return this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.invokeMethod({methodName:"uploadDocument",methodArgs:t}).then(function(e){i.resolve(e)},function(e){i.reject(e)})},this)),i}}),e.UploadDocumentToEchoSignOp}),define("pdmplugins/esign/js/ops/listening-for-es-doc-upload-progress-events-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){var t=e.UploadDocumentToEchoSignOp.prototype.UPLOAD_STATES;return e.ListeningForESDocUploadProgressEventsOp=i.Op.extend({run:function(){var e=this.options,i=e.esDocUploadProgressUiModel,s=i.get("upload_response"),n=i.get("progress_obj");return n?(n._addEventListener("custom:uploadProgress",function(e,n){n.params?(s.status=t.RUNNING,i.set("bytes_uploaded",n.params.bytesWritten),i.set("bytes_total",n.params.bytesTotal),i.set("progress_status","ongoing")):(s.errorSet=!0,s.status=t.FINISHED,i.set("progress_status","finished"))}),n._addEventListener("custom:uploadFinished",function(e,n){n.params?_.isUndefined(n.params.errorCode)||0===n.params.errorCode?(s.respStatusCode=n.params.httpRespCode,_.isEmpty(n.params.respBody)||201!==s.respStatusCode||(s.respBody=JSON.parse(n.params.respBody))):(s.errorSet=!0,s.errorCode=n.params.errorCode,s.respBody=n.params.respBody,s.respStatusCode=n.params.httpRespCode):s.errorSet=!0,s.status=t.FINISHED,i.set("progress_status","finished")}),this._getResolvedPromise()):(s.errorSet=!0,s.status=t.FINISHED,void i.set("progress_status","finished"))}}),e.ListeningForESDocUploadProgressEventsOp}),define("pdmplugins/esign/js/ops/fetch-es-user-subscription-info-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.FetchESUserSubscriptionInfoOp=i.Op.extend({run:function(){var e=(this.options,$.Deferred());return this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){this.fetchESUserSubscriptionInfo(e)},this),_.bind(function(i){i&&"NoAccessToPdfServices"===i.errorString?this.fetchESUserSubscriptionInfo(e):e.reject(!1)},this)),e},fetchESUserSubscriptionInfo:function(i){var t,s,n,o=this.options,r=e.opFactory,a=o.esLimitsModel,l=["pro","global","enterprise","team"];s=r.create("GettingESLimitsOp",o),s.run().then(function(){n=a.get("esign_access").toLowerCase(),t=$.inArray(n,l)>-1,i.resolve(t)},function(){i.reject()})}}),e.FetchESUserSubscriptionInfoOp}),define("pdmplugins/esign/js/ops/refreshing-es-auth-session-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.RefreshingESAuthSessionOp=i.Op.extend({run:function(){var e,i,t,s,n,o,r,a=this.options,l=$.Deferred(),p=a.es_refresh_token;return a.appApi.rnaApi.done(_.bind(function(a){return i=a.esApi.getEchoSignServiceParams(),t=i.apiURL,s=i.esClientId,n=i.esClientSecret,_.isEmpty(t)||_.isEmpty(s)||_.isEmpty(n)||_.isEmpty(p)?void l.reject():(e=t+"/oauth/refresh",o={grant_type:"refresh_token",refresh_token:p,client_id:s,client_secret:n},r={Accept:"application/json"},void $.ajax({url:e,modal:!1,data:o,headers:r,contentType:"application/x-www-form-urlencoded",type:"POST",dataType:"json",success:_.bind(function(e){l.resolve(e)},this),error:_.bind(function(){l.reject()},this)}))},this)),l}}),e.RefreshingESAuthSessionOp}),define("pdmplugins/esign/js/ops/getting-es-limits-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.GettingESLimitsOp=i.Op.extend({run:function(){return this.options.esLimitsModel.fetch({modal:!1,global:!1})}}),e.GettingESLimitsOp}),define("pdmplugins/esign/js/api/es-auth-api",["core/ac-core","pdmplugins/esign/js/ac-esign","core/apis/api"],function(e,i){return i.EchoSignAuthApi=e.Api.extend({initialize:function(){e.Api.prototype.initialize.call(this),this._authSessionClients=[],this._initStateMachine(),this._initializeOperationMap()},createAuthSession:function(e){var i=_.extend({},e),t=$.Deferred(),s={promise:t};return this._authSessionClients.push(s),this._fsm.handleEvent("CreateESAuthSession",i),t},clearESAuthSession:function(){this._fsm.handleEvent("ClearESAuthSession",_.extend({},this.options))},evaluateAuthStatus:function(e){var i=_.extend({},e),t=$.Deferred(),s={promise:t};return this._authSessionClients.push(s),this._fsm.handleEvent("CheckESAuthStatus",i),t},isLoggedIn:function(){var e=this.options.esAuthUiModel,i=e.get("access_token"),t=e.get("expiration_time");return this._isESAccessTokenValid(i,t)},handleSessionSignOut:function(){this._fsm.handleEvent("IMSUserLoggedOut",_.extend({},this.options))},handleSessionSignedIn:function(){this._fsm.handleEvent("IMSUserLoggedIn",_.extend({},this.options))},handleNetworkDisconnectedEvent:function(){this._fsm.handleEvent("NetworkDisconnectedEvent",_.extend({},this.options))},_initStateMachine:function(){var e=_.extend({controller:this},this.options);this._fsm=i.fsmFactory.create("EchoSignAuthFSM",e)},_initializeOperationMap:function(){this._opMap=this._opMap||{},this._opMap.FetchESAuthSessionOp=this._fetchESAuthSession,this._opMap.CreateNewESAuthSessionOp=this._createNewESAuthSession,this._opMap.ConvertExpiryTimeToAbsoluteTimeOp=this._convertExpiryTimeToAbsoluteTime,this._opMap.CheckESAuthSessionNeedsRefreshOp=this._checkESAuthSessionNeedsRefresh,this._opMap.RefreshESAuthSessionOp=this._refreshESAuthSession,this._opMap.StoreESAuthSessionOp=this._storeESAuthSession,this._opMap.MarkESAuthSessionInProgressOp=this._markESAuthSessionInProgress,this._opMap.MarkESUserAuthenticatedOp=this._markESUserAuthenticated,this._opMap.MarkESUserNotAuthenticatedOp=this._markESUserNotAuthenticated,this._opMap.NotifyESAuthSuccessToClientsOp=this._notifyESAuthSuccessToClients,this._opMap.NotifyESAuthFailureToClientsOp=this._notifyESAuthFailureToClients,this._opMap.ClearESAuthSessionOp=this._clearESAuthSession},_invokeOperation:function(e){var i=e.opName;if(this._opMap){var t=this._opMap[i];t.call(this,e)}},_fetchESAuthSession:function(e){i.opFactory.create("FetchExistingESAuthSessionOp",this.options).run().then(_.bind(function(i){this.options.appApi.rnaApi.done(_.bind(function(t){e.es_access_token=i.accessToken,e.es_refresh_token=i.refreshToken,e.es_token_expiry_time=i.expiryTime,e.es_api_access_point=t.esApi.getEchoSignApiURL(),e.es_web_access_point=t.esApi.getEchoSignWebURL(),_.isEmpty(e.es_access_token)?this._fsm.handleEvent("ESAuthSessionDoesNotExists",e):this._fsm.handleEvent("ESAuthSessionExists",e)},this))},this),_.bind(function(){this._fsm.handleEvent("ESAuthSessionDoesNotExists",e)},this))},_createNewESAuthSession:function(e){i.opFactory.create("CreatingNewESAuthSessionOp",this.options).run().then(_.bind(function(i){e.es_access_token=i.access_token,e.es_refresh_token=i.refresh_token,e.es_token_expiry_time=i.expires_in,e.es_token_type=i.token_type,e.es_api_access_point=i.api_access_point,e.es_web_access_point=i.web_access_point,e.es_error_code=i.error_code,e.es_error_msg=i.error_msg,this._fsm.handleEvent("ESAuthSessionCreateSuccess",e)},this),_.bind(function(){this._fsm.handleEvent("ESAuthSessionCreateFailure",e)},this))},_convertExpiryTimeToAbsoluteTime:function(e){var i=e.es_token_expiry_time,t=new Date;t.setTime(t.getTime()+1e3*i),e.es_token_expiry_time=t.getTime()},_checkESAuthSessionNeedsRefresh:function(e){var i=e.es_token_expiry_time;this._shouldRefreshESAccessToken(i)?this._fsm.handleEvent("ESAuthSessionNeedsRefresh",e):this._fsm.handleEvent("ESAuthSessionNeedsNoRefresh",e)},_refreshESAuthSession:function(e){var t=_.extend({},this.options,{es_refresh_token:e.es_refresh_token});i.opFactory.create("RefreshingESAuthSessionOp",t).run().then(_.bind(function(i){e.es_access_token=i.access_token,e.es_token_expiry_time=i.expires_in,e.es_token_type=i.token_type,this._fsm.handleEvent("ESAuthSessionRefreshSuccess",e)},this),_.bind(function(){this._fsm.handleEvent("ESAuthSessionRefreshFailure",e)},this))},_storeESAuthSession:function(){i.opFactory.create("StoringESAuthSessionOp",this.options).run()},_markESAuthSessionInProgress:function(){var e=this.options.esAuthUiModel;e.clearLastAuthState(),e.set("auth_status","in_progress")},_markESUserAuthenticated:function(e){var i=this.options.esAuthUiModel;i.clearLastAuthState(),i.set("access_token",e.es_access_token),i.set("expiration_time",e.es_token_expiry_time),i.set("refresh_token",e.es_refresh_token),i.set("api_access_point",e.es_api_access_point),i.set("web_access_point",e.es_web_access_point),i.set("auth_status","success")},_markESUserNotAuthenticated:function(){var e=this.options.esAuthUiModel;e.clearLastAuthState(),e.set("access_token",""),e.set("expiration_time",Number.NaN),e.set("auth_status","failure")},_notifyESAuthSuccessToClients:function(){_.each(this._authSessionClients,function(e){e.promise.resolve()})},_notifyESAuthFailureToClients:function(){_.each(this._authSessionClients,function(e){e.promise.reject()})},_clearESAuthSession:function(){this.options.esAuthUiModel.resetToDefaults(),this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.invokeMethod({methodName:"clearESAuthSession"})},this))},_isESAccessTokenValid:function(e,i){return _.isEmpty(e)?!1:this._getTimeDiffInESAccessTokenAndCurrentTime(i)>0},_shouldRefreshESAccessToken:function(e){var i=this._getTimeDiffInESAccessTokenAndCurrentTime(e);if(i>0){var t=this.options.esAuthUiModel,s=t.get("expiration_check_time");i-=s}return 0>=i},_getTimeDiffInESAccessTokenAndCurrentTime:function(e){var i=0,t=new Date;return 0>=e?i:i=e-t.getTime()}}),i.EchoSignAuthApi}),define("pdmplugins/esign/js/api/es-api",["core/ac-core","pdmplugins/esign/js/ac-esign","core/apis/api","pdmplugins/esign/js/api/es-auth-api"],function(e,i){return i.EchoSignApi=e.Api.extend({initialize:function(){var t=this.options;e.Api.prototype.initialize.call(this),this.authApi=new i.EchoSignAuthApi(t)}}),i.EchoSignApi}),define("pdmplugins/esign/js/ops/initializing-op",["pdmplugins/esign/js/ac-esign","core/ac-core","pdmplugins/esign/js/api/es-api","core/ops/op"],function(e,i){return e.InitializingOp=i.Op.extend({run:function(){var i=this.options,t=e.modelFactory,s=e.uiModelFactory;_.extend(i,{esLimitsModel:t.create("EchoSignLimitsModel"),esAuthUiModel:s.create("EchoSignAuthUiModel"),esOfflineUiModel:s.create("EchoSignOfflineUiModel")}),e.esApi=new e.EchoSignApi(i)}}),e.InitializingOp}),define("pdmplugins/esign/js/ops/logout-es-web-session-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.LogOutESWebSessionOp=i.Op.extend({run:function(){var e,i,t,s=$.Deferred();return this.options.appApi.rnaApi.done(_.bind(function(n){return e=n.esApi.getEchoSignServiceParams(),i=e.webURL,console.log(i),_.isEmpty(i)?void s.reject():(t=i+"/public/logout",$("body").append("<div><iframe class='es-logout-frame' src='"+t+"'></iframe></div>"),void $(".es-logout-frame").load(_.bind(function(){n.esApi.invokeMethod({methodName:"unloadESLogoutWebFrame"})},this)))},this)),s}}),e.LogOutESWebSessionOp}),define("pdmplugins/esign/js/ops/cancel-upload-to-echosign-op",["pdmplugins/esign/js/ac-esign","core/ac-core","core/ops/op"],function(e,i){return e.CancelUploadToEchoSignOp=i.Op.extend({run:function(){var e=$.Deferred();return this.options.appApi.rnaApi.done(_.bind(function(i){i.esApi.invokeMethod({methodName:"cancelAllUploadWorkflows"}).then(function(){e.resolve()},function(){e.reject()})},this)),e}}),e.CancelUploadToEchoSignOp}),define("pdmplugins/esign/js/ops/op-factory",["core/ac-core","pdmplugins/esign/js/ac-esign","pdmplugins/esign/js/ops/fetch-existing-es-auth-session-op","pdmplugins/esign/js/ops/creating-new-es-auth-session-op","pdmplugins/esign/js/ops/storing-es-auth-session-op","pdmplugins/esign/js/ops/upload-document-to-echosign-op","pdmplugins/esign/js/ops/listening-for-es-doc-upload-progress-events-op","pdmplugins/esign/js/ops/fetch-es-user-subscription-info-op","pdmplugins/esign/js/ops/refreshing-es-auth-session-op","pdmplugins/esign/js/ops/getting-es-limits-op","pdmplugins/esign/js/ops/initializing-op","pdmplugins/esign/js/ops/logout-es-web-session-op","pdmplugins/esign/js/ops/cancel-upload-to-echosign-op"],function(e,i){return i.OpFactory=e.Op.extend({create:function(e,t){var s=i[e];return s?new s(t):void LOG(0,"AcEchoSign.OpFactory.create: Unrecognized class: "+e)}}),i.OpFactory}),define("pdmplugins/esign/js/fsm/fsm",["core/ac-core"],function(e){return e.FSM=Backbone.View.extend({SPECIAL_FSM_STATE:"*",initialize:function(){Backbone.View.prototype.initialize.call(this),this.cid=_.uniqueId("op"),delete this.options.viewId,delete this.$el,delete this.el,_.bindAll(this),this._stateEventTransitionTable=[],this._supportedStates=[],this._currentState=void 0,this._previousState=void 0,this._initFSM()},handleEvent:function(e,i){var t=this._getCurrentState(),s=!1;if(this._isSupportedState(t)){var n=this._getEventHandlerForState(t,e);return n?(n=_.bind(n,this),s=n(i)):s}},_initFSM:function(){},_getController:function(){return this.options.controller},_getSupportedStates:function(){return this._supportedStates},_setSupportedStates:function(e){this._supportedStates=e},_isSupportedState:function(e){var i=this._getSupportedStates(),t=_.contains(i,e);return t},_setPreviousState:function(e){this._previousState=e},_getPreviousState:function(){return this._previousState},_getCurrentState:function(){return this._currentState},_setCurrentState:function(e){this._isSupportedState(e)&&(this._setPreviousState(this._currentState),this._currentState=e)},_defineTransition:function(e,i,t){var s={state:e,eventName:i,eventHandler:t};this._stateEventTransitionTable.push(s)},_getEventHandlerForState:function(e,i){var t=_.find(this._stateEventTransitionTable,_.bind(function(t){return t.state===e&&t.eventName===i},this));return _.isEmpty(t)&&(t=_.find(this._stateEventTransitionTable,_.bind(function(e){return e.state===this.SPECIAL_FSM_STATE&&e.eventName===i},this))),t?t.eventHandler:void 0},_invokeController:function(e,i){i=i||{};var t=this._getController();if(t){var s=_.extend(i,{opName:e});t._invokeOperation(s)}}}),e.FSM}),define("pdmplugins/esign/js/fsm/es-auth-fsm",["core/ac-core","pdmplugins/esign/js/fsm/fsm","pdmplugins/esign/js/ac-esign"],function(e,i,t){var s={IDLE:0,FETCHING_EXISTING_ES_AUTH_SESSION_STATUS:1,WAITING_FOR_NEW_ES_AUTH_SESSION_TO_CREATE:2,CHECKING_ES_AUTH_SESSION_NEED_TO_REFRESH:3,WAITING_FOR_ES_AUTH_SESSION_TO_REFRESH:4};return t.EchoSignAuthFSM=i.extend({_initFSM:function(){this._setSupportedStates(_.values(s)),this._setCurrentState(s.IDLE),this._defineEventTransitions()},_defineEventTransitions:function(){this._defineTransition(s.IDLE,"CreateESAuthSession",function(e){e.creatingESAuthSession=!0,this._setCurrentState(s.FETCHING_EXISTING_ES_AUTH_SESSION_STATUS),this._invokeController("FetchESAuthSessionOp",e)}),this._defineTransition(s.IDLE,"CheckESAuthStatus",function(e){e.checkingESAuthSession=!0,this._setCurrentState(s.FETCHING_EXISTING_ES_AUTH_SESSION_STATUS),this._invokeController("FetchESAuthSessionOp",e)}),this._defineTransition(s.FETCHING_EXISTING_ES_AUTH_SESSION_STATUS,"ESAuthSessionExists",function(e){this._setCurrentState(s.CHECKING_ES_AUTH_SESSION_NEED_TO_REFRESH),this._invokeController("CheckESAuthSessionNeedsRefreshOp",e)}),this._defineTransition(s.FETCHING_EXISTING_ES_AUTH_SESSION_STATUS,"ESAuthSessionDoesNotExists",function(e){e.creatingESAuthSession?(this._setCurrentState(s.WAITING_FOR_NEW_ES_AUTH_SESSION_TO_CREATE),this._invokeController("MarkESAuthSessionInProgressOp",e),this._invokeController("CreateNewESAuthSessionOp",e)):e.checkingESAuthSession&&(this._setCurrentState(s.IDLE),this._invokeController("MarkESUserNotAuthenticatedOp",e),this._invokeController("NotifyESAuthFailureToClientsOp",e))}),this._defineTransition(s.CHECKING_ES_AUTH_SESSION_NEED_TO_REFRESH,"ESAuthSessionNeedsRefresh",function(e){e.creatingESAuthSession?(this._setCurrentState(s.WAITING_FOR_ES_AUTH_SESSION_TO_REFRESH),this._invokeController("RefreshESAuthSessionOp",e)):e.checkingESAuthSession&&(this._setCurrentState(s.IDLE),this._invokeController("MarkESUserNotAuthenticatedOp",e),this._invokeController("NotifyESAuthFailureToClientsOp",e))}),this._defineTransition(s.CHECKING_ES_AUTH_SESSION_NEED_TO_REFRESH,"ESAuthSessionNeedsNoRefresh",function(e){this._setCurrentState(s.IDLE),this._invokeController("MarkESUserAuthenticatedOp",e),this._invokeController("NotifyESAuthSuccessToClientsOp",e)}),this._defineTransition(s.WAITING_FOR_NEW_ES_AUTH_SESSION_TO_CREATE,"ESAuthSessionCreateSuccess",function(e){this._setCurrentState(s.IDLE),this._invokeController("ConvertExpiryTimeToAbsoluteTimeOp",e),this._invokeController("MarkESUserAuthenticatedOp",e),this._invokeController("StoreESAuthSessionOp",e),this._invokeController("NotifyESAuthSuccessToClientsOp",e)}),this._defineTransition(s.WAITING_FOR_NEW_ES_AUTH_SESSION_TO_CREATE,"ESAuthSessionCreateFailure",function(e){this._setCurrentState(s.IDLE),this._invokeController("MarkESUserNotAuthenticatedOp",e),this._invokeController("NotifyESAuthFailureToClientsOp",e),this._invokeController("ClearESAuthSessionOp",e)}),this._defineTransition(s.WAITING_FOR_ES_AUTH_SESSION_TO_REFRESH,"ESAuthSessionRefreshSuccess",function(e){this._setCurrentState(s.IDLE),this._invokeController("ConvertExpiryTimeToAbsoluteTimeOp",e),this._invokeController("MarkESUserAuthenticatedOp",e),this._invokeController("StoreESAuthSessionOp",e),this._invokeController("NotifyESAuthSuccessToClientsOp",e)}),this._defineTransition(s.WAITING_FOR_ES_AUTH_SESSION_TO_REFRESH,"ESAuthSessionRefreshFailure",function(e){this._setCurrentState(s.IDLE),this._invokeController("MarkESUserNotAuthenticatedOp",e),this._invokeController("NotifyESAuthFailureToClientsOp",e),this._invokeController("ClearESAuthSessionOp",e)}),this._defineTransition(s.IDLE,"ClearESAuthSession",function(e){this._setCurrentState(s.IDLE),this._invokeController("ClearESAuthSessionOp",e)}),this._defineTransition(this.SPECIAL_FSM_STATE,"SessionSignOut",function(){this._setCurrentState(s.IDLE)}),this._defineTransition(this.SPECIAL_FSM_STATE,"NetworkDisconnectedEvent",function(){this._setCurrentState(s.IDLE)})}}),t.EchoSignAuthFSM}),define("pdmplugins/esign/js/fsm/fsm-factory",["core/ac-core","pdmplugins/esign/js/ac-esign","pdmplugins/esign/js/fsm/fsm","pdmplugins/esign/js/fsm/es-auth-fsm"],function(e,i,t){return i.FSMFactory=t.extend({create:function(e,t){var s=i[e];return s?new s(t):void LOG(0,"AcEchoSign.OpFactory.create: Unrecognized class: "+e)}}),i.FSMFactory}),define("pdmplugins/esign/js/ac-esign-init",["pdmplugins/esign/js/ac-esign","pdmplugins/esign/js/models/model-factory","pdmplugins/esign/js/models/ui/ui-model-factory","pdmplugins/esign/js/ops/op-factory","pdmplugins/esign/js/fsm/fsm-factory"],function(e){return _.extend(e,{modelFactory:new e.ModelFactory,uiModelFactory:new e.UiModelFactory,opFactory:new e.OpFactory,fsmFactory:new e.FSMFactory}),e}),define("pdmplugins/send-for-sign/js/templates/send-for-sign-content",[],function(){return'<div class="send-for-sign-container"><div class="sfs-landing-page-container"></div><div class="sfs-app-progress-container"></div><div class="sfs-send-for-sign-page-container"></div><div class="sfs-offline-view-container"></div></div>'}),define("pdmplugins/send-for-sign/js/nls/ui-strings",{root:!0,"xx-xx":!0,"ar-ae":!0,"ca-es":!0,"cs-cz":!0,"da-dk":!0,"de-de":!0,"en-ae":!0,"en-gb":!0,"en-il":!0,"es-es":!0,"eu-es":!0,"fi-fi":!0,"fr-fr":!0,"fr-ma":!0,"he-il":!0,"hr-hr":!0,"hu-hu":!0,"it-it":!0,"ja-jp":!0,"ko-kr":!0,"nb-no":!0,"nl-nl":!0,"pl-pl":!0,"pt-br":!0,"ro-ro":!0,"ru-ru":!0,"sk-sk":!0,"sl-si":!0,"sl-sl":!0,"sv-se":!0,"tr-tr":!0,"uk-ua":!0,"zh-cn":!0,"zh-tw":!0,"bg-bg":!0}),define("pdmplugins/send-for-sign/js/nls/root/ui-strings",{SEND_FOR_SIGN:"Send For Sign",LP_TITLE:"Send for Signature",LP_SUBTITLE:"Send documents for signature in a few simple steps.",LP_SELECT_FILE_BTN_LABEL:"Select Files",LP_TITLE_NEW:"Send for Signature",LP_SUBTITLE_NEW:"Get documents signed instantly. Recipients will receive a link to view and sign online. No purchase or sign-up required.",LP_SUBTITLE2_NEW:"Track progress online to know when the file is viewed and signed. ",LP_SUBTITLE3_NEW:"Learn More",LP_TO:"To",LP_ADD_CC:"Add CC",LP_MESSAGE:"Message",LP_FILES:"File(s)",LP_ACTION_BTN1_LABEL_NEW:"Next",LP_INVALID_EMAIL_ERROR:" is an invalid email address.",LP_NO_EMAIL_ERROR:"Please add at least one recipient.",LP_TO_EMAIL_PLACEHOLDER:"Enter recipient email",LP_CC_EMAIL_PLACEHOLDER:"Enter CCâ€™s emails",LP_ONLY_SENDER_EMAIL_ERROR:"You cannot send a document only to yourself to sign.",LP_NEXT_GUIDE_TEXT:"Click Next to specify where recipients need to fill and sign.",LP_SUBJECT_PLACEHOLDER:"Agreement Name",LP_MESSAGE_TEXT:"Please review and complete this document.",LP_CC_LIMITS_ERROR:"Agreements can have at most 11 CCs.",LP_RECIPIENTS_LIMITS_ERROR:"Maximum number of recipients entered.",LP_AGREEMENT_CHARLIMITS_ERROR:"The Agreement Name must be 255 characters or less.",LP_SIGNER:"Signer",LP_APPROVER:"Approver",LP_SENDER_IN_CC_ERROR:"You cannot CC the same email address that you are sending from.",LP_HELP_ICON_TEXT:"Add recipients in the order you wish the document to be signed.",LP_OUTVITES_ERROR:"Please accept the Adobe Sign invitation that we just emailed you to be able to start using Adobe Sign subscription given by your administrator.",LP_CC:"CC",LP_HIDE:"Hide",LP_LEARN_MORE_GOURL:"http://www.adobe.com/go/DCSFS",LP_DOCUMENT_LIBRARY_:"Document Library",LP_DOCUMENT_LIBRARY_TITLE:"Add File from Document Library",LP_NAME:"Name",LP_LAST_MODIFIED:"Last Modified",LP_ATTACH:"Attach",LP_SHARED_DOCUMENTS:"Shared Documents",LP_ADOBE_SIGN_DOCUMENTS:"Adobe Sign Documents",LP_RDR_ACTION_BTN1_LABEL:"Start",LP_RDR_APP_INFO_TXT_1:"Click Start to complete steps to send for signature:",LP_RDR_APP_INFO_TXT_2:"Step 1: Add recipients",LP_RDR_APP_INFO_TXT_3:"Step 2: Add fields and send",LP_ACR_ACTION_BTN1_LABEL:"Prepare Form",LP_ACR_ACTION_BTN2_LABEL:"Ready to Send",LP_ACR_ACTION_BTN_SEPARATOR:"or",LP_ACR_ACTION_BTN1_INFO:"Add fields before sending",LP_ACR_ACTION_BTN2_INFO:"Upload and add recipients",SFS_SUBSCRIBE_SIGN_IN:"Sign In",SFS_SUBSCRIBE_UPGRADE_NOW:"Upgrade",SFS_SUBSCRIBE_START_NOW:"Start Now",SFS_SUBSCRIBE_TITLE:"Send for Signature",SFS_SUBSCRIBE_MSG_CONTENT_1:"Send documents for signature in a few simple steps.",SFS_SUBSCRIBE_MSG_CONTENT_2:"Track results in real time.",SFS_SUBSCRIBE_MSG_CONTENT_3:"Create a professional customer experience",SFS_SUBSCRIBE_MSG_CONTENT_4:"Manage user preferences and settings",SFS_SUBSCRIBE_UPGRADE_NOT_SUBCRIBED:"Not Subscribed?",SFS_SUBSCRIBE_UPGRADE:"Upgrade",SFS_SUBSCRIBE_UPGRADE_ALREADY_SUBSCRIBED_EXPERIMENT:"Already Subscribed?",SFS_SUBSCRIBE_LEARN_MORE_EXPERIMENT:"Learn More",SFS_OFFLINE_ACCEPT_LABEL:"Close",GENERIC_ARIA_LABEL_STRING:"<%= prefix %>. <%= suffix %>",SFS_ADD_FILES:"Add Files",SELECTED_FILES:"Selected Files",FILE_SELECT_TITLE:"Select Files",FILE_SELECT_ACTION_BTN:"Continue",FILE_SELECT_FILTER_DESCR:"Adobe PDF files",SFS_PROGRESS_CANCEL_LABEL:"Cancel",DOC_PROGRESS_LABEL:"Uploading...",SFS_ERR_GENERIC_TITLE:"Could not Send",SFS_ERR_TITLE_FAILED_TO_SEND:'"<%= name %>" failed to send.',SFS_ERR_CLOSE_BTN:"Close",SFS_ERR_TIMEOUT_TITLE:"Timed out ",SFS_ERR_CONTENT_TIMEOUT_TITLE:"There has been no activity in the Send for Signature tool for a while.",SFS_ERR_CONTENT_TIMEOUT_BODY:"Any recent changes have been lost.",SFS_ACRO_UPDGRADE_GO_URL:"http://www.adobe.com/go/collectsigacro_12_0_0",SFS_RDR_UPGRADE_GO_URL:"http://www.adobe.com/go/collectsigrdr_12_0_0",SFS_RDR_UPGRADE_GO_URL_RDREXP:"http://www.adobe.com/go/rdr_sfs_tc_lm_dc112017",SFS_ERR_CONTENT_TITLE_UNSUPPORTED:'Unsupported file: "<%= name %>"',SFS_ERR_CONTENT_TITLE_UNSUPPORTED_N:'Unsupported files: "<%= name %>"',SFS_ERR_CONTENT_BODY_UNSUPPORTED:"Select another file and try again",SFS_ERR_GENERAL_WORKFLOW_FAILURE:"An error has occurred. Please try again.",SFS_ERR_LARGE_FILE_SIZE:"Your document exceeds the maximum size of file supported for your subscription level. Please try a different document or contact your account administrator.",SFS_ERR_ENTERPRISE_SERVICE_ACCS_DENIED:"You do not have access to this service. Please contact your IT Administrator to gain access, or try to sign in with an Adobe ID",SFS_ERR_PREPARE_FORM_MUL_FILES_SEL:"You have selected more than one file. To send multiple files for signature they must be combined into a single file.",SFS_ERR_ES_AUTO_LOGIN_DENIED:"Cannot login to the service to complete the send for signature process. Please contact support.",SFS_FILE_NOT_SENT:"File not sent",SFS_MULTIPLE_WORKFLOWS_DENIED:"Another file is being sent in a different window. Finish sending the other file then try again.",SFS_ERR_OK_BUTTON:"OK",NO:"NO",YES:"YES",SFS_COMBINE_MESSAGE_TITLE:"Files will be combined",SFS_COMBINE_MESSAGE_TEXT:"You have selected more than one file. All files will be combined into one PDF for preparing form. Do you want to continue and combine all files?",SFS_FILES_NOT_COMBINED_ERROR_TITLE:"Error",SFS_FILES_NOT_COMBINED_ERROR:"An error was encountered while combining files. Please check the selected files and try again",SEND_REMOVE:"Remove"}),define("pdmplugins/send-for-sign/js/constants/sfs-sc-constants",{TOOLS:"Tools",SEND_FOR_SIG:"SendForSig",SELECT_FILES:"SelectFiles",OPTION_DLG:"OptionDlg",SHOWN:"Shown",CLICKED:"Clicked",ADD_FILES:"AddFiles",PREPARE_FORM:"PrepareForm",READY_TO_SEND:"ReadyToSend",START:"Start",UPSELL_PAGE:"UpsellPg",SIGN_IN:"SignIn",UPGRADE:"Upgrade",CONVERSION:"Conversion",UPLOAD_STARTED:"1-Uploading",UPLOAD_COMPLETE:"2-UploadComplete",UPLOAD_ERROR:"UploadError",FETCH_SEND_PG_URL:"3-FetchingSendPageUrl",UPLOAD_CANCELLED:"UploadCancelled",OPERATION:"Op",SEND_ANOTHER:"SendAnother",MANAGE:"Manage",SUCCESS:"Success",COMBINE:"Combine",STARTED:"Started",FAILURE:"Failure",CANCELLED:"Cancelled",YES_CLICKED:"YesClicked",NO_CLICKED:"NoClicked",FILES:"Files",TO_EMAIL_COUNT:"EmailToCount",CC_EMAIL_COUNT:"EmailCCCount",FILE_COUNT:"FileCount",EMAIL_TO_ADDED:"EMailTOAdded",EMAIL_CC_ADDED:"EMailCCAdded",EMAIL_REMOVED:"EMailRemoved",MESSAGE_SUBJECT_EDITED:"MessageSubjectEdited",MESSAGE_BODY_EDITED:"MessageBodyEdited",EMAIL_TO_EDITED:"EmailToEdited",EMAIL_CC_EDITED:"EmailCCEdited",ADD_CC_CLICKED:"AddCCClicked",HIDE_CLICKED:"HideClicked",NEW_LANDING_PAGE:"SFSNewLandingPage",OLD_LANDING_PAGE:"SFSOldLandingPage",NEXT_GUIDE_SHOWN:"NextButtonGuideShown",POST_SEND_PAGE:"PostSendPage",AUTHORING_PAGE:"AuthoringPage",LOADED:"Loaded",SESSION_TIMEOUT:"SessionTimeout",ERROR:"Error",OPEN_SEND_PAGE_IN_APP:"OpenSendPageInApp",LEARN_MORE:"LearnMore"}),define("pdmplugins/send-for-sign/js/templates/sfs-app-progress-template",[],function(){return'<div class="progress-container"><div class="progress-meter-box"><div class="progress-meter"></div></div><div class="progress-label"><div class="text"><%= progressLabel %></div><div class="percentage"></div><div class="terminator"></div></div><button id="sfs-progress-cancel"  class="progress-cancel-btn button-light-blue-small"  tabindex = 0><%= cancelLabel %></button></div>'
}),define("pdmplugins/send-for-sign/js/views/sfs-app-progress-view",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/sfs-app-progress-template","i18n!pdmplugins/send-for-sign/js/nls/ui-strings"],function(e,i,t,s){return i.SFSAppProgressView=e.View.extend({initialize:function(){e.View.prototype.initialize.call(this),this._template=_.template(t)},events:function(){return{"click .progress-cancel-btn":"_onProgressCancelBtnClick"}},render:function(){e.View.prototype.render.call(this);var i,t,n=this.options.sfsAppProgressUiModel,o=n.get("is_visible");return o?(this.$el.show(),0===this.$el.children().length&&(this.$el.html(this._template({progressLabel:this._getProgressLabel(),cancelLabel:s.SFS_PROGRESS_CANCEL_LABEL})),this._initWrappers(),this._listenForWindowResizeEvents()),i=n.getTotalProgressPercentage(),i=parseInt(i,10),isNaN(i)&&(i=0),t=i.toString()+"%",this.$progressMeter.width(t),this.$progressLabelPercentage.html(t),this._adjustMarginForProgressContainer(this.$progressMeterContainer.parent().width(),this.$progressMeterContainer.parent().height()),$("#sfs-progress-cancel").focus(),this):(this.$el.hide(),this)},_initWrappers:function(){this.$progressMeterContainer=this.$(".progress-container"),this.$progressMeter=this.$(".progress-container .progress-meter-box .progress-meter"),this.$progressLabelPercentage=this.$(".progress-container .progress-label .percentage")},_onProgressCancelBtnClick:function(){this.options.sfsAppProgressUiModel.set("abort_progress",!0)},_getProgressLabel:function(){return s.DOC_PROGRESS_LABEL},_listenForWindowResizeEvents:function(){setInterval(_.bind(function(){this._handleWindowResize()},this),250)},_handleWindowResize:function(){var e=this.$progressMeterContainer.parent().width(),i=this.$progressMeterContainer.parent().height();e&&i&&(this._oldWidth!==e||this._oldHeight!==i)&&(this._oldWidth=e,this._oldHeight=i,this._adjustMarginForProgressContainer(e,i))},_adjustMarginForProgressContainer:function(e,i){var t=this.$progressMeterContainer.height();this.$progressMeterContainer.css("margin-top",(i-t)/2)}}),i.SFSAppProgressView}),define("pdmplugins/send-for-sign/js/templates/sfs-send-for-sign-page-template",[],function(){return'<iframe class="send-page-iframe" frameborder="0"        name="send-page-iframe"></iframe>'}),define("pdmplugins/send-for-sign/js/views/sfs-send-for-sign-page-view",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/sfs-send-for-sign-page-template"],function(e,i,t){return i.SFSSendForSignPageView=e.View.extend({initialize:function(){e.View.prototype.initialize.call(this),this._template=_.template(t)},render:function(){e.View.prototype.render.call(this);var i=this.options.sfsAppSendPageUiModel,s=i.get("url"),n=i.get("is_visible"),o=i.get("is_loaded");return n?this.$el.show():this.$el.hide(),0===this.$el.children().length&&(this.$el.html(_.template(t)),this._initWrappers()),_.isEmpty(s)||o||this._loadSendPageURLInInframe(s),this},_initWrappers:function(){this.$sendPageIframe=this.$(".send-page-iframe")},_loadSendPageURLInInframe:function(e){_.isEmpty(e)||(this.$sendPageIframe.attr("src",e),this._addSendPageIframeLoadListener())},_addSendPageIframeLoadListener:function(){var e=this.options.sfsAppSendPageUiModel;this.$sendPageIframe.load(_.bind(function(){e.set("is_loaded",!0)},this))}}),i.SFSSendForSignPageView}),define("pdmplugins/send-for-sign/js/templates/sfs-landing-page-template",[],function(){return'<div id="sfs-landing-page-content" class="ui-theme theme-container">    <div class="sfs-service-spacer"></div>    <div class="sfs-service-title theme-text" ><%= title %></div>    <div class="sfs-service-subtitle theme-text"><%= subtitle %></div>    <div class="sfs-selected-files-heading-container">       <div class="sfs-selected-files-heading theme-text" tabindex=-1><%= selected_files %></div>       <div class="sfs-tool-options-add-files">           <button id="sfs-add-button" class="sfs-add-files button-light-blue-small addfile theme-hyperlink theme-hoverable" tabindex= 0><%= add_files %></button>       </div>    </div>    <div class="sfs-selected-files-container">       <div class="sfs-selected-files-list ui-theme theme-border"></div>       <div class="sfs-app-info-container">           <div class="info-txt 1"></div>           <div class="info-txt 2"></div>           <div class="info-txt 3"></div>       </div>    </div>    <div class="sfs-action-btns-group">       <div class="sfs-action-btns-group-container">           <div class="sfs-file-action-btn-and-descr">               <div><input type="button" id = "sfs-file-action-btn-1" class=" control-button sfs-file-action-btn 1 site-catalyst theme-button theme-button-label" tabindex="0"/></div>               <div class="description-text 1 theme-text"></div>           </div>           <div class="sfs-action-btn-separator theme-text"></div>           <div class="sfs-file-action-btn-and-descr">               <div><input type="button" id = "sfs-file-action-btn-2" class=" control-button sfs-file-action-btn 2 site-catalyst theme-button theme-button-label" tabindex="0"/></div>               <div class="description-text 2 theme-text"></div>           </div>           <div class="sfs-action-btns-terminator"></div>       </div>    </div></div>'}),define("pdmplugins/send-for-sign/js/templates/sfs-file-name-template",[],function(){return'<div class="sfs-selected-file-item ui-theme      theme-border theme-hoverable">    <div class="collection-item-thumb <%= iconCls %>"></div>    <div class="file-name theme-text"><%= fileName %></div>    <button class="file-remove core-remove-x sfs-file-remove"     tabindex = 0 aria-label="<%= ariaRemoveLabel %>"></button></div>'}),define("pdmplugins/send-for-sign/js/views/sfs-landing-page-view",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/sfs-landing-page-template","pdmplugins/send-for-sign/js/templates/sfs-file-name-template","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","core/utils/util","core/utils/truncate","core/utils/css-util","core/utils/file-types","pdmplugins/send-for-sign/js/constants/sfs-sc-constants"],function(e,i,t,s,n,o,r,a,l,p){return i.SFSLandingPageView=e.View.extend({initialize:function(){e.View.prototype.initialize.call(this),this._template=_.template(t),this._fileNameTemplate=_.template(s),this._landingPageUiModel=this.options.sfsAppLandingPageUiModel,this._addUiModelEventListeners(),this._addKeyEventListener()},events:function(){return{"click .sfs-add-files":"_onAddFilesBtnClick","click .sfs-selected-file-item .file-remove":"_onSelectedFileItemRemoveClick","click .sfs-file-action-btn.1":"_onSFSFileActionBtn1Click","click .sfs-file-action-btn.2":"_onSFSFileActionBtn2Click"}},_addKeyEventListener:function(){this.options.appApi.keyApi.pushKeyHandler(this)},_removeKeyEventListener:function(){this.options.appApi.keyApi.popKeyHandler(this)},_onKeyDown:function(e){var i=e.keyCode,t=$(e.target),s=$.Event("click");switch(i){case 13:case 32:t.trigger(s),e.preventDefault();break;case 9:e.shiftKey&&"sfs-add-button"==$(e.target).attr("id")?(o.isAcrobat()?$("#sfs-file-action-btn-2").focus():$("#sfs-file-action-btn-1").focus(),e.preventDefault()):"sfs-file-action-btn-1"==$(e.target).attr("id")&&this.$("#sfs-file-action-btn-1").removeClass("draw-button-focus-outline")}},_addUiModelEventListeners:function(){this._landingPageUiModel.on("change:is_refreshed",this._refreshPageContent),this._landingPageUiModel.on("change:is_visible",this._onVisibilityChange)},render:function(){return e.View.prototype.render.call(this),this._landingPageUiModel.get("is_visible")?(this.$el.show(),0===this.$el.children().length&&(this.options.appApi.siteCatalystApi.logScEvent([p.SEND_FOR_SIG,p.OLD_LANDING_PAGE]),this.$el.html(this._template({title:n.LP_TITLE,subtitle:n.LP_SUBTITLE,add_files:n.SFS_ADD_FILES,selected_files:n.SELECTED_FILES})),this._initWrappers(),this._refreshPageContent()),this.$("#sfs-file-action-btn-1").addClass("draw-button-focus-outline"),this):(this.$el.hide(),this)},_initWrappers:function(){this.$fileItemsContainerElem=this.$(".sfs-selected-files-list"),this.$fileItemsHeadingElem=this.$(".sfs-selected-files-heading-container"),this.$actionBtnsGrpElem=this.$(".sfs-action-btns-group"),this.$actionBtnsContainerElem=this.$(".sfs-action-btns-group-container"),this.$actionBtn1Elem=this.$(".sfs-file-action-btn.1"),this.$actionBtn2Elem=this.$(".sfs-file-action-btn.2"),this.$actionBtn1DescrElem=this.$(".description-text.1"),this.$actionBtn2DescrElem=this.$(".description-text.2"),this.$actionBtnSeparatorElem=this.$(".sfs-action-btn-separator"),this.$appInfoContainer=this.$(".sfs-app-info-container"),this.$appInfoTxt1Elem=this.$(".sfs-app-info-container .info-txt.1"),this.$appInfoTxt2Elem=this.$(".sfs-app-info-container .info-txt.2"),this.$appInfoTxt3Elem=this.$(".sfs-app-info-container .info-txt.3")},_onVisibilityChange:function(){this.render()},_refreshPageContent:function(){this._updateFileItemsList(),this._updateActionButtonLabels(),this._updateActionButtonEnabledState(),this._updateActionButtonDescription(),this._updateAppInfoTexts(),this._adjustCSS(),this._focusOnSelectButton()},_updateActionButtonLabels:function(){this._landingPageUiModel.get("action_btn1_visible")?(this.$actionBtn1Elem.val(this._landingPageUiModel.get("action_btn1_label")),this.$actionBtn1Elem.removeClass("hidden")):this.$actionBtn1Elem.addClass("hidden"),this._landingPageUiModel.get("action_btn2_visible")?(this.$actionBtn2Elem.val(this._landingPageUiModel.get("action_btn2_label")),this.$actionBtnSeparatorElem.html(this._landingPageUiModel.get("action_btn_separator_label")),this.$actionBtn2Elem.removeClass("hidden"),this.$actionBtnSeparatorElem.removeClass("hidden")):(this.$actionBtn2Elem.addClass("hidden"),this.$actionBtnSeparatorElem.addClass("hidden"))},_updateActionButtonEnabledState:function(){this._landingPageUiModel.get("action_btn1_enabled")?this.$actionBtn1Elem.removeClass("disabled"):this.$actionBtn1Elem.addClass("disabled"),this._landingPageUiModel.get("action_btn2_enabled")?this.$actionBtn2Elem.removeClass("disabled"):this.$actionBtn2Elem.addClass("disabled")},_updateActionButtonDescription:function(){this._landingPageUiModel.get("action_btn_descr_visible")?(this.$actionBtn1DescrElem.html(this._landingPageUiModel.get("action_btn1_descr_txt")),this.$actionBtn2DescrElem.html(this._landingPageUiModel.get("action_btn2_descr_txt")),this.$actionBtn1DescrElem.removeClass("hidden"),this.$actionBtn2DescrElem.removeClass("hidden")):(this.$actionBtn1DescrElem.addClass("hidden"),this.$actionBtn2DescrElem.addClass("hidden"))},_updateAppInfoTexts:function(){this._landingPageUiModel.get("app_info_txt_visible")?(this.$appInfoTxt1Elem.html(this._landingPageUiModel.get("app_info_txt1")),this.$appInfoTxt1Elem.removeClass("hidden"),this.$appInfoTxt2Elem.html(this._landingPageUiModel.get("app_info_txt2")),this.$appInfoTxt2Elem.removeClass("hidden"),this.$appInfoTxt3Elem.html(this._landingPageUiModel.get("app_info_txt3")),this.$appInfoTxt3Elem.removeClass("hidden")):(this.$appInfoTxt1Elem.addClass("hidden"),this.$appInfoTxt2Elem.addClass("hidden"),this.$appInfoTxt3Elem.addClass("hidden"))},_getRemoveAriaLabel:function(e){return _.template(n.GENERIC_ARIA_LABEL_STRING,{prefix:e,suffix:n.SEND_REMOVE})},_updateFileItemsList:function(){var e,i,t=this._landingPageUiModel.get("selected_files"),s=this._landingPageUiModel.get("file_collection_visible");s?(this.$fileItemsContainerElem.empty(),_.each(t,_.bind(function(t){e=t.get("name"),i=$(this._fileNameTemplate({fileName:e,iconCls:l.getFileInfo("",e).iconCls,ariaRemoveLabel:this._getRemoveAriaLabel(e)})),i.data("file",t),this.$fileItemsContainerElem.append(i)},this)),this.$fileItemsContainerElem.removeClass("hidden"),this.$fileItemsHeadingElem.removeClass("hidden")):(this.$fileItemsContainerElem.addClass("hidden"),this.$fileItemsHeadingElem.addClass("hidden"))},_adjustCSS:function(){this._adjustAppsInfoContainerCSS(),this._adjustFileItemsCSS(),this._adjustActionButtonsCSS()},_focusOnSelectButton:function(){$("#sfs-file-action-btn-1").focus()},_adjustAppsInfoContainerCSS:function(){var e=this.$fileItemsContainerElem.css("margin-left");this.$appInfoContainer.css("margin-left",e)},_adjustActionButtonsCSS:function(){var e=this.$actionBtn1Elem.width()+a.getCssNum(this.$actionBtn1Elem,"padding-left")+a.getCssNum(this.$actionBtn1Elem,"padding-left"),i=this.$actionBtn2Elem.width()+a.getCssNum(this.$actionBtn2Elem,"padding-left")+a.getCssNum(this.$actionBtn2Elem,"padding-left"),t=Math.max(e,parseInt(this.$actionBtn1Elem.css("min-width"),10)),s=Math.max(i,parseInt(this.$actionBtn2Elem.css("min-width"),10));this.$actionBtn1DescrElem.width(t),this.$actionBtn2DescrElem.width(s)},_adjustFileItemsCSS:function(){this.$fileItemsContainerElem.children().each(function(){var e=$(this),i=$(".file-name",e),t=$(".collection-item-thumb",e),s=$(".file-remove",e),n=e.innerWidth()-parseInt(i.css("text-indent"),10);n-=t.position().left+t.outerWidth()+s.outerWidth(),r.truncateElementText(i,n)});var e=this._getSelectedFilesCount();e>0?this.$actionBtn1Elem.removeClass("no-file-selected"):this.$actionBtn1Elem.addClass("no-file-selected")},_getSelectedFilesCount:function(){var e=this._landingPageUiModel.get("selected_files");return _.isEmpty(e)?0:e.length},_onAddFilesBtnClick:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","browse_file")},_onSelectedFileItemRemoveClick:function(e){var i=$(e.currentTarget).parents(".sfs-selected-file-item"),t=i.data("file");this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_removed_file",t),this._landingPageUiModel.set("user_action","removed_file"),e.stopPropagation()},_onSFSFileActionBtn1Click:function(){if(!this.$actionBtn1Elem.hasClass("disabled")){var e=this._getSelectedFilesCount();o.isAcrobat()&&e>0?this._handlePrepareFormClickEvent():e>0?this._handleSendClickEvent():this._handleSelectFileClickEvent(),this.$("#sfs-file-action-btn-1").removeClass("draw-button-focus-outline")}},_onSFSFileActionBtn2Click:function(){this.$actionBtn2Elem.hasClass("disabled")||this._handleSendClickEvent()},_handlePrepareFormClickEvent:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","prepare_form_btn_clicked")},_handleSendClickEvent:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","send_action_btn_clicked")},_handleSelectFileClickEvent:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","select_action_btn_clicked")},_onSFSManageAgreementsBtnClick:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","manage_agreements_btn_clicked")}}),i.SFSLandingPageView}),define("pdmplugins/send-for-sign/js/templates/sfs-new-landing-page-template",[],function(){return'<div id="sfs-new-landing-page-content" class="ui-theme theme-container">    <div class="sfs-service-spacer-new"></div>    <div class="sfs-service-title-new theme-text" ><%= title %></div>    <div class="sfs-service-subtitle-new theme-text"><%= subtitle %></div>    <div class="sfs-service-subtitle-new theme-text" ><%= subtitle2 %><a class="learn-more" tabindex="10"><%= subtitle3 %></a></div><div class = "email-error-parent hidden"><div class = "email-error">   <div class="email-error-msg"></div>   <span id="close-button" tabindex="11">x<span></div></div><div class="sfs-current-thumbnail-row"><figure class="sfs-recent-file-container"        style="position:relative" ><div class="sfs-recent-file" role="presentation"><img class="sfs-preview-image" draggable="false"     src="" alt=""/></div></figure></div><div class = "sfs-info-content-container">    <div>     <div class="sfs-general-heading theme-text"><%= totitle %></div>    <div class="sfs-general-heading-addcc " >           <a class = "email-addcc theme-hyperlink" tabindex= "2"><%= addcc %></a> |            <button class="core-help-icon email-address-help" tabindex= "3" aria-label="<%= help_icon_text %>"></button>    </div>    </div>     <div class="sfs-email-list">       <div class="sfs-to-email-block">         <div class ="sfs-to-email-ids-list"></div>           <textarea class="sfs-email-textarea ui-theme theme-container theme-text" placeholder="<%=to_email_placeholder%>" align="right" rows="1" tabindex="1" spellcheck="false"></textarea>       </div>       <div class="sfs-cc-email-fullblock hidden" >           <div class="sfs-general-heading theme-text"> <%= cc %> | <a class = "email-hidecc theme-hyperlink" tabindex="4"><%= hide %></a></div>           <div class="sfs-cc-email-block" >                 <div class ="sfs-cc-email-ids-list"></div>                 <textarea class="sfs-email-cc-textarea ui-theme theme-container theme-text" placeholder="<%=cc_email_placeholder%>" align="right" rows="1" tabindex="5" spellcheck="false"></textarea>           </div>       </div>       <div class = "role-dropdown hidden">           <ul id="dropdown-menu" >                 <li class="signer"><div id = "icon"><img class="signerImg posAbsolute"/></div><span class="value" > <%=roledropdown_signer%></span></li>                 <li class="approver"><div id = "icon"><img class="approverImg posAbsolute"/></div><span class="value"> <%=roledropdown_approver%></span></li>           </ul>       </div>       <div class="share-autocomplete-box"></div>    </div>    <div class="sfs-general-heading theme-text" ><%= toMessage %></div>   <textarea class="sfs-subject-list ui-theme theme-container theme-text"  placeholder ="<%=subject_placeholder%>" align="left" maxlength="255" tabindex="6"></textarea>   <textarea class="sfs-message-list ui-theme theme-container theme-text" align="left" tabindex="7"></textarea>    <div class="sfs-selected-files-heading-container-new.hidden">    <div class="sfs-selected-files-heading-container-new">       <div class="sfs-selected-files-heading-new theme-text" tabindex="-1"><%= selected_files %></div>       <div class="sfs-tool-options-add-files">           <button id="sfs-add-button" class="sfs-add-files addfile theme-hyperlink" tabindex="8">+ <%= add_files %></button>       </div>    </div>    <div class="sfs-selected-files-container-new">       <div class="sfs-selected-files-list-new ui-theme theme-border"></div>       <div class="sfs-app-info-container">           <div class="info-txt 1"></div>           <div class="info-txt 2"></div>           <div class="info-txt 3"></div>       </div>    </div>    <div class="sfs-action-btns-group-new">       <div class="sfs-action-btns-group-new-container">           <div class="sfs-file-action-new-btn-and-descr">               <div><input type="button" id = "sfs-file-action-btn-new-1" class=" control-button sfs-file-action-btn-new 1 site-catalyst theme-button theme-button-label" tabindex="9"/></div>               <div class="description-text 1 theme-text"></div>           </div>       </div>    </div> </div> </div>'}),define("pdmplugins/send-for-sign/js/templates/sfs-new-file-name-template",[],function(){return'<div class="sfs-selected-file-item-new ui-theme      theme-border">    <div class="collection-item-thumb <%= iconCls %>"></div>    <div class="file-name theme-text"><%= fileName %></div>    <button class="file-remove-new hidden core-remove-x sfs-file-remove-new"     tabindex = 0 aria-label="<%= ariaRemoveLabel %>"></button></div>'}),define("pdmplugins/send-for-sign/js/templates/sfs-email-block-template",[],function(){return'<div class="sfs-email-id-item ui-theme theme-border theme-hoverable">     <div id="emailBlock">     <div id="dropdownMenu">	    <button  class="dropbtn signerImg"></button>	</div><div class="caret"></div>    </div>    <div class="email-id" title = "<%= emailID %>"><%= emailID %></div>    <button class="email-remove core-remove-x sfs-email-remove"     tabindex = 0 aria-label="<%= ariaRemoveLabel %>"></button></div>'}),define("pdmplugins/send-for-sign/js/templates/sfs-guide-template",[],function(){return'<div role="tooltip" class="sfs-guide <%= guideType %>"><div class="sfs-guide-content"><%= text %></div><div class="sfs-guide-arrow"></div></div>'}),define("pdmplugins/send-for-sign/js/templates/sfs-autocomplete-template",[],function(){return' <div class="share-auto-c-list"     role="listbox" id="share-auto-c-list"></div> '}),define("pdmplugins/send-for-sign/js/views/sfs-autocomplete-view",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/sfs-autocomplete-template","pdmplugins/send-for-sign/js/constants/sfs-sc-constants"],function(e,i,t){return i.AutocompleteView=e.View.extend({events:{"mousedown .share-auto-address":"_onAddressClick"},initialize:function(){var i,s=this.options,n=s.autoCCollection;e.View.prototype.initialize.call(this),this._template=_.template(t),this._addressTemplate=_.template("<div class='share-auto-address <%=specialClass%>'     title='<%-email %>'     role='option' id='<%=id%>' tabindex='-1'     aria-selected='<%=ariaSelected%>'><%-email%></div>"),this._localAddressTemplate=_.template("<div class='share-auto-address <%=specialClass%>' title='<%-email %>' ><%-name%> &lt;<%-email%>&gt; </div>"),this._editControl=s.editControl,this._landingPageUiModel=s.sfsAppLandingPageUiModel,i=new Backbone.Collection,this.filteredCollection=i,i.on("all",_.debounce(_.bind(this._onFilteredCChange,this),50)),n.on("all",_.debounce(_.bind(this._onCollectionChange,this),300))},render:function(){return e.View.prototype.render.call(this),0===this.$el.children().length&&(this.$el.html(this._template()),this._initWrappers(),this.$autoCList.on("scroll",this._onAddressScroll),e.Util.isCEF()&&this.$autoCList.css("overflow","auto")),this._renderAddressList(),this},_initWrappers:function(){this.$autoCList=this.$(".share-auto-c-list")},setFilter:function(e){e&&(e=$.trim(e.toLowerCase()),e.length<3&&(e=void 0)),e||(this.selectedID=void 0),this.fragment=e,this._updateFilteredCollection()},makeChoice:function(e){{var i,t;this.options}return e||1!==this.filteredCollection.length?this.selectedID&&(i=this.filteredCollection.get(this.selectedID)):i=this.filteredCollection.at(0),i&&(t=i.get("email"),this._insertEmail(t)),i},selectDown:function(){var i,t,s,n=this.filteredCollection,o=this.selectedID,r=this.$autoCList.scrollTop(),a=$(".share-auto-address").height(),l=6,p=6;e.Util.isCEF&&(l=n.length),s=this._landingPageUiModel.get("enable_autoc_arrows"),s&&(o?(l>n.length&&(l=n.length),t=n.get(o),i=n.indexOf(t),-1===i?o=void 0:(l>i&&(i+=1,l>p&&this._keyboardScrollTo(r+a)),i>=l?o=void 0:(t=n.at(i),o=t?t.id:void 0))):(t=n.at(0),t?(o=t.id,this._keyboardScrollTo(0)):o=void 0),this.selectedID=o,this._renderAddressList())},selectUp:function(){var i,t,s,n=this.filteredCollection,o=this.selectedID,r=this.$autoCList.scrollTop(),a=6,l=6,p=$(".share-auto-address").height();e.Util.isCEF&&(a=n.length),s=this._landingPageUiModel.get("enable_autoc_arrows"),s&&(o?(t=n.get(o),i=n.indexOf(t),-1===i?o=void 0:(i>=0&&(i-=1,a>l&&this._keyboardScrollTo(r-p)),0>i?o=void 0:(t=n.at(i),o=t?t.id:void 0))):(a>n.length&&(a=n.length),a-=1,t=n.at(a),t?(o=t.id,a>l&&this._keyboardScrollTo(a*p)):o=void 0),this.selectedID=o,this._renderAddressList())},_keyboardScrollTo:function(i){e.Util.isCEF()&&(this.$autoCList.stop(!0,!0),this.$autoCList.animate({scrollTop:i},"fast"))},_renderAddressList:function(){var e,i,t=this.filteredCollection,s=this.$autoCList,n=this.selectedID;e=this._localAddressTemplate,i=this._addressTemplate,t.length&&this.$el.show(),s.empty(),t.each(function(t){var o,r="";t.id===n&&(r="selected"),o=_.isUndefined(t.get("name"))||""===t.get("name")?i({email:t.get("email"),specialClass:r,id:_.uniqueId("share-auto-address-"),ariaSelected:""===r?"false":"true"}):e({name:t.get("name"),email:t.get("email"),specialClass:r,id:_.uniqueId("share-auto-address-"),ariaSelected:""===r?"false":"true"}),s.append(o)}),t.length||this.$el.hide()},_updateFilteredCollection:function(){var e,i=this.options.autoCCollection,t=this.filteredCollection,s=[],n="",o="",r=!1;return e=this.fragment,e&&e.length&&(s=i.filter(function(i){return o=i.get("email"),r=0===o.indexOf(e),r===!1&&(n=i.get("name"),void 0!==n&&(n=n.toLowerCase(),r=0===n.indexOf(e.toLowerCase()))),r})),t.set(s),s},_onFilteredCChange:function(){this._renderAddressList()},_onCollectionChange:function(){this._renderAddressList()},_onAddressClick:function(e){var i,t=$(e.target);i=t.attr("title"),this._insertEmail(i),this._landingPageUiModel.get("autocomplete_eventual_click")||(this._landingPageUiModel.set("autocomplete_eventual_click",!0),this._landingPageUiModel.set("autocomplete_avoided",!0)),this._landingPageUiModel.get("autocomplete_immediate_click")||this._landingPageUiModel.set("autocomplete_immediate_click",!0)},_onAddressScroll:function(){this._landingPageUiModel.get("autocomplete_scroll")||(this._landingPageUiModel.set("autocomplete_scroll",!0),this._landingPageUiModel.set("autocomplete_immediate_click",!0),this._landingPageUiModel.set("autocomplete_avoided",!0))},_insertEmail:function(e){this.options.emailView._setRecipientsFromText(e),this.setFilter(void 0),_.delay(_.bind(function(){this._editControl.focus(!0)},this),10)}}),i.AutocompleteView}),define("pdmplugins/send-for-sign/js/utils/sfs-ts-utils",[],function(){var e={extractRootUrl:function(e){var i=document.createElement("a");return i.href=e,i.protocol+"//"+i.host}};return e}),define("pdmplugins/send-for-sign/js/ops/plugin/desktop-fetching-autocomplete-list-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/utils/sfs-ts-utils","core/ops/op"],function(e,i,t){i.DesktopFetchingAutocompleteListOp=e.Op.extend({run:function(){var e,i=this.options.sfsAppLandingPageUiModel.get("enable_autocomplete");return i?this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){return e=this.options.appApi.baseFilesUrisApi.getSendApiUri(),e=t.extractRootUrl(e),this.options.rootUrl=e,this.options.autoCCollection.setRUrl(this.options.rootUrl),this.options.autoCCollection.fetchAll(),this._getResolvedPromise()},this)):void 0}})}),define("pdmplugins/send-for-sign/js/ops/plugin/desktop-getting-subscription-levels-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/utils/sfs-ts-utils","core/ops/op"],function(e,i,t){i.DesktopGettingSubscriptionLevels=e.Op.extend({run:function(){return this.validateRegistry().then(_.bind(function(){return this.readFromRegistry()},this),_.bind(function(){return this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){return this.authenticatingFirstTime()},this))},this))},authenticatingFirstTime:function(){return this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){return this.preModelFetchValues(),this.writeToRegistry()},this),_.bind(function(){return $.Deferred().reject().promise()},this))},preModelFetchValues:function(){var e;e=this.options.appApi.baseFilesUrisApi.getSendApiUri(),e=t.extractRootUrl(e),this.options.rootUrl=e,this.options.autoCCollection.setRUrl(this.options.rootUrl)},readFromRegistry:function(){return this.options.appApi.rnaApi.then(_.bind(function(e){var i={prefName:"SendForSignature"};return e.registryAPI.getRegistryContents(i).then(_.bind(function(e){return this.registryResponse=JSON.parse(e),this.populateAutoCCollectionFromRegistry(),this.options.readRegistry=!0,$.Deferred().resolve().promise()},this),_.bind(function(){return $.Deferred().reject().promise()},this))},this),_.bind(function(){return $.Deferred().reject().promise()},this))},writeToRegistry:function(){var e=this.makeRegistryHierarchy(),i=JSON.stringify(e),t={prefName:"SendForSignature",data:i};return this.options.appApi.rnaApi.then(_.bind(function(e){e.registryAPI.setRegistryContents(t).then(_.bind(function(e){return e?$.Deferred().resolve().promise():$.Deferred().reject().promise()},this),_.bind(function(){return $.Deferred().reject().promise()},this))},this),_.bind(function(){return $.Deferred().reject().promise()},this))},validateRegistry:function(){return this.options.readRegistry?this.options.appApi.rnaApi.then(_.bind(function(e){var i={prefName:"SendForSignature"};return e.registryAPI.checkIfRegistryExists(i).then(_.bind(function(e){return e?$.Deferred().resolve().promise():$.Deferred().reject().promise()},this),_.bind(function(){return $.Deferred().reject().promise()},this))},this),_.bind(function(){return $.Deferred().reject().promise()},this)):$.Deferred().reject().promise()},makeRegistryHierarchy:function(){var e={User:{accountType:_.isUndefined(this.options.appApi.usersMeApi.getUserIdentity().account_type)?"":this.options.appApi.usersMeApi.getUserIdentity().account_type,Email:_.isUndefined(this.options.appApi.usersMeApi.getUserIdentity().email)?"":this.options.appApi.usersMeApi.getUserIdentity().email,addressList:this.getEmailAddressListString()}};return e},getEmailAddressListString:function(){var e="";return _.each(this.options.autoCCollection.models,function(i){(_.isUndefined(i.get("isLocalContact"))||i.get("isLocalContact")===!1)&&(e+=i.id,e+=";")}),!_.isUndefined(this.options.recipientsAreFinalized)&&this.options.recipientsAreFinalized&&_.each(this.options.recipients,function(i){i&&-1===e.search(i)&&(e+=i,e+=";")}),e},populateAutoCCollectionFromRegistry:function(){var e,i=this.options.autoCCollection;_.isUndefined(this.registryResponse.User)||_.isUndefined(this.registryResponse.User.addressList)||(e=this.registryResponse.User.addressList.split(";"),e.pop(),_.each(e,function(e){i.add({email:e,isLocalContact:!1})}))}})}),define("pdmplugins/send-for-sign/js/views/sfs-new-landing-page-view",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/sfs-new-landing-page-template","pdmplugins/send-for-sign/js/templates/sfs-new-file-name-template","pdmplugins/send-for-sign/js/templates/sfs-email-block-template","pdmplugins/send-for-sign/js/templates/sfs-guide-template","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","core/utils/util","core/utils/truncate","core/utils/css-util","core/utils/file-types","pdmplugins/send-for-sign/js/constants/sfs-sc-constants","core/utils/image-loader","core/utils/http-util","pdmplugins/send-for-sign/js/views/sfs-autocomplete-view","pdmplugins/send-for-sign/js/ops/plugin/desktop-fetching-autocomplete-list-op","pdmplugins/send-for-sign/js/ops/plugin/desktop-getting-subscription-levels-op"],function(e,i,t,s,n,o,r,a,l,p,d,c,h,u){var f,g=!1,S=25,E=11,m=255,A=!1,v=!1,C=!1,I=!1;return i.SFSNewLandingPageView=e.View.extend({initialize:function(){e.View.prototype.initialize.call(this),this._template=_.template(t),this._fileNameTemplate=_.template(s),this._emailIdTemplate=_.template(n),this._landingPageUiModel=this.options.sfsAppLandingPageUiModel,this.$currentVisibleThumbNail="fileName",this._addUiModelEventListeners(),this._addKeyEventListener()},events:function(){return{"click .learn-more":"_onLearnMoreBtnClick","click .sfs-add-files":"_onAddFilesBtnClick","click .sfs-selected-file-item-new .file-remove-new":"_onSelectedFileItemRemoveClick","click .sfs-file-action-btn-new.1":"_onSFSFileActionBtn1Click","keyup .sfs-email-textarea":"_onKeyUpEmaiTextarea","keydown .sfs-email-textarea":"_onKeyDownEmailTextarea","paste .sfs-email-textarea":"_onPasteEmailTextarea","focusout .sfs-email-textarea ":"_onFocusOutEmailTextarea","input .sfs-email-textarea ":"_onInputEmailTextarea","keyup .sfs-email-cc-textarea":"_onKeyUpCCEmaiTextarea","keydown .sfs-email-cc-textarea":"_onKeyDownCCEmailTextarea","paste .sfs-email-cc-textarea":"_onPasteCCEmailTextarea","focusout .sfs-email-cc-textarea ":"_onFocusOutCCEmailTextarea","input .sfs-email-cc-textarea ":"_onInputCCEmailTextarea","click .email-addcc":"_OnclickAddCC","click .email-hidecc":"_OnClickHideCC","click #close-button":"_closeError","click .dropbtn":"_roleDropdownClick","mouseenter .signer":"_OnMouseEnterSignerBlock","mouseleave .signer":"_OnMouseLeaveSignerBlock","mouseenter .approver":"_OnMouseEnterApproverBlock","mouseleave .approver":"_OnMouseLeaveApproverBlock","click .sfs-email-id-item .email-remove":"_onSelectedEmailRemoveClick","keydown .sfs-subject-list":"_onKeyDownSubjectTextArea","keydown .sfs-message-list":"_onKeyDownMessageTextArea","mouseenter .sfs-selected-file-item-new":"_onMouseEnterSelectedFileItem","mouseleave .sfs-selected-file-item-new":"_onMouseLeaveSelectedFileItem","mouseenter .email-address-help":"_onMouseEnterEmailHelpIcon","mouseleave .email-address-help":"_onMouseLeaveEmailHelpIcon","click .sfs-to-email-block":"_onEmailToAreaClick","click .sfs-cc-email-block":"_onCCAreaClick"}
},_closeOpenDropdownandGuides:function(){this.$roleDropDown.hasClass("hidden")||(this.$roleDropDown.addClass("hidden"),this.$signerBlockInRoleDropDown.hasClass("SignerHover")&&(this.$signerBlockInRoleDropDown.removeClass("SignerHover"),this._roleDropdownSelectSignerClick(this.$signerBlockInRoleDropDown)),this.$approverBlockInRoleDropDown.hasClass("ApproverHover")&&(this.$approverBlockInRoleDropDown.hasClass("ApproverHover"),this._roleDropdownSelectApproverClick(this.$approverBlockInRoleDropDown)),event.stopPropagation()),this._hideButtonGuide(),this._autocompleteControl&&this._autocompleteControl.setFilter(void 0)},_addKeyEventListener:function(){this.options.appApi.keyApi.pushKeyHandler(this)},_removeKeyEventListener:function(){this.options.appApi.keyApi.popKeyHandler(this)},_onKeyDown:function(e){var i=e.keyCode,t=$(e.target),s=$.Event("click");switch(i){case 13:case 32:t.trigger(s),e.preventDefault();break;case 9:var n=!this.$EmailErrorParent.hasClass("hidden"),o=n?this.$closeButton:this.$learnMore;this.$emailTextarea[0]==t[0]?e.shiftKey?(o.focus(),e.stopPropagation(),e.preventDefault()):n&&(this.$(".email-addcc").focus(),this.$(".email-addcc").focus(),e.stopPropagation(),e.preventDefault()):e.shiftKey||o[0]!=t[0]?this.$(".email-addcc")[0]==t[0]?this._onMouseEnterEmailHelpIcon():this.$(".email-address-help")[0]==t[0]&&this._onMouseLeaveEmailHelpIcon():(this.$emailTextarea.focus(),e.stopPropagation(),e.preventDefault())}},_addUiModelEventListeners:function(){this._landingPageUiModel.on("change:is_refreshed",this._refreshPageContent),this._landingPageUiModel.on("change:is_visible",this._onVisibilityChange)},render:function(){return e.View.prototype.render.call(this),this._landingPageUiModel.get("is_visible")?(this.$el.show(),0===this.$el.children().length&&(this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.NEW_LANDING_PAGE]),this.$el.html(this._template({title:r.LP_TITLE_NEW,addcc:r.LP_ADD_CC,subtitle:r.LP_SUBTITLE_NEW,subtitle2:r.LP_SUBTITLE2_NEW,subtitle3:r.LP_SUBTITLE3_NEW,totitle:r.LP_TO,toMessage:r.LP_MESSAGE,add_files:r.SFS_ADD_FILES,selected_files:r.LP_FILES,no_email_error:r.LP_NO_EMAIL_ERROR,invalid_email_error:r.LP_INVALID_EMAIL_ERROR,to_email_placeholder:r.LP_TO_EMAIL_PLACEHOLDER,cc_email_placeholder:r.LP_CC_EMAIL_PLACEHOLDER,subject_placeholder:r.LP_SUBJECT_PLACEHOLDER,roledropdown_signer:r.LP_SIGNER,roledropdown_approver:r.LP_APPROVER,help_icon_text:r.LP_HELP_ICON_TEXT,cc:r.LP_CC,hide:r.LP_HIDE})),this._initWrappers(),this._refreshPageContent(),this._getEmailContacts(),this._UpdatePreviouslyUsedContacts()),this._renderChildViews(),this._registerEventsToCloseRoleDropDown(),this):(this.$el.hide(),this)},_initWrappers:function(){this.$fileItemsContainerElem=this.$(".sfs-selected-files-list-new"),this.$emailBlock=this.$(".sfs-to-email-block"),this.$emailIdList=this.$(".sfs-to-email-ids-list"),this.$emailIdCCList=this.$(".sfs-cc-email-ids-list"),this.$emailTextarea=this.$(".sfs-email-textarea"),this.$emailCCTextarea=this.$(".sfs-email-cc-textarea"),this.$messageBody=this.$(".sfs-message-list"),this.$subject=this.$(".sfs-subject-list"),this.$fileItemsHeadingElem=this.$(".sfs-selected-files-heading-container-new"),this.$actionBtnsGrpElem=this.$(".sfs-action-btns-group-new"),this.$actionBtnsContainerElem=this.$(".sfs-action-btns-group-new-container"),this.$actionBtn1Elem=this.$(".sfs-file-action-btn-new.1"),this.$actionBtn2Elem=this.$(".sfs-file-action-btn-new.2"),this.$actionBtn1DescrElem=this.$(".description-text.1"),this.$actionBtn2DescrElem=this.$(".description-text.2"),this.$actionBtnSeparatorElem=this.$(".sfs-action-btn-separator"),this.$appInfoContainer=this.$(".sfs-app-info-container"),this.$appInfoTxt1Elem=this.$(".sfs-app-info-container .info-txt.1"),this.$appInfoTxt2Elem=this.$(".sfs-app-info-container .info-txt.2"),this.$appInfoTxt3Elem=this.$(".sfs-app-info-container .info-txt.3"),this.$docThumbnail=this.$(".sfs-current-thumbnail-row"),this.$EmailError=this.$(".email-error"),this.$EmailErrorMsg=this.$(".email-error-msg"),this.$EmailErrorParent=this.$(".email-error-parent"),this.$addCCBlock=this.$(".sfs-cc-email-fullblock"),this.$autocompleteBox=this.$(".share-autocomplete-box"),this.$learnMore=this.$(".learn-more"),this.$closeButton=this.$("#close-button"),this.$previewImage=this.$(".sfs-preview-image"),this.$signerBlockInRoleDropDown=this.$(".signer"),this.$approverBlockInRoleDropDown=this.$(".approver"),this.$roleDropDown=this.$(".role-dropdown");var e=this._calculateUtf8Length(this.$emailTextarea[0].placeholder),i=this._calculateUtf8Length(this.$emailCCTextarea[0].placeholder);this.$emailTextarea.css("width",8*e+"px"),this.$emailCCTextarea.css("width",8*i+"px")},_calculateUtf8Length:function(e){for(var i=0,t=0;t<e.length;t++){var s=e.charCodeAt(t);128>s?i++:i+=s>127&&2048>s?1.5:2}return i},_renderChildViews:function(){if(this._landingPageUiModel.get("enable_autocomplete")){var e=_.extend({},this.options,{editControl:this.$emailTextarea,emailView:this});this.$autocompleteBox.show(),this._renderChildView("_autocompleteControl",i.AutocompleteView,this.$autocompleteBox,e)}else this._autocompleteControl&&this.removeChildView(this._autocompleteControl),this.$autocompleteBox.hide()},_onVisibilityChange:function(){this.render()},_refreshPageContent:function(){this._updateFileItemsList(),this._updateToListWithPrepareFormRecipients(),this._updateActionButtonLabels(),this._updateActionButtonEnabledState(),this._updateActionButtonDescription(),this._updateAppInfoTexts(),this._adjustCSS(),this._focusOnSelectButton(),this._loadDocthumbnail()},_importLocalEmailContacts:function(){return this.options.appApi.rnaApi.then(_.bind(function(e){return e.stApi.getOutlookAutoCompleteListAPI().then(_.bind(function(e){var i=e.split(";"),t="",s="",n=-1,o=this.options.autoCCollection;return i.pop(),_.each(i,function(e){n=_.lastIndexOf(e,"<"),-1===n?(s=e,t=""):(s=e.substring(n+1),t=e.substring(0,n)),">"===_.last(s)&&(s=s.slice(0,-1))," "===_.last(t)&&(t=t.slice(0,-1)),o.get(s)&&o.remove(s),o.add({email:s,name:t,isLocalContact:!0})}),$.Deferred().resolve().promise()},this),_.bind(function(){return $.Deferred().reject().promise()},this))},this),_.bind(function(){return $.Deferred().reject().promise()},this))},_getEmailContacts:function(){var t=this._getResolvedPromise();e.Util.isCEF()&&this._landingPageUiModel.get("autocomplete_local_contacts_imported")===!1&&(t=this._importLocalEmailContacts(),t.then(_.bind(function(){this._landingPageUiModel.set({autocomplete_local_contacts_imported:!0})},this))),e.Util.isCEF()&&i.opFactory.create("DesktopFetchingAutocompleteListOp",this.options).run()},_UpdatePreviouslyUsedContacts:function(){this._userSignedIn=this.options.appApi.sessionApi.isSignedInReader(),this._userConnected=this.options.appApi.networkConnectivityApi.isOnline(),this._userSignedIn&&this._userConnected&&(this.options.readRegistry=!0,i.opFactory.create("DesktopGettingSubscriptionLevels",this.options).run())},_registerEventsToCloseRoleDropDown:function(){_.bindAll(this,"_closeOpenDropdownandGuides"),$("html").bind("mousewheel",this._closeOpenDropdownandGuides),$("body").bind("mousedown",this._closeOpenDropdownandGuides),$(window).on("resize",this._closeOpenDropdownandGuides)},_updateToListWithPrepareFormRecipients:function(){this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.prepareFormsEmailRecipients().then(_.bind(function(e){var i=0;if(e.length>0){var t=e.split(",");_.each(t,_.bind(function(e){e=$.trim(e);var t=this._validateEmail(e);if(t){var s=$(this._emailIdTemplate({emailID:e,ariaRemoveLabel:this._getRemoveAriaLabel(e)}));this._addToEmailIdList(this.$emailIdList,s,!1),i=1}},this)),i&&this._showGuideonButton(r.LP_NEXT_GUIDE_TEXT)}},this))},this))},_addToEmailIdList:function(e,i,t){i.appendTo(e),t?this.$emailCCTextarea[0].placeholder="":this.$emailTextarea[0].placeholder=""},_removeFromEmailIdList:function(e,i){e.children().last().remove(),1==e.children().length,i?this.$emailCCTextarea[0].placeholder=r.LP_CC_EMAIL_PLACEHOLDER:this.$emailTextarea[0].placeholder=r.LP_TO_EMAIL_PLACEHOLDER},_updateActionButtonLabels:function(){this._landingPageUiModel.get("action_btn1_visible")?(this.$actionBtn1Elem.val(this._landingPageUiModel.get("action_btn1_label")),this.$actionBtn1Elem.removeClass("hidden")):this.$actionBtn1Elem.addClass("hidden"),this._landingPageUiModel.get("action_btn2_visible")?(this.$actionBtn2Elem.val(this._landingPageUiModel.get("action_btn2_label")),this.$actionBtnSeparatorElem.html(this._landingPageUiModel.get("action_btn_separator_label")),this.$actionBtn2Elem.removeClass("hidden"),this.$actionBtnSeparatorElem.removeClass("hidden")):(this.$actionBtn2Elem.addClass("hidden"),this.$actionBtnSeparatorElem.addClass("hidden"))},_updateActionButtonEnabledState:function(){this._landingPageUiModel.get("action_btn1_enabled")?this.$actionBtn1Elem.removeClass("disabled"):this.$actionBtn1Elem.addClass("disabled"),this._landingPageUiModel.get("action_btn2_enabled")?this.$actionBtn2Elem.removeClass("disabled"):this.$actionBtn2Elem.addClass("disabled")},_updateActionButtonDescription:function(){this._landingPageUiModel.get("action_btn_descr_visible")?(this.$actionBtn1DescrElem.html(this._landingPageUiModel.get("action_btn1_descr_txt")),this.$actionBtn2DescrElem.html(this._landingPageUiModel.get("action_btn2_descr_txt")),this.$actionBtn1DescrElem.removeClass("hidden"),this.$actionBtn2DescrElem.removeClass("hidden")):(this.$actionBtn1DescrElem.addClass("hidden"),this.$actionBtn2DescrElem.addClass("hidden"))},_updateAppInfoTexts:function(){this._landingPageUiModel.get("app_info_txt_visible")?(this.$appInfoTxt1Elem.html(this._landingPageUiModel.get("app_info_txt1")),this.$appInfoTxt1Elem.removeClass("hidden"),this.$appInfoTxt2Elem.html(this._landingPageUiModel.get("app_info_txt2")),this.$appInfoTxt2Elem.removeClass("hidden"),this.$appInfoTxt3Elem.html(this._landingPageUiModel.get("app_info_txt3")),this.$appInfoTxt3Elem.removeClass("hidden")):(this.$appInfoTxt1Elem.addClass("hidden"),this.$appInfoTxt2Elem.addClass("hidden"),this.$appInfoTxt3Elem.addClass("hidden"))},_getRemoveAriaLabel:function(e){return _.template(r.GENERIC_ARIA_LABEL_STRING,{prefix:e,suffix:r.SEND_REMOVE})},_updateFileItemsList:function(){var e,i,t,s=this._landingPageUiModel.get("selected_files"),n=this._landingPageUiModel.get("file_collection_visible"),o="",a=this.$messageBody.val();if(v||(a=r.LP_MESSAGE_TEXT),n){if(!A){o=s[0].get("name");var l=o.lastIndexOf(".");-1!==l&&(o=o.substr(0,l)),this.$subject.val(o)}this.$fileItemsContainerElem.empty(),_.each(s,_.bind(function(s){e=s.get("name"),t=s.get("path"),i=$(this._fileNameTemplate({fileName:e,iconCls:d.getFileInfo("",e).iconCls,ariaRemoveLabel:this._getRemoveAriaLabel(e)})),i.data("file",s),this.$fileItemsContainerElem.append(i)},this)),this.$fileItemsContainerElem.removeClass("hidden"),this.$fileItemsHeadingElem.removeClass("hidden")}else this.$fileItemsContainerElem.addClass("hidden"),this.$fileItemsHeadingElem.addClass("hidden"),A||this.$subject.val("");this.$messageBody.val(a)},_adjustCSS:function(){this._adjustAppsInfoContainerCSS(),this._adjustFileItemsCSS(),this._adjustActionButtonsCSS()},_focusOnSelectButton:function(){this.$emailTextarea.focus()},_adjustAppsInfoContainerCSS:function(){var e=this.$fileItemsContainerElem.css("margin-left");this.$appInfoContainer.css("margin-left",e)},_adjustActionButtonsCSS:function(){var e=this.$actionBtn1Elem.width()+p.getCssNum(this.$actionBtn1Elem,"padding-left")+p.getCssNum(this.$actionBtn1Elem,"padding-left"),i=this.$actionBtn2Elem.width()+p.getCssNum(this.$actionBtn2Elem,"padding-left")+p.getCssNum(this.$actionBtn2Elem,"padding-left"),t=Math.max(e,parseInt(this.$actionBtn1Elem.css("min-width"),10)),s=Math.max(i,parseInt(this.$actionBtn2Elem.css("min-width"),10));this.$actionBtn1DescrElem.width(t),this.$actionBtn2DescrElem.width(s)},_adjustFileItemsCSS:function(){this.$fileItemsContainerElem.children().each(function(){var e=$(this),i=$(".file-name",e),t=$(".collection-item-thumb",e),s=$(".file-remove-new",e),n=e.innerWidth()-parseInt(i.css("text-indent"),10);n-=t.position().left+t.outerWidth()+s.outerWidth(),l.truncateElementText(i,n)});var e=this._getSelectedFilesCount();e>0?this.$actionBtn1Elem.removeClass("no-file-selected"):this.$actionBtn1Elem.addClass("no-file-selected")},_getSelectedFilesCount:function(){var e=this._landingPageUiModel.get("selected_files");return _.isEmpty(e)?0:e.length},_onLearnMoreBtnClick:function(){this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.LEARN_MORE,c.CLICKED]),window.open(r.LP_LEARN_MORE_GOURL)},_onAddFilesBtnClick:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","browse_file")},_posAminusB:function(e,i){return{left:e.left-i.left,top:e.top-i.top}},_hideButtonGuide:function(e){if(e=e||f)if(e.guide&&e===f)e.removeTimer&&(clearTimeout(e.removeTimer),delete e.removeTimer),e.guide.remove(),e.removeFunc&&e.removeFunc(),f=null,e.nextGuide&&this._showButtonGuide(e.nextGuide);else{for(var i=f;i&&i.nextGuide!==e;)i=i.nextGuide;i&&(i.nextGuide=e.nextGuide),e.removeFunc&&e.removeFunc()}},_findButtonGuide:function(e){for(var i=f;i&&e&&!e(i);)i=i.nextGuide;return i},_showButtonGuide:function(e){var i=this,t=!1;if(e.text===r.LP_NEXT_GUIDE_TEXT&&(t=!0),e=_.extend({top:0,left:0,text:"",parent:$(document),duration:5e3,arrowPosition:40,clickToRemove:!0,important:!1,getPreference:function(){if(t){var e=i.options.appApi.rnaApiObj.esApi.isSFSCoachmarkAlreadyDisplayed();return e||g}return!1},setPreference:function(){t&&(g=!0,i.options.appApi.rnaApiObj.esApi.setSFSCoachmarkAlreadyDisplayed())}},e),e.force||e.redo||!e.getPreference()){if(t&&this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.NEXT_GUIDE_SHOWN]),f){if(e.noQueueIfShowing&&findGuide(function(i){return i.guideID===e.guideID}))return e;if(!e.important||f.important){for(var s=f;s.nextGuide;){if(e.important&&!s.nextGuide.important){e.nextGuide=s.nextGuide;break}s=s.nextGuide}return s.nextGuide=e,e}f.removeTimer&&(clearTimeout(f.removeTimer),delete f.removeTimer),f.guide.remove(),delete f.guide,f.redo=!0,e.nextGuide=f}e.redo||e.setPreference();var n=e.guide=$(_.template(o,{text:e.text,guideType:e.guideType||""})),a=n.find(".sfs-guide-arrow");a.addClass(e.arrow),e.parent.append(n);var l="left";switch(e.arrow){case"up":e.initialPosition={left:e.left-n.outerWidth(),top:e.top+a.height()};break;case"down":e.initialPosition={left:e.left-n.outerWidth(),top:e.bottom-a.height()-n.outerHeight()};break;case"left":e.initialPosition={left:e.left+a.width(),top:e.top};break;case"right":e.initialPosition={left:e.right,top:e.top},l="right"}t?n.css("top",e.initialPosition.top+"px").css(l,e.initialPosition.left+"px"):n.css("top",e.initialPosition.top+"px").css(l,e.initialPosition.left+20+"px"),a.css("up"===e.arrow||"down"===e.arrow?"left":"top",n.outerWidth()-e.arrowPosition),e.width&&n.css("width",e.width+"px"),e.maxWidth&&n.css("max-width",e.maxWidth+"px"),n.css("cursor","default"),f=e,e.clickToRemove&&(n.css("cursor","pointer"),n.click(function(){i._hideButtonGuide()})),e.addFunc&&!e.redo&&e.addFunc(n),e.duration&&(e.removeTimer=_.delay(function(e){delete e.removeTimer,n.fadeOut(function(){i._hideButtonGuide()})},e.duration,e)),delete e.redo}return e},_setGuidePlacement:function(e){var i,t,s;t=this.$("#sfs-new-landing-page-content"),e.text===r.LP_NEXT_GUIDE_TEXT?(s=this.$(".sfs-action-btns-group-new"),i=this.$(".sfs-file-action-new-btn-and-descr")):e.text===r.LP_HELP_ICON_TEXT&&(s=this.$(".sfs-general-heading-addcc"),i=this.$(".email-addcc"));var n=(this._posAminusB(s.offset(),t.offset()),i.offset());e.left=s.position().left+s.outerWidth(),e.left=Math.max(10,e.left);var o=n.top+i.height()-$(window).scrollTop(),a=i.position().top;o>$(window).height()-e.guideHeight?(e.bottom=a,e.arrow="down",e.bottom=Math.min(t.height()-10,e.bottom)):(e.top=a+(i.height()||s.height()),e.arrow="up",e.top=Math.max(10,e.top))},_showGuideonButton:function(e){if(e===r.LP_NEXT_GUIDE_TEXT){if("Next"!=this.$actionBtn1Elem.val())return;if(!this.options.appApi.rnaApiObj.esApi.shouldShowSFSCoachmark())return}var i={preference:"",text:e,guideType:"",guideHeight:120,important:!0},t=(this._findButtonGuide(_.bind(function(e){return e.field===this&&e.text===i.text},this)),this),s=$.extend({field:t,parent:this.$("#sfs-new-landing-page-content")},i);this._setGuidePlacement(s),this._showButtonGuide(s)},_validateEmail:function(e){var i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return i.test(e)},_setRecipientModels:function(e){var i;this.$emailTextarea.hasClass("activeEmailTextarea")?i=this.$emailTextarea.val():this.$emailCCTextarea.hasClass("activeEmailTextarea")&&(i=this.$emailCCTextarea.val()),this._setRecipientsFromText(i,e)},_removeLastEmailAddress:function(){},_onFocusOutEmailTextarea:function(e,i){var t=this.$emailTextarea.val();if((_.isUndefined(i)||!i)&&(i=this._tempFocusSeparatorChar),!_.isUndefined(i)&&i&&(t=t.replace(i,"")),this._autocompleteControl&&this._autocompleteControl.setFilter(void 0),t){var s=this._validateEmail(t);if(s){var n=$(this._emailIdTemplate({emailID:t,ariaRemoveLabel:this._getRemoveAriaLabel(t)}));this._addToEmailIdList(this.$emailIdList,n,!1),1==this.$emailIdList.children().length&&this._showGuideonButton(r.LP_NEXT_GUIDE_TEXT),this.$emailTextarea.val(""),this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_TO_ADDED])}else this._showErrorRedRibbon(t+r.LP_INVALID_EMAIL_ERROR,!1,i)}},_onKeyUpEmaiTextarea:function(e){var i=e.which?e.which:e.keyCode;13==i&&(e.preventDefault(),this._onFocusOutEmailTextarea())},_showErrorRedRibbon:function(e,i,t){this.$EmailErrorMsg.html(e),this.$EmailErrorParent.removeClass("hidden");var s=!_.isUndefined(t)&&t;s&&(this._tempFocusSeparatorChar=t),this.$closeButton.focus(),s&&(this._tempFocusSeparatorChar=void 0),i&&this.$emailBlock.css("border","1px solid red")},_onKeyDownEmailTextarea:function(e){C||(C=!0,this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_TO_EDITED]));var i=e.which?e.which:e.keyCode,t=$(".sfs-to-email-ids-list > div").length;if(8!=i&&46!=i&&t>=S)this._showErrorRedRibbon(r.LP_RECIPIENTS_LIMITS_ERROR,!1),e.preventDefault();else if(40===i)this._autocompleteControl&&this._autocompleteControl.selectDown();else if(38===i)this._autocompleteControl&&this._autocompleteControl.selectUp();else if(32===i||186===i||188===i){var s=e.key;_.defer(_.bind(function(){this._setRecipientModels(s)},this))}else if(13===i)this._autocompleteControl&&(this._autocompleteControl.makeChoice(!0)||_.defer(_.bind(function(){this._setRecipientModels()},this))),e.preventDefault();else{if(8!==i)return 13!=i;this.$emailTextarea.val()||this._removeFromEmailIdList(this.$emailIdList,!1)}},_onPasteEmailTextarea:function(e){C||(C=!0,this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_TO_EDITED]));var i=$(".sfs-to-email-ids-list > div").length;i>=S&&(this._showErrorRedRibbon(r.LP_RECIPIENTS_LIMITS_ERROR,!1),e.preventDefault())},_onInputEmailTextarea:function(){var e;this.$emailCCTextarea.removeClass("activeEmailTextarea"),this.$emailTextarea.removeClass("activeEmailTextarea");var i=this.$emailTextarea.offset(),t=this.$emailTextarea.outerHeight();this.$autocompleteBox.css("top",i.top+t+10),this.$autocompleteBox.css("left",i.left),this._autocompleteControl&&(e=this.$emailTextarea.val(),this.$emailTextarea.addClass("activeEmailTextarea"),this._autocompleteControl.setFilter(e))},_onFocusOutCCEmailTextarea:function(e,i){var t=this.$emailCCTextarea.val();if((_.isUndefined(i)||!i)&&(i=this._tempFocusSeparatorChar),!_.isUndefined(i)&&i&&(t=t.replace(i,"")),this._autocompleteControl&&this._autocompleteControl.setFilter(void 0),t){var s=this._validateEmail(t);if(s){var n=$(this._emailIdTemplate({emailID:t,ariaRemoveLabel:this._getRemoveAriaLabel(t)}));n.find("#dropdownMenu").css("display","none"),n.find(".caret").css("display","none"),this._addToEmailIdList(this.$emailIdCCList,n,!0),this.$emailCCTextarea.val(""),this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_CC_ADDED])}else this._showErrorRedRibbon(t+r.LP_INVALID_EMAIL_ERROR,!1,i)}},_onKeyUpCCEmaiTextarea:function(e){var i=e.which?e.which:e.keyCode;13==i&&(e.preventDefault(),this._onFocusOutCCEmailTextarea())},_onKeyDownCCEmailTextarea:function(e){I||(I=!0,this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_CC_EDITED]));var i=e.which?e.which:e.keyCode,t=$(".sfs-cc-email-ids-list > div").length;if(8!=i&&46!=i&&t>=E)this._showErrorRedRibbon(r.LP_CC_LIMITS_ERROR,!1),e.preventDefault();else if(40===i)this._autocompleteControl&&this._autocompleteControl.selectDown();else if(38===i)this._autocompleteControl&&this._autocompleteControl.selectUp();else if(32===i||186===i||188===i){var s=e.key;_.defer(_.bind(function(){this._setRecipientModels(s)},this))}else if(13===i)this._autocompleteControl&&(this._autocompleteControl.makeChoice(!0)||_.defer(_.bind(function(){this._setRecipientModels()},this)));else{if(8!==i)return 13!=i;this.$emailCCTextarea.val()||this._removeFromEmailIdList(this.$emailIdCCList,!0)}},_onPasteCCEmailTextarea:function(e){I||(I=!0,this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_CC_EDITED]));var i=$(".sfs-cc-email-ids-list > div").length;i>=E&&(this._showErrorRedRibbon(r.LP_CC_LIMITS_ERROR,!1),e.preventDefault())},_onInputCCEmailTextarea:function(){var e;this.$emailCCTextarea.removeClass("activeEmailTextarea"),this.$emailTextarea.removeClass("activeEmailTextarea");var i=this.$emailCCTextarea.offset(),t=this.$emailCCTextarea.outerHeight();this.$autocompleteBox.css("top",i.top+t+10),this.$autocompleteBox.css("left",i.left),this._autocompleteControl&&(e=this.$emailCCTextarea.val(),this.$emailCCTextarea.addClass("activeEmailTextarea"),this._autocompleteControl.setFilter(e))},_OnclickAddCC:function(){this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.ADD_CC_CLICKED]),this.$addCCBlock.removeClass("hidden")},_OnClickHideCC:function(){this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.HIDE_CLICKED]),this.$addCCBlock.addClass("hidden")},_closeError:function(){this.$EmailErrorParent.addClass("hidden"),this.$emailBlock.css("border","1px solid #e1e1e1")},_setRecipientsFromText:function(e,i){this.$emailTextarea.hasClass("activeEmailTextarea")?(this.$emailTextarea.val(""),this.$emailTextarea.val(e),this._onFocusOutEmailTextarea(void 0,i),this.$emailTextarea.removeClass("activeEmailTextarea")):this.$emailCCTextarea.hasClass("activeEmailTextarea")&&(this.$emailCCTextarea.val(""),this.$emailCCTextarea.val(e),this._onFocusOutCCEmailTextarea(void 0,i),this.$emailCCTextarea.removeClass("activeEmailTextarea"))},_onSelectedFileItemRemoveClick:function(e){var i=$(e.currentTarget).parents(".sfs-selected-file-item-new"),t=i.data("file");this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_removed_file",t),this._landingPageUiModel.set("user_action","removed_file"),e.stopPropagation()},_onSFSFileActionBtn1Click:function(){if(!this.$actionBtn1Elem.hasClass("disabled")){var t=this._getSelectedFilesCount();if(t>0){var s=this.$emailTextarea.val();if(s&&!this._validateEmail(s))return void this._showErrorRedRibbon(s+r.LP_INVALID_EMAIL_ERROR,!1);if(s=this.$emailCCTextarea.val(),s&&!this._validateEmail(s))return void this._showErrorRedRibbon(s+r.LP_INVALID_EMAIL_ERROR,!1);var n=this.$el.find(".sfs-to-email-ids-list").children();if(0===n.length)return void this._showErrorRedRibbon(r.LP_NO_EMAIL_ERROR,!0);if(1===n.length){var o=this.options.appApi.usersMeApi.getUserIdentity().email;if(n[0].children[1].innerText===o)return void this._showErrorRedRibbon(r.LP_ONLY_SENDER_EMAIL_ERROR,!0)}var a,l=this.$el.find(".sfs-cc-email-ids-list").children(),p=this.$(".sfs-email-id-item"),d="",h="",u="",f=this;this.options.recipients=[],$.each(p,function(e,i){if(a=i.children[1].innerText,"none"==$(i.children[0].children).eq(0).css("display")?(0!=u.length&&(u=u.concat(",")),u=u.concat(a)):$(i.children[0].children[0].children).eq(0).hasClass("signerImg")?(0!=d.length&&(d=d.concat(",")),d=d.concat(a)):(0!=h.length&&(h=h.concat(",")),h=h.concat(a)),a){var i=$.trim(a.toLowerCase());f.options.autoCCollection.add({email:i}),f.options.recipients.push(a)}}),this._landingPageUiModel.set("user_added_approver_emails",h),this._landingPageUiModel.set("user_added_signer_emails",d),this._landingPageUiModel.set("user_added_cc_emails",u),this._landingPageUiModel.set("user_action","email_list_added");var g=this.$subject.val();g=g.replace(/(\r\n|\n|\r)/gm,"\\n"),this._landingPageUiModel.set("user_added_subject",_.escape(g)),this._landingPageUiModel.set("user_action","subject_added");var S=this.$messageBody.val();S=S.replace(/(\r\n|\n|\r)/gm,"\\n"),this._landingPageUiModel.set("user_added_message",_.escape(S)),this._landingPageUiModel.set("user_action","message_added"),this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.TO_EMAIL_COUNT,n.length]),this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.CC_EMAIL_COUNT,l.length]),this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.FILE_COUNT,t]),this._handleSendClickEvent(),e.Util.isCEF()&&(this.options=_.extend({},this.options,{recipientsAreFinalized:!0})),this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){this.options.readRegistry=!1,i.opFactory.create("DesktopGettingSubscriptionLevels",this.options).run()},this))}else this._handleSelectFileClickEvent();this.$("#sfs-file-action-btn-new-1").removeClass("draw-button-focus-outline")}},_handlePrepareFormClickEvent:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","prepare_form_btn_clicked")},_handleSendClickEvent:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","send_action_btn_clicked")},_handleSelectFileClickEvent:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","select_action_btn_clicked")},_onSFSManageAgreementsBtnClick:function(){this._landingPageUiModel.clearLastUserAction(),this._landingPageUiModel.set("user_action","manage_agreements_btn_clicked")},_getRenditionUrl:function(e,i,t,s){var n=$.Deferred();return this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){var o=this.options.appApi.baseFilesUrisApi.getRenditionUri()+"assets/"+encodeURIComponent(t)+"/"+e;o+="?"+u.getClientIdQueryParam(),i&&(o+="&page="+i),s===!1&&(o+="&markup=false"),n.resolve(o)},this)),n.promise()},_loadUrl:function(i,t){var s=2200,n=$.Deferred();return this.options.appApi.rnaApi.done(function(o){o.fssApi({methodName:"getRenditionShm",methodArgs:[i,s,t]}).done(function(i){var t=new e.RNAModel(void 0,_.extend({_proxy:i,shouldCache:!1}));t.hasProperty("renditionURL")?n.resolve(t.get("renditionURL")):t.once("change:renditionURL",function(){n.resolve(t.get("renditionURL"))})})}),n.promise()},_loadDocthumbnail:function(){var e=this._landingPageUiModel.get("file_collection_visible");if(e){var i=this._getSelectedFilesCount();if(i>0){this.$docThumbnail.removeClass("hidden");var t=this._landingPageUiModel.get("selected_files"),s=t[0].get("name"),n=t[0].get("path");if(this.$currentVisibleThumbNail===n)return;this.$currentVisibleThumbNail=n;var o=a.getExtension(s),r=t[0].get("isNonPlatformFile"),l=t[0].get("assetId");if(this.$previewImage.attr("class","sfs-preview-image"),r)this._getRenditionUrl("thumbnail",0,l).then(_.bind(function(e){h.cancelPendingRequests(),this.$previewImage.attr("src",""),this.options.appApi.rnaApi.then(_.bind(function(i){i.logIn(!1).then(_.bind(function(i){if(i.get("primary_token")){var t=this.options.sfsAppUiModel;_.each(Ac.Core,function(e){e.HttpUtil.setSessionAttrs(t,i.attributes)}),h.loadImage(this.$previewImage,e,void 0,!0)}},this))},this))},this));else if("pdf"==o){var p=0,c=this;this.$previewImage.attr("src",""),this.$previewImage.attr("alt",""),this._loadUrl(p,n).then(function(e){return c.$(".sfs-preview-image").attr("src",e),c.$(".sfs-preview-image").attr("alt",s),$.Deferred().resolve().promise()})}else{var u=d.getFileInfo("",s).iconCls;this.$previewImage.attr("src",""),this.$(".sfs-recent-file").addClass("collection-thumb-view"),this.$previewImage.addClass("collection-item-thumb"),this.$previewImage.addClass(u),this.$previewImage.attr("alt","")}}else this.$docThumbnail.addClass("hidden")}else this.$docThumbnail.addClass("hidden")},_roleDropdownClick:function(e){var i=e.target,t=i.parentElement.parentElement.parentElement.getBoundingClientRect(),s=($(i).attr("class"),this.$(".sfs-email-id-item"));$.each(s,function(e,i){var t=i.children[0].children[0].children;$(t).hasClass("clicked")&&$(t).removeClass("clicked")}),this.$roleDropDown.hasClass("hidden")?(this.$roleDropDown.removeClass("hidden"),this.$roleDropDown.css("top",t.bottom),this.$roleDropDown.css("left",t.left),$(i).addClass("clicked")):(this.$roleDropDown.addClass("hidden"),$(i).removeClass("clicked")),e.stopPropagation()},_OnMouseEnterSignerBlock:function(e){$(e.currentTarget).addClass("SignerHover")},_OnMouseLeaveSignerBlock:function(e){$(e.currentTarget).removeClass("SignerHover")},_OnMouseEnterApproverBlock:function(e){$(e.currentTarget).addClass("ApproverHover")},_OnMouseLeaveApproverBlock:function(e){$(e.currentTarget).removeClass("ApproverHover")},_roleDropdownSelectSignerClick:function(e){var i=$(e)[0],t=this.$(".sfs-email-id-item");$.each(t,function(e,i){var t=i.children[0].children[0].children;$(t).hasClass("clicked")&&($(t).removeClass("clicked"),$(t).hasClass("signerImg")&&$(t).removeClass("signerImg"),$(t).hasClass("approverImg")&&$(t).removeClass("approverImg"),$(t).addClass("signerImg"))}),$(i.parentElement.parentElement).addClass("hidden")},_roleDropdownSelectApproverClick:function(e){var i=$(e)[0],t=this.$(".sfs-email-id-item");$.each(t,function(e,i){var t=i.children[0].children[0].children;$(t).hasClass("clicked")&&($(t).removeClass("clicked"),$(t).hasClass("signerImg")&&$(t).removeClass("signerImg"),$(t).hasClass("approverImg")&&$(t).removeClass("approverImg"),$(t).addClass("approverImg"))}),$(i.parentElement.parentElement).addClass("hidden")},_onSelectedEmailRemoveClick:function(e){this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.EMAIL_REMOVED]);{var i=$(e.currentTarget).parents(".sfs-email-id-item");i.data("email")}i.remove(),e.stopPropagation()},_onKeyDownSubjectTextArea:function(e){var i=e.which?e.which:e.keyCode;A||9==i||(A=!0,this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.MESSAGE_SUBJECT_EDITED]));var t=i>=37&&40>=i||8==i||46==i;if(!t&&e.target.textLength==m)return this._showErrorRedRibbon(r.LP_AGREEMENT_CHARLIMITS_ERROR,!1),void e.stopPropagation();var s;13==i&&e.preventDefault(),32==i&&(s=this.$subject.text()+" ",this.$subject.html(s)),e.stopPropagation()},_onKeyDownMessageTextArea:function(e){var i=e.which?e.which:e.keyCode;v||9==i||(v=!0,this.options.appApi.siteCatalystApi.logScEvent([c.SEND_FOR_SIG,c.MESSAGE_BODY_EDITED]));var t;13==i&&(t=this.$messageBody.text()+"\n",this.$messageBody.html(t)),32==i&&(t=this.$messageBody.text()+" ",this.$messageBody.html(t)),e.stopPropagation()},_onMouseEnterSelectedFileItem:function(e){var i=e.currentTarget,t=i.getElementsByClassName("file-remove-new");$(t).removeClass("hidden")},_onMouseLeaveSelectedFileItem:function(){var e=event.currentTarget,i=e.getElementsByClassName("file-remove-new");$(i).addClass("hidden")},_onMouseEnterEmailHelpIcon:function(){this._showGuideonButton(r.LP_HELP_ICON_TEXT)},_onMouseLeaveEmailHelpIcon:function(){this._hideButtonGuide()},_onEmailToAreaClick:function(){this.$emailTextarea.focus()},_onCCAreaClick:function(){this.$emailCCTextarea.focus()}}),i.SFSNewLandingPageView}),define("pdmplugins/esign/js/templates/es-offline-view-template",[],function(){return'<div class="es-offline-view ui-theme theme-container"><div class="icon"></div><div class="title theme-text"><%= title %></div><div class="content theme-text"><%= content %></div><button class="ok-button control-button theme-button theme-button-label" tabindex= 0><%= ok_button %></button></div>'
}),define("pdmplugins/esign/js/views/es-offline-view",["core/ac-core","pdmplugins/esign/js/ac-esign","pdmplugins/esign/js/templates/es-offline-view-template"],function(e,i,t){var s={FULL_SCREEN:0,OVERLAY:1};i.AppOfflineView=e.View.extend({_offline_display_location:19,_offline_display_context:155,initialize:function(){e.View.prototype.initialize.call(this),this._template=_.template(t),this.offlineTitle="",this.offlineContent="",this.acceptLabel="",this._offlineIPMFetched=!1},events:function(){return _.extend({},e.View.prototype.events,{"click .ok-button":"_onOKButtonClick"})},render:function(){e.View.prototype.render.call(this);var i=this.options.esOfflineUiModel,t=i.get("is_visible"),n=this.$el;return t?(this._isOfflineIPMFetched()?this._showOfflineIPMView(s.FULL_SCREEN):this._fetchOfflineIPM(),$(".ok-button").focus(),this):(n.hide(),this)},_initWrappers:function(){this.$title=this.$(".title"),this.$content=this.$(".content"),this.$ok_button=this.$(".ok-button")},_isOfflineIPMFetched:function(){return this._offlineIPMFetched},_showOfflineIPMView:function(e){e===s.FULL_SCREEN?this._showOfflineIPMViewAsFullScreen():this._showOfflineIPMViewAsOverlay()},_showOfflineIPMViewAsFullScreen:function(){var e=this.options.esOfflineUiModel,i=e.get("is_visible");i&&this.$el.show(),0===this.$el.children().length&&(this._updateFullScreenViewContent(),this._initWrappers())},_showOfflineIPMViewAsOverlay:function(){var e=this.options.appApi.dialogApi,i=this.offlineTitle,t=this.offlineContent,s=this.acceptLabel,n=this.options.appApi.dialogApi.SEVERITY_ERROR,o=e.displayHtmlAlert(n,i,t,s);o.then(_.bind(function(){this.options.esOfflineUiModel.set("user_action","okay")},this))},_markOfflineIPMFetched:function(){this._offlineIPMFetched=!0},_onOKButtonClick:function(){this.options.esOfflineUiModel.set("user_action","okay"),"send_for_sign"!==this.options.pluginId&&this.options.appApi.networkConnectivityApi.resetNetworkStatusToOnline()},_updateFullScreenViewContent:function(){this.$el.html(this._template({title:this.offlineTitle,content:this.offlineContent,ok_button:this.acceptLabel}))},_fetchOfflineIPM:function(){this.options.appApi.rnaApi.done(_.bind(function(e){e.getIPMMessage([this._offline_display_location,this._offline_display_context]).done(_.bind(function(e){this.offlineTitle=e.get("title"),this.offlineContent=e.get("content"),this.acceptLabel=this.options.acceptLabel,_.isUndefined(this.acceptLabel)&&(this.acceptLabel=e.get("acceptLabel")),this._markOfflineIPMFetched(!0),this.$el.empty(),this.render()},this))},this))}})}),define("pdmplugins/send-for-sign/js/views/sfs-app-main-view",["core/ac-core","core/utils/util","pdmplugins/esign/js/ac-esign","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/send-for-sign-content","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","pdmplugins/send-for-sign/js/constants/sfs-sc-constants","pdmplugins/send-for-sign/js/views/sfs-app-progress-view","pdmplugins/send-for-sign/js/views/sfs-send-for-sign-page-view","pdmplugins/send-for-sign/js/views/sfs-landing-page-view","pdmplugins/send-for-sign/js/views/sfs-new-landing-page-view","pdmplugins/esign/js/views/es-offline-view","core/views/plugin-content-view"],function(e,i,t,s,n,o){return s.SFSAppMainView=e.View.extend({initialize:function(){e.View.prototype.initialize.call(this),this._landingPageUiModel=this.options.sfsAppLandingPageUiModel,this._addUiModelEventListeners()},render:function(){var i=this.$el;return e.PluginContentView.prototype.render.call(this),0===i.children().length&&(i.html(_.template(n)),this._initWrappers()),this._renderChildViews(),this},_addUiModelEventListeners:function(){this.options.sfsAppUiModel.on("change:app_state_updated",this._onSFSAppStateUpdatedChange)},_onSFSAppStateUpdatedChange:function(){this.render()},_initWrappers:function(){this.$sfsLandingPage=this.$(".sfs-landing-page-container"),this.$sfsAppProgress=this.$(".sfs-app-progress-container"),this.$sfsSendForSignPage=this.$(".sfs-send-for-sign-page-container"),this.$sfsOfflinePage=this.$(".sfs-offline-view-container")},_renderChildViews:function(){if(this._landingPageUiModel.get("decidedWhichPageToShow"))this._landingPageUiModel.get("showSFSNewLandingPage")?this._renderSFSNewLandingPageView():this._renderSFSLandingPageView();else{var e=this.options.appApi.rnaApiObj.esApi.isSFSNativeLandingPageRegSet(),t=this.options.appApi.rnaApiObj.esApi.isSFSNewLandingPageIPMEnabled();if(e&&t){if(i.isAcrobat())this._landingPageUiModel.set("decidedWhichPageToShow",!0),this._renderSFSNewLandingPageView();else if(i.isReader())if(this.options.appApi.sessionApi.isSignedInReader()){var s,n={prefName:"EntitledApps"},o=!1;this.options.appApi.rnaApi.done(_.bind(function(e){e.registryAPI.getRegistryContents(n).done(_.bind(function(e){try{s=JSON.parse(e)}catch(i){}if(s){for(var t=Object.values(s).length,n=0;t>n;n++)if("CollectSignaturesApp"==s[n]){o=!0,this._landingPageUiModel.set("decidedWhichPageToShow",!0),this._renderSFSNewLandingPageView();break}o||(this._landingPageUiModel.set("showSFSNewLandingPage",!1),this._landingPageUiModel.set("decidedWhichPageToShow",!0),this._renderSFSLandingPageView())}else this._landingPageUiModel.set("showSFSNewLandingPage",!1),this._landingPageUiModel.set("decidedWhichPageToShow",!0),this._renderSFSLandingPageView()},this))},this))}else this._landingPageUiModel.set("showSFSNewLandingPage",!1),this._landingPageUiModel.set("decidedWhichPageToShow",!0),this._renderSFSLandingPageView()}else this._landingPageUiModel.set("showSFSNewLandingPage",!1),this._landingPageUiModel.set("decidedWhichPageToShow",!0),this._renderSFSLandingPageView()}this._renderSFSAppProgressView(),this._renderSFSSendForSignPageView(),this._renderSFSOfflineView()},_renderSFSLandingPageView:function(){this._renderChildView("_sfsLandingPageView",s.SFSLandingPageView,this.$sfsLandingPage)},_renderSFSNewLandingPageView:function(){this._renderChildView("_sfsNewLandingPageView",s.SFSNewLandingPageView,this.$sfsLandingPage)},_renderSFSAppProgressView:function(){this._renderChildView("_sfsAppProgressView",s.SFSAppProgressView,this.$sfsAppProgress)},_renderSFSSendForSignPageView:function(){this._renderChildView("_sfsSendForSignPageView",s.SFSSendForSignPageView,this.$sfsSendForSignPage)},_renderSFSOfflineView:function(){this._renderChildView("_sfsAppOfflineView",t.AppOfflineView,this.$sfsOfflinePage,{acceptLabel:o.SFS_OFFLINE_ACCEPT_LABEL})}}),s.SFSAppMainView}),define("pdmplugins/send-for-sign/js/views/plugin-view",["core/ac-core","pdmplugins/esign/js/ac-esign","pdmplugins/send-for-sign/js/ac-send-for-sign","core/utils/sc-analytics","pdmplugins/send-for-sign/js/views/sfs-app-main-view","core/views/plugin-content-view","plugins-common/ac-plugins"],function(e,i,t,s){var n;return t.PluginView=e.PluginContentView.extend({initialize:function(){e.PluginContentView.prototype.initialize.call(this)},render:function(){e.PluginContentView.prototype.render.call(this),this.options.sfsAppUiModel.canRunInUIMode()&&this._renderChildViews()},selectPlugin:function(){return this.options.appApi.displayApi.applyUIThemeStyles(this.$el).then(_.bind(function(){this.render()},this)),this.render(),this._startPlugin()},deselectPlugin:function(){},initPlugin:function(){return this._initPlugin()},releasePlugin:function(){e.PluginContentView.prototype.releasePlugin.call(this)},getSiteCatalystName:function(){return s.SEND_FOR_SIG},_renderChildViews:function(){this._renderSFSAppMainView()},_renderSFSAppMainView:function(){this.sfsAppMainView=this._renderChildView("_sfsAppMainView",t.SFSAppMainView,this.$el)},_initPlugin:function(){var e=this._initingPluginPromise;return e||(e=this._initingPluginPromise=t.opFactory.create("InitializingPluginOp",this.options).run()),e},_startPlugin:function(){var e=this._startingPluginPromise;return e||(e=this._startingPluginPromise=this.options.appApi.rnaApi.then(_.bind(function(){return this.$el.parent().css("overflow","hidden"),t.opFactory.create("StartingPluginOp",this.options).run().then(_.bind(function(){this._addAppApiCallbacks(),this._addUiModelEventListeners()},this))},this))),e},_addAppApiCallbacks:function(){var e=this.options.appApi;e.sessionApi.addSignedInChangeCallback(this._onSignedInChange),e.networkConnectivityApi.addNetworkConnectivtyChangeCallback(this._onNetworkConnectionChanged)},_addUiModelEventListeners:function(){var e=this.options.sfsAppUiModel;e.on("change:restart_app",_.bind(function(e,i){i&&this._resetEntirePlugin()},this))},_resetEntirePlugin:function(){this.options.sfsAppLandingPageUiModel.resetTodefaults(),this.options.autoCCollection.reset(),delete this._startingPluginPromise,delete this._initingPluginPromise,this.releasePlugin(),this.options.sfsAppUiModel.off(),this.options.sfsAppProgressUiModel.off(),this.options.sfsAppSendPageUiModel.off(),this.options.sfsAppLandingPageUiModel.off(),this.initPlugin().then(_.bind(function(){this.selectPlugin()},this))},_onSignedInChange:function(e,s){s?n||(t.sfsAppApi.handleSessionSignedIn(),t.sfsAppApi.workflowApi.handleSessionSignedIn(),t.sfsAppApi.subscriptionApi.handleSessionSignedIn(),i.esApi.authApi.handleSessionSignedIn(),n=!0):n===!0&&(t.sfsAppApi.handleSessionSignOut(),t.sfsAppApi.workflowApi.handleSessionSignOut(),t.sfsAppApi.subscriptionApi.handleSessionSignOut(),i.esApi.authApi.handleSessionSignOut(),this._resetEntirePlugin(),n=!1)},_onNetworkConnectionChanged:function(e,s){s||(t.sfsAppApi.handleNetworkDisconnectedEvent(),t.sfsAppApi.workflowApi.handleNetworkDisconnectedEvent(),t.sfsAppApi.subscriptionApi.handleNetworkDisconnectedEvent(),i.esApi.authApi.handleNetworkDisconnectedEvent())}}),t.PluginView}),define("pdmplugins/send-for-sign/js/models/sfs-autocomplete-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","core/models/model"],function(e,i){return i.AutocompleteModel=e.Model.extend({idAttribute:"email",initialize:function(i,t){e.Model.prototype.initialize.call(this,i,t),this.rootUrl="",t.collection&&(this.rootUrl=t.collection.rootUrl),t.rootUrl&&(this.rootUrl=t.rootUrl)},url:function(){return this.rootUrl+"a/api/autoc/emails"}}),i.AutocompleteModel}),define("pdmplugins/send-for-sign/js/collections/sfs-autocomplete-collection",["pdmplugins/send-for-sign/js/ac-send-for-sign","core/utils/http-util","pdmplugins/send-for-sign/js/models/sfs-autocomplete-model"],function(e,i){return e.AutocompleteCollection=Backbone.Collection.extend({model:e.AutocompleteModel,initialize:function(e,i){Backbone.Collection.prototype.initialize.call(this,e,i),this.rootUrl=i.rootUrl,this.set({models:[]})},url:function(){return this.rootUrl+"/a/api/autoc/email"},fetch:function(e){return e=i.customizeOptions("GET",e),Backbone.Collection.prototype.fetch.call(this,e)},fetchNext:function(){var e={};return this.next_context&&(e.data=_.extend({},{context:this.next_context,sofar:this.length},e.data)),e.global=!1,e.remove=!1,this.fetch(e)},fetchAll:function(){this.fetchNext().then(_.bind(this.fetchComplete,this))},fetchComplete:function(){this.next_context&&this.fetchAll()},parse:function(e){e.emails;return this.next_context=e.next_context,e.emails},setRUrl:function(e){this.rootUrl=e}}),e.AutocompleteCollection}),define("pdmplugins/send-for-sign/js/constants/sfs-constants",{API_SUBPATH_NEW:"/api/rest/v5",API_SUBPATH_OLD:"/api/rest/v3",ERROR_BODY_MAX_WIDTH:40,SUPPORTED_EXTENSIONS:["pdf","doc","docx","rtf","xls","xlsx","ppt","pptx","txt","html","htm","tiff","tif","bmp","gif","jpg","jpeg","png"],MIMETYPES:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/html","text/html","image/tiff","image/tiff","image/bmp","image/gif","image/jpeg","image/jpeg","image/png","application/msexcel","text/rtf"]}),define("pdmplugins/send-for-sign/js/constants/sfs-error-codes",{PDFIsPortfolio:0,PDFIsPasswordProtected:1,PDFIsCertificateProtected:2,PDFIsPolicyProtected:3,PDFIsDynamicXFA:4,PDFIsOfInvalidType:5,InvalidFileExtn:6,GeneralWorkflowError:7,LargeFileSize:8,SendPageSessionTimeOut:9,EnterpriseServiceAccessDenied:10,PrepareFormsMultipleFilesSelect:11,ESAutoLoginDenied:12,MultipleWorkflowsRunning:13,CombineFilesFailed:14}),define("pdmplugins/send-for-sign/js/api/sfs-workflow-api",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-constants","core/utils/file-types","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","pdmplugins/send-for-sign/js/constants/sfs-error-codes","pdmplugins/esign/js/ac-esign","pdmplugins/send-for-sign/js/constants/sfs-sc-constants","core/apis/api"],function(e,i,t,s,n,o,r,a){var l=r.UploadDocumentToEchoSignOp.prototype.UPLOAD_STATES;return i.SFSWorkflowApi=e.Api.extend({initialize:function(){e.Api.prototype.initialize.call(this),this._initStateMachine(),this._initializeOperationMap()},startWorkflow:function(e){e.workflowUiModel.set("workflow_id",_.uniqueId("sfs_workflow")),this._fsm.handleEvent("StartWorkflow",e)},abortWorkflow:function(e){this._fsm.handleEvent("AbortWorkflow",e)},handleSessionSignOut:function(){this._fsm.handleEvent("SessionSignOut",_.extend({},this.options))},handleSessionSignedIn:function(){this._fsm.handleEvent("SessionSignedIn",_.extend({},this.options))},showFileBrowseDlg:function(){var e=$.Deferred(),i=_.extend({fileBrowseDlgPromise:e},this.options);return this._fsm.handleEvent("ShowFileBrowseDlg",i),e},handleNetworkDisconnectedEvent:function(){this._fsm.handleEvent("NetworkDisconnectedEvent",_.extend({},this.options))},_initStateMachine:function(){var e=_.extend({controller:this},this.options);this._fsm=i.fsmFactory.create("SFSWorkflowFSM",e)},_initializeOperationMap:function(){this._opMap=this._opMap||{},this._opMap.ShowAppLandingPageOp=this._showAppLandingPage,this._opMap.HideAppLandingPageOp=this._hideAppLandingPage,this._opMap.CheckESUserSubscriptionOp=this._checkESUserSubscriptionStatus,this._opMap.FetchActiveDocumentOp=this._fetchActiveDocument,this._opMap.ShowFileSelectionDlgOp=this._showFileSelectionDlg,this._opMap.NotifyDlgFilesSelectedToClientsOp=this._notifyDlgFilesSelectedToClients,this._opMap.NotifyDlgFilesNotSelectedToClientsOp=this._notifyDlgFilesNotSelectedToClients,this._opMap.ValidateSelectedFilesOp=this._validateSelectedFiles,this._opMap.CreateESAuthSessionOp=this._createESAuthSession,this._opMap.CreateUploadRequestsQueueOp=this._createUploadRequestsQueue,this._opMap.StartUploadRequestForAllFilesOp=this._startUploadRequestForAllFiles,this._opMap.CancelUploadOp=this._cancelUpload,this._opMap.UploadFileToEchoSignOp=this._uploadFileToEchoSign,this._opMap.NotifyUploadStartedOp=this._notifyUploadStarted,this._opMap.ListenForUploadProgressEventsOp=this._listenForUploadProgressEvents,this._opMap.NotifyUploadProgressOp=this._notifyUploadProgress,this._opMap.ProcessUploadFinishedResultOp=this._processUploadFinishedResult,this._opMap.NotifyUploadSuccessOp=this._notifyUploadSuccess,this._opMap.NotifyUploadFailureOp=this._notifyUploadFailure,this._opMap.FetchSendForSignaturePageUrlOp=this._fetchSendForSignaturePageUrl,this._opMap.NotifySendUrlFetchSuccessOp=this._notifySendUrlFetchSuccess,this._opMap.OpenSendForSignPageInAppOp=this._openSendForSignPageInApp,this._opMap.HandleOpenSendPageSuccessOp=this._handleOpenSendPageSuccess,this._opMap.ListenForSendPageEventsOp=this._listenForSendPageEvents,this._opMap.FetchManageAgreementsURLOp=this._fetchManageAgreementsURL,this._opMap.LaunchManageAgreementsURLOp=this._launchManageAgreementsURL,this._opMap.RestartWorkflowOp=this._restartWorkflow,this._opMap.NotifyWorkflowFailureOp=this._notifyWorkflowFailure,this._opMap.NotifyWorkflowSuccessOp=this._notifyWorkflowSuccess,this._opMap.SetSFSWorkflowInProgressOp=this._setSFSWorkflowInProgress,this._opMap.ClearSFSWorkflowInProgressOp=this._clearSFSWorkflowInProgress,this._opMap.ClearESAuthSessionOp=this._clearESAuthSession,this._opMap.ShowWaitCursorOp=this._showWaitCursor,this._opMap.HideWaitCursorOp=this._hideWaitCursor,this._opMap.FetchPrepareFormRecipientsOp=this._getRecipientsIDs,this._opMap.ShowWorkflowErrorMsgOp=this._showWorkflowErrorMsg},_invokeOperation:function(e){var i=e.opName;if(this._opMap){var t=this._opMap[i];t.call(this,e)}},_showAppLandingPage:function(e){var i=this.options.appApi.sfsAppApi;i.showAppLandingPage(e).then(_.bind(function(i){e.workflowSelectedFiles=i.selectedFiles,this._fsm.handleEvent("FileSelectedInLandingPage",e)},this),_.bind(function(){this._fsm.handleEvent("ErrorOccuredInLandingPage",e)},this))},_hideAppLandingPage:function(e){this.options.appApi.sfsAppApi.hideAppLandingPage(e)},_checkESUserSubscriptionStatus:function(e){var i=this.options.appApi.sfsAppApi;i.evaluateSubscriptionStatus(e).then(_.bind(function(){this._fsm.handleEvent("ESUserFoundPaid",e)},this),_.bind(function(){this._fsm.handleEvent("ESUserFoundFree",e)},this))},_fetchActiveDocument:function(e){this.options.appApi.rnaApi.done(_.bind(function(i){var t=i.getOpenedFile();_.isEmpty(t)?this._fsm.handleEvent("ActiveDocNotFound",e):(e.workflowSelectedFiles=[],e.workflowSelectedFiles.push(t),this._fsm.handleEvent("ActiveDocFound",e))},this))},_showFileSelectionDlg:function(e){var i={windowTitle:n.FILE_SELECT_TITLE,actionButton:n.FILE_SELECT_ACTION_BTN,filterDesc:"",allowMultiple:!0,chooseFolder:!1,allowNewFolder:!1,extnList:t.SUPPORTED_EXTENSIONS,mimeTypes:t.MIMETYPES,showCustomOpenDialog:!0};this.options.appApi.rnaApi.done(_.bind(function(t){t.selectFiles(i).then(_.bind(function(i){e.dlgSelectedFiles=[];var t=i.uploadedFileAttrs,s=i.localFiles;_.isEmpty(t)||(e.dlgSelectedFiles=e.dlgSelectedFiles.concat(_.values(t))),_.isEmpty(s)||(e.dlgSelectedFiles=e.dlgSelectedFiles.concat(s)),_.isEmpty(e.dlgSelectedFiles)?this._fsm.handleEvent("FilesNotSelected",e):this._fsm.handleEvent("FilesAreSelected",e)},this),_.bind(function(){this._fsm.handleEvent("FilesNotSelected",e)},this))},this))},_notifyDlgFilesSelectedToClients:function(e){_.isEmpty(e.fileBrowseDlgPromise)||e.fileBrowseDlgPromise.resolve(e.dlgSelectedFiles)},_notifyDlgFilesNotSelectedToClients:function(e){_.isEmpty(e.fileBrowseDlgPromise)||e.fileBrowseDlgPromise.reject()},_validateSelectedFiles:function(e){return _.isEmpty(e.filesToValidate)?void this._fsm.handleEvent("InvalidFilesSelected",e):void i.opFactory.create("SFSFilesValidatorOp",_.extend({inputFiles:e.filesToValidate},this.options)).run().then(_.bind(function(i,t){e.validFiles=i,e.invalidFiles=t,this._fsm.handleEvent("FilesValidationComplete",e)},this))},_createESAuthSession:function(e){var i=r.esApi.authApi,t=i.createAuthSession(e);t.then(_.bind(function(){this._fsm.handleEvent("ESAuthSessionCreateSuccess",e)},this),_.bind(function(){this._fsm.handleEvent("ESAuthSessionCreateFailure",e)},this))},_createUploadRequestsQueue:function(e){var i,t=e.workflowUiModel;i=_.map(e.workflowSelectedFiles,_.bind(function(e,i){return{file:e,fileIdx:i,responseObj:{},progressObj:{},bytesUploaded:0,bytesTotal:0,uploadStatus:""}},this)),t.set("upload_req_queue",i)},_startUploadRequestForAllFiles:function(e){var i=e.workflowUiModel,t=i.get("upload_req_queue");this.options.appApi.siteCatalystApi.logScEvent([a.TOOLS,a.SEND_FOR_SIG,a.CONVERSION,a.UPLOAD_STARTED,a.OPERATION]),_.each(t,_.bind(function(i){e.currentFileUploadReq=i,this._fsm.handleEvent("BeginNextFileUpload",e)},this))},_cancelUpload:function(){r.opFactory.create("CancelUploadToEchoSignOp",this.options).run()},_uploadFileToEchoSign:function(e){var i,n=e.currentFileUploadReq,o=n.file;i=this.options.sfsAppLandingPageUiModel.get("showSFSNewLandingPage")?t.API_SUBPATH_NEW:t.API_SUBPATH_OLD,this.options.appApi.rnaApi.done(_.bind(function(t){var a=t.esApi.getEchoSignServiceParams(),p=a.apiURL,d=this.options.esAuthUiModel,c=d.get("access_token"),h=o.get("ext").toLowerCase(),u=s.getFileMimeType(h),f=_.extend({docToUpload:o,esAccessToken:c,esUploadEndpoint:p+i+"/transientDocuments",mimeType:u},this.options);r.opFactory.create("UploadDocumentToEchoSignOp",f).run().then(_.bind(function(i){n.responseObj=i,n.progressObj=i.progressObj,e.currentFileUploadReq=n;var t=i.status;t===l.STARTED?this._fsm.handleEvent("UploadStarted",e):t===l.FINISHED?this._fsm.handleEvent("UploadFinished",e):t===l.QUEUED&&this._fsm.handleEvent("UploadQueued",e)},this),_.bind(function(i){n.responseObj=i,e.currentFileUploadReq=n,this._fsm.handleEvent("UploadFinished",e)},this))},this))},_listenForUploadProgressEvents:function(e){var i,t,s=e.currentFileUploadReq,n=s.responseObj,o=s.progressObj;i=r.uiModelFactory.create("ESDocUploadProgressUiModel",this.options),i.set("upload_response",n),i.set("progress_obj",o),i.on("all",_.bind(function(n){if("change"!==n)switch(t=i.get("progress_status"),e.currentFileUploadReq=s,t){case"ongoing":s.bytesUploaded=i.get("bytes_uploaded"),s.bytesTotal=i.get("bytes_total"),this._fsm.handleEvent("UploadProgress",e);break;case"finished":s.responseObj=i.get("upload_response"),this._fsm.handleEvent("UploadFinished",e)}},this)),r.opFactory.create("ListeningForESDocUploadProgressEventsOp",_.extend({esDocUploadProgressUiModel:i},this.options)).run()},_processUploadFinishedResult:function(e){var i=e.currentFileUploadReq,t=i.responseObj;t.errorSet?this._fsm.handleEvent("UploadFailure",e):this._fsm.handleEvent("UploadSuccess",e),delete e.esDocUploadProgressUiModel},_notifyUploadStarted:function(e){this._notifyWorkflowStatus(e,{name:"upload_started",isVisible:!0})},_notifyUploadProgress:function(e){var i=e.workflowUiModel,t=i.get("upload_req_queue"),s=0,n=t.length,o=e.currentFileUploadReq;o.uploadStatus="progress",_.each(t,_.bind(function(e){("progress"===e.uploadStatus||"success"===e.uploadStatus)&&(s+=e.bytesUploaded/e.bytesTotal)},this),0),s/=n,this._notifyWorkflowStatus(e,{name:"upload_progress",isVisible:!0,progressPercentage:100*s})},_notifyUploadSuccess:function(e){var i,t=e.workflowUiModel,s=t.get("upload_req_queue"),n=e.currentFileUploadReq;n.uploadStatus="success",i=_.every(s,_.bind(function(e){return"success"===e.uploadStatus},this)),i&&(this.options.appApi.siteCatalystApi.logScEvent([a.TOOLS,a.SEND_FOR_SIG,a.CONVERSION,a.UPLOAD_COMPLETE,a.OPERATION]),this._notifyWorkflowStatus(e,{name:"upload_success",isVisible:!0,progressPercentage:100}),this._fsm.handleEvent("FetchPrepareFormRecipients",e),this.options.appApi.siteCatalystApi.logScEvent([a.TOOLS,a.SEND_FOR_SIG,a.CONVERSION,a.FETCH_SEND_PG_URL,a.OPERATION]))},_notifyUploadFailure:function(e){var i=e.currentFileUploadReq,t=i.responseObj;i.uploadStatus="failure",this.options.appApi.siteCatalystApi.logScEvent([a.TOOLS,a.SEND_FOR_SIG,a.CONVERSION,a.UPLOAD_ERROR,a.OPERATION]),this._notifyWorkflowStatus(e,{name:"upload_failure",isVisible:!1,errorCode:t.uploadErrorCode})},_notifyWorkflowStatus:function(e,i){var t=e.workflowUiModel;t.set("workfow_status",i)},_fetchSendForSignaturePageUrl:function(e){var t,s=e.workflowUiModel,n=s.get("upload_req_queue"),o=n.length,r=n[0].file.get("name");return t=_.map(n,function(e){return e.responseObj&&e.responseObj.respBody?e.responseObj.respBody.transientDocumentId:void 0}),t=_.compact(t),_.isEmpty(t)||t.length<o?void this._fsm.handleEvent("SendUrlFetchFailure",e):void i.opFactory.create("FetchSendForSignPageUrlOp",_.extend({transientDocumentIds:t,agreementName:r,recipientIDs:e.recipients,signerRecipients:e.signerEmailIDS,approverRecipients:e.approverEmailIDS,CCRecipients:e.ccemailIDS,agreementNameModified:e.subject,agreementMessages:e.message},this.options)).run().then(_.bind(function(i){e.sendPageResponse=i,this._fsm.handleEvent("SendUrlFetchSuccess",e)},this),_.bind(function(i){e.sendUrlFetchHttpCode=i.httpRespCode,e.sendUrlFetchRespBody=i.httpRespBody,this._fsm.handleEvent("SendUrlFetchFailure",e)},this))},_notifySendUrlFetchSuccess:function(e){this._notifyWorkflowStatus(e,{name:"send_url_fetch_success",isVisible:!0,progressPercentage:100}),this.options.appApi.siteCatalystApi.logScEvent([a.SEND_FOR_SIG,a.FETCH_SEND_PG_URL,a.SUCCESS])},_openSendForSignPageInApp:function(e){if(!e.sendPageResponse||!e.sendPageResponse.url)return void this._fsm.handleEvent("OpenSendPageFailure",e);var t=e.sendPageResponse.url;return _.isEmpty(t)?void this._fsm.handleEvent("OpenSendPageFailure",e):void i.opFactory.create("OpenSendForSignPageInAppOp",_.extend({sendPageUrl:t},e)).run().then(_.bind(function(){this._fsm.handleEvent("OpenSendPageSuccess",e)},this),_.bind(function(){this._fsm.handleEvent("OpenSendPageFailure",e)},this))},_handleOpenSendPageSuccess:function(e){this.options.appApi.siteCatalystApi.logScEvent([a.SEND_FOR_SIG,a.OPEN_SEND_PAGE_IN_APP,a.SUCCESS]);var i=e.workflowUiModel;this._notifyWorkflowStatus(e,{name:"open_send_page_success",isVisible:!0,progressPercentage:100}),_.delay(_.bind(function(){this._notifyWorkflowStatus(e,{isVisible:!1}),i.set("send_page_status",{isVisible:!0})},this),250)},_listenForSendPageEvents:function(e){var t,s=i.uiModelFactory.create("SFSEchoSignWebPageUiModel");i.opFactory.create("ListenForSendPageEventsOp",{sfsESWebPageUIModel:s}).run(),s.on("change:eventData",_.bind(function(i,s){_.isEmpty(s)||(e.sendPageEventData=s.data,"CLICK"===s.type?(t=s.data.pageName,_.isEmpty(s.data)||"POST_SEND"!==t&&"POST_SIGN"!==t||(this.options.appApi.siteCatalystApi.logScEvent([a.SEND_FOR_SIG,a.POST_SEND_PAGE,a.CLICKED]),this._fsm.handleEvent("PostSendPageClickEvent",e))):"PAGE_LOAD"===s.type?_.isEmpty(s.data)||(e.sendPageName=s.data.pageName,"POST_SEND"===s.data.pageName?(this.options.appApi.siteCatalystApi.logScEvent([a.SEND_FOR_SIG,a.POST_SEND_PAGE,a.LOADED]),this._fsm.handleEvent("PostSendPageLoadEvent",e)):"AUTHORING"===s.data.pageName&&this._fsm.handleEvent("AuthoringSendPageLoadEvent",e)):"SESSION_TIMEOUT"===s.type?(this.options.appApi.siteCatalystApi.logScEvent([a.SEND_FOR_SIG,a.POST_SEND_PAGE,a.SESSION_TIMEOUT]),this._fsm.handleEvent("SendPageSessionTimeOutEvent",e)):"ERROR"===s.type&&(this.options.appApi.siteCatalystApi.logScEvent([a.SEND_FOR_SIG,a.POST_SEND_PAGE,a.ERROR]),this._fsm.handleEvent("SendPageErrorEvent",e)))},this))},_fetchManageAgreementsURL:function(e){var t=e.agreementId,s=_.extend({agreementId:t},this.options);i.opFactory.create("FetchManageAgreementsURLOp",s).run().then(_.bind(function(i){e.manageAgreementsURL=i.viewURL,this._fsm.handleEvent("FetchManageAgreementURLSuccess",e)},this),_.bind(function(){this._fsm.handleEvent("FetchManageAgreementURLFailure",e)},this))},_launchManageAgreementsURL:function(e){this.options.appApi.rnaApi.done(_.bind(function(i){i.ipmApi({methodName:"executeURI",methodArgs:e.manageAgreementsURL})},this))},_restartWorkflow:function(){this.options.appApi.sfsAppApi.restartApp()},_notifyWorkflowFailure:function(e){this._notifyWorkflowStatus(e,{name:"workflow_failure"})},_notifyWorkflowSuccess:function(){},_setSFSWorkflowInProgress:function(){this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.setSFSWorkflowInProgress(!0)},this))},_clearSFSWorkflowInProgress:function(){this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.setSFSWorkflowInProgress(!1)},this))},_clearESAuthSession:function(){r.esApi.authApi.clearESAuthSession()},_showWaitCursor:function(){this.options.appApi.sfsAppApi.showWaitCursor()},_hideWaitCursor:function(){this.options.appApi.sfsAppApi.hideWaitCursor()},_showWorkflowErrorMsg:function(e){var i=e.errorOptions,t=this.options.appApi.sfsAppApi;t.showErrorMessage(i),i.appErrorPromise.always(_.bind(function(){this._fsm.handleEvent("ErrorDialogDismissed",e)},this))},_getRecipientsIDs:function(e){this.options.appApi.rnaApi.done(_.bind(function(i){i.esApi.prepareFormsEmailRecipients().then(_.bind(function(i){e.recipients=i.length>0?i:"",e.signerRecipients=e.signerEmailIDS,e.approverRecipients=e.approverEmailIDS,e.CCRecipients=e.ccemailIDS,e.agreementNameModified=e.subject,e.agreementMessages=e.message,this._fsm.handleEvent("FetchSendForSignPageUrl",e)},this),_.bind(function(){e.recipients="",e.signerRecipients="",e.approverRecipients="",e.CCRecipients="",e.agreementNameModified="",e.agreementMessages=""},this))},this),_.bind(function(){e.recipients="",e.signerRecipients="",e.approverRecipients="",e.CCRecipients="",e.agreementNameModified="",e.agreementMessages=""},this))}}),i.SFSWorkflowApi}),define("pdmplugins/send-for-sign/js/api/sfs-subscription-api",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/esign/js/ac-esign","core/utils/util","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","pdmplugins/send-for-sign/js/constants/sfs-sc-constants","core/apis/api"],function(e,i,t,s,n,o){return i.SFSSubscriptionApi=e.Api.extend({initialize:function(){e.Api.prototype.initialize.call(this),this._initStateMachine(),this._initializeOperationMap(),this._subscriptionStatusClients=[]},checkSubscriptionStatus:function(e){var i=$.Deferred(),t={promise:i},s=_.extend({},e,this.options);return this._subscriptionStatusClients.push(t),this._fsm.handleEvent("EvaluateSubscriptionStatus",s),i},handleSessionSignOut:function(){this._fsm.handleEvent("SessionSignOut",_.extend({},this.options))},handleSessionSignedIn:function(){this._fsm.handleEvent("SessionSignedIn",_.extend({},this.options))},handleNetworkDisconnectedEvent:function(){this._fsm.handleEvent("NetworkDisconnectedEvent",_.extend({},this.options))},_initStateMachine:function(){var e=_.extend({controller:this},this.options);this._fsm=i.fsmFactory.create("SFSSubscriptionFSM",e)},_initializeOperationMap:function(){this._opMap=this._opMap||{},this._opMap.EvaluateIMSUserLoginStatusOp=this._evaluateIMSUserLoginStatus,this._opMap.CreateIMSAuthSessionOp=this._createIMSAuthSession,this._opMap.UpdateIMSAuthSessionOp=this._updateIMSAuthSession,this._opMap.ShowWaitCursorOp=this._showWaitCursor,this._opMap.HideWaitCursorOp=this._hideWaitCursor,this._opMap.FetchESUserSubscriptionStatusOp=this._fetchESUserSubscriptionStatus,this._opMap.ShowSubscribePageESUserSignedInOp=this._showSubscribePageESUserSignedIn,this._opMap.ShowSubscribePageESUserNotSignedInOp=this._showSubscribePageESUserNotSignedIn,this._opMap.ShowSubscribePageESUserSignedInAndUpgradeClickedOp=this._showSubscribePageESUserSignedInAndUpgradeClicked,this._opMap.NotifyESUserGotPaidSubscriptionOp=this._notifyESUserGotPaidSubscription,this._opMap.NotifyESUserGotFreeSubscriptionOp=this._notifyESUserGotFreeSubscription,this._opMap.LaunchSubscribeWebPageOp=this._launchSubscribeWebPage,this._opMap.CheckIfUserOfEnterpriseTypeOp=this._checkIfUserOfEnterpriseType,this._opMap.ShowSubscriptionErrorMsgOp=this._showSubscriptionErrorMsg,this._opMap.ClearSFSWorkflowInProgressOp=this._clearSFSWorkflowInProgress},_invokeOperation:function(e){var i=e.opName;if(this._opMap){var t=this._opMap[i];t.call(this,e)}},_evaluateIMSUserLoginStatus:function(e){this.options.appApi.sessionApi.isSignedInReader()?this._fsm.handleEvent("IMSUserSignedIn",e):this._fsm.handleEvent("IMSUserNotSignedIn",e)},_createIMSAuthSession:function(e){this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){this._fsm.handleEvent("IMSAuthSessionCreateSuccess",e)},this),_.bind(function(i){i&&"NoAccessToPdfServices"===i.errorString?this._fsm.handleEvent("IMSAuthSessionCreateSuccess",e):this._fsm.handleEvent("IMSAuthSessionCreateFailure",e)},this))},_updateIMSAuthSession:function(e){this.options.appApi.sessionApi.ensureSignedIn().then(_.bind(function(){this._fsm.handleEvent("IMSSessionUpdateSuccess",e)},this),_.bind(function(i){i&&"NoAccessToPdfServices"===i.errorString?this._fsm.handleEvent("IMSSessionUpdateSuccess",e):this._fsm.handleEvent("IMSSessionUpdateFailure",e)},this))},_showWaitCursor:function(){var e=this.options.sfsSubscribeUiModel,i=e.get("wait_cursor_visible");i||this.options.appApi.rnaApi.done(_.bind(function(i){i.invokeMethod({methodName:"showWaitCursor",methodArgs:!0}),e.set("wait_cursor_visible",!0,{silent:!0})},this))},_hideWaitCursor:function(){var e=this.options.sfsSubscribeUiModel,i=e.get("wait_cursor_visible");i&&this.options.appApi.rnaApi.done(_.bind(function(i){i.invokeMethod({methodName:"showWaitCursor",methodArgs:!1}),e.set("wait_cursor_visible",!1,{silent:!0})
},this))},_fetchESUserSubscriptionStatus:function(e){function i(i){var t=i?"ESUserFoundPaid":"ESUserFoundFree";this._fsm.handleEvent(t,e)}t.opFactory.create("FetchESUserSubscriptionInfoOp",this.options).run().then(_.bind(function(e){i.call(this,e)},this),_.bind(function(){this._fsm.handleEvent("ESSubscriptionError",e)},this))},_showSubscribePageESUserSignedIn:function(e){var i=this.options.sfsSubscribeUiModel;i.set("visible_btn_name","upgrade"),this.options.appApi.siteCatalystApi.logScEvent([o.TOOLS,o.SEND_FOR_SIG,o.UPSELL_PAGE,o.SHOWN]),this._showESSubscribePage(e)},_showSubscribePageESUserNotSignedIn:function(e){var i=this.options.sfsSubscribeUiModel;i.set("visible_btn_name","sign_in"),this.options.appApi.siteCatalystApi.logScEvent([o.TOOLS,o.SEND_FOR_SIG,o.UPSELL_PAGE,o.SHOWN]),this._showESSubscribePage(e)},_showSubscribePageESUserSignedInAndUpgradeClicked:function(e){var i=this.options.sfsSubscribeUiModel;i.set("visible_btn_name","start_now"),this._showESSubscribePage(e)},_showESSubscribePage:function(e){i.opFactory.create("ShowSFSSubscribePageOp",_.extend({parentView:e.parentView},this.options)).run(),this.options.sfsSubscribeUiModel.on("change:user_action",_.bind(function(i,t){switch(this.options.sfsSubscribeUiModel.off("change:user_action"),this.options.sfsSubscribeUiModel.reset(),t){case"sign_in_clicked":this.options.appApi.siteCatalystApi.logScEvent([o.TOOLS,o.SEND_FOR_SIG,o.UPSELL_PAGE,o.SIGN_IN,o.CLICKED]),this._fsm.handleEvent("UserClickedSignIn",e);break;case"upgrade_clicked":this.options.appApi.siteCatalystApi.logScEvent([o.TOOLS,o.SEND_FOR_SIG,o.UPSELL_PAGE,o.UPGRADE,o.CLICKED]),this._fsm.handleEvent("UserClickedUpgradeNow",e);break;case"start_now_clicked":this.options.appApi.siteCatalystApi.logScEvent([o.TOOLS,o.SEND_FOR_SIG,o.UPSELL_PAGE,o.START,o.CLICKED]),this._fsm.handleEvent("UserClickedStartNow",e);break;case"cancel_clicked":this._fsm.handleEvent("UserClickedCancel",e)}},this))},_notifyESUserGotPaidSubscription:function(){_.each(this._subscriptionStatusClients,function(e){e.promise.resolve()})},_notifyESUserGotFreeSubscription:function(){_.each(this._subscriptionStatusClients,function(e){e.promise.reject()})},_launchSubscribeWebPage:function(){var e;s.isAcrobat()?e=n.SFS_ACRO_UPDGRADE_GO_URL:this.options.appApi.rnaApi.done(_.bind(function(i){e=i.rnaServicesAPI.isSFSUpsellExperimentEnabled()===!0?n.SFS_RDR_UPGRADE_GO_URL_RDREXP:n.SFS_RDR_UPGRADE_GO_URL,_.isEmpty(e)||i.openDecoratedUrl(e)},this))},_checkIfUserOfEnterpriseType:function(e){var i,t=this.options.appApi.options.usersMeModel.get("identity");_.isUndefined(t)||(i=t.account_type),"adobeid"!==i?this._fsm.handleEvent("EnterpriseUser",e):this._fsm.handleEvent("NotAnEnterpriseUser",e)},_showSubscriptionErrorMsg:function(e){var i=e.errorOptions,t=this.options.appApi.sfsAppApi;t.showErrorMessage(i),i.appErrorPromise.always(_.bind(function(){this._fsm.handleEvent("ErrorDialogDismissed",e)},this))},_clearSFSWorkflowInProgress:function(){this.options.appApi.rnaApi.done(_.bind(function(e){e.esApi.setSFSWorkflowInProgress(!1)},this))}}),i.SFSSubscriptionApi}),define("pdmplugins/send-for-sign/js/api/sfs-error-api",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","core/utils/css-util","core/apis/api"],function(e,i,t,s){return i.SFSErrorApi=e.Api.extend({initialize:function(){e.Api.prototype.initialize.call(this),this._initStateMachine(),this._initializeOperationMap(),this._runningWorkflows={},this._isShowingError=!1},showErrorMessage:function(e){var i=e.errorType;return e.errorPromise=$.Deferred(),this._isShowingError?e.errorPromise.reject():this._fsm.handleEvent(i,e),e.errorPromise},hideErrorMessage:function(){this._fsm.handleEvent("HideErrorDialog",this.options),this._hideOpaqueOverlay()},_initStateMachine:function(){var e=_.extend({controller:this},this.options);this._fsm=i.fsmFactory.create("SFSErrorFSM",e)},_initializeOperationMap:function(){this._opMap=this._opMap||{},this._opMap.ShowGenericErrorDialogOp=this._showGenericErrorDialog,this._opMap.HideGenericErrorDialogOp=this._hideGenericErrorDialog},_invokeOperation:function(e){var i=e.opName;if(this._opMap){var t=this._opMap[i];t.call(this,e)}},_hideGenericErrorDialog:function(e){this._isShowingError=!1,delete e.titleTag,delete e.bodyTag,delete e.closeTag},_showGenericErrorDialog:function(e){this._isShowingError=!0;var i,t,n,o=this.options.appApi.dialogApi,r=e.titleTag,a=e.bodyTag,l=e.closeTag,p=this.options.appApi.dialogApi.SEVERITY_ERROR,d=e.showOpaqueOverlay,c=o.displayHtmlAlert(p,r,a,l);c.always(_.bind(function(){e.errorPromise.resolve()},this)),i=$(".alert-dialog-container .generic-dialog"),d&&this._showOpaqueOverlay(),_.isUndefined(e.width)||(i.width(e.width),t=i.width()+s.getPaddingWidth(i),i.css("margin-left",-t/2)),_.isUndefined(e.height)||(i.height(e.height),n=i.height()+s.getPaddingHeight(i),i.css("margin-top",-n/2))},_showOpaqueOverlay:function(){$(".alert-dialog-container").append('<div class="sfs-error-opaque-container"></div>'),$(".alert-dialog-container").append('<div class="sfs-error-opaque-container overlay"></div>')},_hideOpaqueOverlay:function(){$(".sfs-error-opaque-container").remove()}}),i.SFSErrorApi}),define("pdmplugins/send-for-sign/js/api/sfs-app-api",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-sc-constants","core/utils/util","core/apis/api","pdmplugins/send-for-sign/js/api/sfs-workflow-api","pdmplugins/send-for-sign/js/api/sfs-subscription-api","pdmplugins/send-for-sign/js/api/sfs-error-api"],function(e,i,t,s){return i.SFSAppApi=e.Api.extend({initialize:function(){e.Api.prototype.initialize.call(this),this._createSubApis(),this._initStateMachine(),this._initializeOperationMap(),this._runningWorkflows={}},startWorkflow:function(e){var i=$.Deferred();return e=_.extend({},e,{promise:i}),this._fsm.handleEvent("AppStartNewWorkflow",{workflowOptions:e}),e},handleSessionSignOut:function(){this._fsm.handleEvent("AppSessionSignOut",_.extend({},this.options))},handleSessionSignedIn:function(){this._fsm.handleEvent("SessionSignedIn",_.extend({},this.options))},handleNetworkDisconnectedEvent:function(){this._fsm.handleEvent("AppNetworkDisconnectedEvent",_.extend({},this.options))},evaluateSubscriptionStatus:function(e){var i=$.Deferred();return e=_.extend(e,{appESSubscriptionPromise:i}),this._fsm.handleEvent("AppEvaluateESUserSubscription",e),i},showAppLandingPage:function(e){var i=$.Deferred();return e=_.extend(e,{appLandingPagePromise:i,appApi:this.options.appApi}),this._fsm.handleEvent("AppShowLandingPage",e),i},hideAppLandingPage:function(e){this._fsm.handleEvent("AppHideLandingPage",e)},showWaitCursor:function(){this._fsm.handleEvent("ShowWaitCursor")},hideWaitCursor:function(){this._fsm.handleEvent("HideWaitCursor")},restartApp:function(){this._fsm.handleEvent("RestartApp",_.extend({},this.options))},showErrorMessage:function(e){e=e||{},this._fsm.handleEvent("AppShowErrorMessage",_.extend({errorOptions:e},this)),e.appErrorPromise=$.Deferred()},_createSubApis:function(){this.options.appApi.sfsAppApi=this,this.workflowApi=new i.SFSWorkflowApi(this.options),this.subscriptionApi=new i.SFSSubscriptionApi(this.options),this.errorApi=new i.SFSErrorApi(this.options)},_initStateMachine:function(){var e=_.extend({controller:this},this.options);this._fsm=i.fsmFactory.create("SFSAppFSM",e)},_initializeOperationMap:function(){this._opMap=this._opMap||{},this._opMap.AppStartNewWorkflowOp=this._startNewWorkflow,this._opMap.AppAbortWorkflowOp=this._abortWorkflow,this._opMap.AppShowLandingPageOp=this._showLandingPage,this._opMap.AppHideLandingPageOp=this._hideLandingPage,this._opMap.AppNotifyWorkflowToShowBrowseFileDlgOp=this._notifyWorkflowToShowBrowseFileDlg,this._opMap.AppNotifyFileSelectionToLandingPageOp=this._notifyFileSelectionToLandingPage,this._opMap.AppNotifyLandingPageSuccess=this._notifyLandingPageSuccess,this._opMap.AppNotifyLandingPageErrorOp=this._notifyLandingPageError,this._opMap.AppLaunchFormsAppOp=this._launchFormsApp,this._opMap.AppRemoveFileFromSelectedFileListOp=this._removeFileFromSelectedFileList,this._opMap.ShowWaitCursorOp=this._showWaitCursor,this._opMap.HideWaitCursorOp=this._hideWaitCursor,this._opMap.AppHandleWorkflowStatusEventOp=this._handleWorkflowStatusEvent,this._opMap.AppHandleWorkflowSendPageEventOp=this._handleWorkflowSendPageEvent,this._opMap.AppHandleUploadProgressEventOp=this._handleUploadProgressEvent,this._opMap.AppHandleWorkflowFailureOp=this._handleWorkflowFailure,this._opMap.AppHandleWorkflowSuccessOp=this._handleWorkflowSuccess,this._opMap.AppEvaluateESUserSubscriptionOp=this._evaluateESUserSubscriptionStatus,this._opMap.AppListenForESAuthStatusChangeOp=this._listenForESAuthStatusChange,this._opMap.ShowDummyProgressOp=this._showDummyProgress,this._opMap.HideDummyProgressOp=this._hideDummyProgress,this._opMap.AppUnListenForESAuthStatusChangeOp=this._unlistenForESAuthStatusChange,this._opMap.AppNotifyESUserGotPaidSubscriptionOp=this._notifyESUserGotPaidSubscription,this._opMap.AppNotifyESUserGotFreeSubscriptionOp=this._notifyESUserGotFreeSubscription,this._opMap.RestartAppOp=this._restartApp,this._opMap.AppShowNetworkOfflineViewOp=this._showNetworkOfflineView,this._opMap.AppHideNetworkOfflineViewOp=this._hideNetworkOfflineView,this._opMap.AppShowErrorMessageOp=this._showErrorMessage,this._opMap.AppHideErrorMessageOp=this._hideErrorMessage,this._opMap.SFSCombineFilesOp=this._combineSelectedFilesForPrepareForm},_invokeOperation:function(e){var i=e.opName;if(this._opMap){var t=this._opMap[i];t.call(this,e)}},_startNewWorkflow:function(e){var i,t=e.workflowOptions,s=t.workflowUiModel,n=this.options.sfsAppUiModel;s.set("workflow_restarted_once",n.hasAppWorkflowRestartedOnce()),this.workflowApi.startWorkflow(t),this._addAppAndWorkflowEventListeners(e),i=s.get("workflow_id"),this._runningWorkflows[i]=t},_abortWorkflow:function(e){this.workflowApi.abortWorkflow(e.workflowOptions)},_addAppAndWorkflowEventListeners:function(e){this._addAppProgressEventListeners(e),this._addAppSendPageEventListeners(e),this._addWorkflowEventListeners(e)},_addAppProgressEventListeners:function(e){var i=this.options.sfsAppProgressUiModel;i.on("change:abort_progress",_.bind(function(){this.options.appApi.siteCatalystApi.logScEvent([t.TOOLS,t.SEND_FOR_SIG,t.CONVERSION,t.UPLOAD_CANCELLED,t.OPERATION]),this._fsm.handleEvent("AppAbortWorkflowEvent",e)},this))},_addAppSendPageEventListeners:function(e){var i=this.options.sfsAppSendPageUiModel,t=e.workflowOptions.workflowUiModel;i.on("change:is_loaded",function(e,i){var s=_.extend({},t.get("send_page_status"),{isLoaded:i});t.set("send_page_status",s)})},_addWorkflowEventListeners:function(e){var i=e.workflowOptions.workflowUiModel;i.on("change:workfow_status",_.bind(function(i,t){e.workflow_status=t,this._fsm.handleEvent("AppWorkflowStatusEvent",e)},this)),i.on("change:send_page_status",_.bind(function(i,t){e.send_page_status=t,this._fsm.handleEvent("AppWorkflowSendPageEvent",e)},this))},_handleWorkflowStatusEvent:function(e){var i,t,s=e.workflow_status,n=this.options.sfsAppUiModel,o=this.options.sfsAppProgressUiModel,r=s.name,a=s.progressPercentage;switch(r){case"upload_started":i="upload";break;case"upload_progress":i="upload",t=o.get("upload_progress_percentage"),a>t&&(o.set("upload_progress_percentage",a),this._fsm.handleEvent("AppUploadProgressEvent",e));break;case"upload_success":i="upload",o.set("upload_progress_percentage",a);break;case"send_url_fetch_success":i="send_page_url_fetch",o.set("send_page_url_fetch_percentage",a);break;case"open_send_page_success":i="send_page_load",o.set("send_page_load_percentage",a);break;case"workflow_failure":this._fsm.handleEvent("AppWorkflowFailure",e)}o.setProgressName(i),o.set("is_visible",s.isVisible,{silent:!0}),n.notifyAppStateChange()},_handleWorkflowSendPageEvent:function(e){var i=e.send_page_status,t=this.options.sfsAppUiModel,s=this.options.sfsAppSendPageUiModel;s.set("url",i.url,{silent:!0}),s.set("is_visible",i.isVisible,{silent:!0}),t.notifyAppStateChange()},_handleUploadProgressEvent:function(e){this._hideDummyProgress(e)},_handleWorkflowFailure:function(e){var i=this._findWorkflowOptionsById(e.workflowId);i&&i.promise.reject(i)},_handleWorkflowSuccess:function(e){var i=this._findWorkflowOptionsById(e.workflowId);i&&i.promise.resolve(i)},_findWorkflowOptionsById:function(e){return this._runningWorkflows[e]},_showLandingPage:function(n){n.appSelectedFiles=_.clone(n.workflowSelectedFiles)||[];var o=_.clone(n.appSelectedFiles),r=_.extend({},this.options,{selectedFiles:o}),a=this.options.sfsAppLandingPageUiModel;i.opFactory.create("ShowSFSLandingPageOp",r).run(),a.on("change:user_action",_.bind(function(i,o){switch(o){case"browse_file":this.options.appApi.siteCatalystApi.logScEvent([t.TOOLS,t.SEND_FOR_SIG,t.OPTION_DLG,t.ADD_FILES,t.CLICKED]),this._fsm.handleEvent("UserClickedBrowseFileDlg",n);break;case"removed_file":n.userRemovedFile=a.get("user_removed_file"),this._fsm.handleEvent("UserClickedRemoveFile",n);break;case"select_action_btn_clicked":this.options.appApi.siteCatalystApi.logScEvent([t.TOOLS,t.SEND_FOR_SIG,t.SELECT_FILES,t.CLICKED]),this._fsm.handleEvent("UserClickedBrowseFileDlg",n);break;case"send_action_btn_clicked":var r=t.START;s.isAcrobat()&&(r=t.READY_TO_SEND),this.options.appApi.siteCatalystApi.logScEvent([t.TOOLS,t.SEND_FOR_SIG,t.OPTION_DLG,r,t.CLICKED]),this._fsm.handleEvent("UserClickedSendFilesBtn",n);break;case"prepare_form_btn_clicked":this.options.appApi.siteCatalystApi.logScEvent([t.TOOLS,t.SEND_FOR_SIG,t.OPTION_DLG,t.PREPARE_FORM,t.CLICKED]),e.Util.isAcrobat()&&n.appSelectedFiles.length>1?this._fsm.handleEvent("CombineSelectedFilesEvent",n):this._fsm.handleEvent("UserClickedPrepareFormBtn",n);break;case"email_list_added":n.signerEmailIDS=a.get("user_added_signer_emails"),n.approverEmailIDS=a.get("user_added_approver_emails"),n.ccemailIDS=a.get("user_added_cc_emails"),this._fsm.handleEvent("UserAddedEmailIds",n);break;case"subject_added":n.subject=a.get("user_added_subject");break;case"message_added":n.message=a.get("user_added_message")}},this))},_hideLandingPage:function(){this.options.sfsAppLandingPageUiModel.set("is_visible",!1)},_notifyWorkflowToShowBrowseFileDlg:function(e){this.workflowApi.showFileBrowseDlg().then(_.bind(function(i){e.appSelectedFiles=e.appSelectedFiles.concat(i),this._fsm.handleEvent("FilesAreSelected",e)},this),_.bind(function(){this._fsm.handleEvent("FilesNotSelected",e)},this))},_launchFormsApp:function(e){this.options.appApi.rnaApi.done(_.bind(function(i){i.invokeMethod({methodName:"launchFormsApp",methodArgs:_.map(e.appSelectedFiles,function(e){return e._proxy})})},this))},_removeFileFromSelectedFileList:function(e){e.appSelectedFiles=_.without(e.appSelectedFiles,e.userRemovedFile),delete e.userRemovedFile},_notifyFileSelectionToLandingPage:function(e){this.options.sfsAppLandingPageUiModel.set("selected_files",_.clone(e.appSelectedFiles))},_notifyLandingPageSuccess:function(e){e.appLandingPagePromise.resolve({selectedFiles:e.appSelectedFiles})},_notifyLandingPageError:function(e){e.appLandingPagePromise.reject(e)},_showWaitCursor:function(){var e=this.options.sfsAppUiModel,i=e.get("wait_cursor_visible");i||this.options.appApi.rnaApi.done(_.bind(function(i){i.invokeMethod({methodName:"showWaitCursor",methodArgs:!0}),e.set("wait_cursor_visible",!0,{silent:!0})},this))},_hideWaitCursor:function(){var e=this.options.sfsAppUiModel,i=e.get("wait_cursor_visible");i&&this.options.appApi.rnaApi.done(_.bind(function(i){i.invokeMethod({methodName:"showWaitCursor",methodArgs:!1}),e.set("wait_cursor_visible",!1,{silent:!0})},this))},_listenForESAuthStatusChange:function(e){var i=this.options.esAuthUiModel,t=this.options.sfsAppUiModel,s=this.options.sfsAppProgressUiModel;i.on("change:auth_status",_.bind(function(i,n){s.setProgressName("auth"),"success"===n?this._fsm.handleEvent("ESAuthSessionCreateSuccess",e):"in_progress"===n?this._fsm.handleEvent("ESAuthSessionInProgress",e):"failure"===n&&s.set("is_visible",!1,{silent:!0}),t.notifyAppStateChange()},this))},_showDummyProgress:function(){this.dummyProgressTimerId||(this.dummyProgressTimerId=setInterval(_.bind(function(){var e=this.options.sfsAppUiModel,i=this.options.sfsAppProgressUiModel,t=i.get("upload_progress_percentage"),s=i.get("max_dummy_percentage"),n=i.get("dummy_progress_incr");s>t?(t+=n,i.set("upload_progress_percentage",t),i.set("is_visible",!0,{silent:!0}),e.notifyAppStateChange()):(clearInterval(this.dummyProgressTimerId),delete this.dummyProgressTimerId)},this),1e3))},_hideDummyProgress:function(){this.dummyProgressTimerId&&(clearInterval(this.dummyProgressTimerId),delete this.dummyProgressTimerId)},_unlistenForESAuthStatusChange:function(){var e=this.options.esAuthUiModel;e.off("change:auth_status")},_evaluateESUserSubscriptionStatus:function(e){e=_.extend(e,{parentView:e.parentView}),this.subscriptionApi.checkSubscriptionStatus(e).then(_.bind(function(){this._fsm.handleEvent("AppESUserFoundPaid",e)},this),_.bind(function(){this._fsm.handleEvent("AppESUserFoundFree",e)},this))},_notifyESUserGotPaidSubscription:function(e){e.appESSubscriptionPromise.resolve()},_notifyESUserGotFreeSubscription:function(e){e.appESSubscriptionPromise.reject()},_restartApp:function(){var e=this.options.sfsAppUiModel,i=this.options.sfsAppSendPageUiModel,t=this.options.sfsAppProgressUiModel;i.set("is_visible",!1,{silent:!0}),t.set("is_visible",!1,{silent:!0}),this._clearRunningWorkflows(),e.notifyAppStateChange(),e.setAppWorkflowRestartedOnce(!0),e.set("restart_app",!0)},_showNetworkOfflineView:function(e){var i=this.options.sfsAppUiModel,t=this.options.esOfflineUiModel,s=this.options.sfsAppLandingPageUiModel,n=this.options.sfsAppProgressUiModel,o=this.options.sfsAppSendPageUiModel;t.resetToDefaults(),$(".sfs-subscribe-page-container").empty(),t.set("is_visible",!0,{silent:!0}),s.set("is_visible",!1,{silent:!0}),n.set("is_visible",!1,{silent:!0}),o.set("is_visible",!1,{silent:!0}),t.on("change:user_action",_.bind(function(i,t){"okay"===t&&this._fsm.handleEvent("AppOfflineViewDismissed",e)},this)),i.notifyAppStateChange()},_hideNetworkOfflineView:function(){var e=this.options.sfsAppUiModel,i=this.options.esOfflineUiModel;i.set("is_visible",!1),e.notifyAppStateChange()},_showErrorMessage:function(e){var i=this.options.appApi.sfsAppApi.errorApi;i.showErrorMessage(e.errorOptions).always(_.bind(function(){this._fsm.handleEvent("AppErrorDialogDismissed",e),e.errorOptions.appErrorPromise.resolve()},this))},_hideErrorMessage:function(){var e=this.options.appApi.sfsAppApi.errorApi;e.hideErrorMessage()},_clearRunningWorkflows:function(){this._runningWorkflows={}},_combineSelectedFilesForPrepareForm:function(e){i.opFactory.create("SFSCombineFilesOp",_.extend({inputFiles:e.appSelectedFiles},this.options)).run().then(_.bind(function(i){e.validFiles=[],e.validFiles=i,e.appSelectedFiles=[],e.appSelectedFiles=e.validFiles,this._fsm.handleEvent("UserClickedPrepareFormBtn",e)},this),_.bind(function(i){i&&this._fsm.handleEvent("CombineSelectedFilesEventFailed",e)},this))}}),i.SFSAppApi}),define("pdmplugins/send-for-sign/js/ops/plugin/initializing-plugin-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/esign/js/ac-esign","pdmplugins/send-for-sign/js/utils/sfs-ts-utils","pdmplugins/send-for-sign/js/collections/sfs-autocomplete-collection","pdmplugins/send-for-sign/js/api/sfs-app-api"],function(e,i,t,s){return i.InitializingPluginOp=e.Op.extend({run:function(){var n,o=this.options,r=i.uiModelFactory,a=t.opFactory,l=o.appApi.routerApi.getQueryParams(),p=l.mode;return e.Util.isCEF()||(n=o.appApi.baseFilesUrisApi.getSendApiUri(),n=s.extractRootUrl(n)),i.sfsAppApi=new i.SFSAppApi(o),_.extend(o,{sfsAppUiModel:r.create("SFSAppUiModel"),sfsAppProgressUiModel:r.create("SFSAppUploadProgressUiModel"),sfsAppSendPageUiModel:r.create("SFSAppSendPageUiModel"),sfsAppLandingPageUiModel:r.create("SFSAppLandingPageUiModel"),sfsSubscribeUiModel:r.create("SFSSubscribeUiModel"),autoCCollection:new i.AutocompleteCollection([],{rootUrl:n})}),"clearESWebSession"===p&&o.sfsAppUiModel.set("mode_type","clearESWebSession",{silent:!0}),a.create("InitializingOp",o).run(),this._getResolvedPromise()}}),i.InitializingPluginOp}),define("pdmplugins/send-for-sign/js/ops/plugin/running-plugin-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){return i.RunningPluginOp=e.Op.extend({run:function(){var e,t=this.options,s=t.sfsAppUiModel,n=i.uiModelFactory,o=i.opFactory;e=o.create("ListeningForViewEventsOp",t);var r=n.create("SFSWorkflowUiModel");s.set("workflow_ui_model",r);var a={parentView:t.rootView,workflowUiModel:s.get("workflow_ui_model")};return i.sfsAppApi.startWorkflow(a),$.when(e.run())}}),i.RunningPluginOp}),define("pdmplugins/send-for-sign/js/ops/plugin/starting-plugin-op",["core/ac-core","pdmplugins/esign/js/ac-esign","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i,t){return t.StartingPluginOp=e.Op.extend({run:function(){var e=this.options,s=t.opFactory,n=e.sfsAppUiModel.get("mode_type");return"clearESWebSession"===n?i.opFactory.create("LogOutESWebSessionOp",this.options).run():s.create("RunningPluginOp",e).run(),this._getResolvedPromise()}}),t.StartingPluginOp}),define("pdmplugins/send-for-sign/js/ops/listening/listening-for-view-events-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){return i.ListeningForViewEventsOp=e.Op.extend({run:function(){this.options;return this._getResolvedPromise()}}),i.ListeningForViewEventsOp}),define("pdmplugins/send-for-sign/js/ops/listening/listening-for-workflow-events-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){return i.ListeningForWorkflowEventsOp=e.Op.extend({run:function(){this.options;return this._getResolvedPromise()}}),i.ListeningForWorkflowEventsOp}),define("pdmplugins/send-for-sign/js/ops/listening/listening-for-send-page-events-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){var t=[".adobe.com",".documents.adobe.com",".documentsdemo.adobe.com",".documentsstage.adobe.com",".documentsopsdev.adobe.com",".documentspreview.adobe.com",".documentsdr.adobe.com",".echosign.com",".echosigndemo.com",".echosignstage.com",".echosignopsdev.com",".echosignpreview.com",".echosigndr.com"];return i.ListenForSendPageEventsOp=e.Op.extend({run:function(){function e(e){if(s=e.origin,!_.isUndefined(s)&&!_.isEmpty(s)&&(n=s.split("/"),_.size(n)>=3&&(o="."+n[2]),i=_.find(t,function(e){return _.isEmpty(o)||-1===o.indexOf(e,o.length-e.length)?void 0:e}),!_.isEmpty(i))){var r=JSON.parse(e.data);_.isEmpty(r)||(a.clearLastEventState(),a.set("eventData",r))}}var i,s,n,o,r=this.options,a=r.sfsESWebPageUIModel;return window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e),this._getResolvedPromise()}}),i.ListenForSendPageEventsOp}),define("pdmplugins/send-for-sign/js/ops/plugin/fetch-send-for-sign-page-url-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-constants","core/utils/util","core/utils/http-util"],function(e,i,t,s,n){var o="";return i.FetchSendForSignPageUrlOp=e.Op.extend({run:function(){var e,i,s,r,a,l,p,d,c,h=this.options,u=h.appApi,f=$.Deferred(),g=u.localeApi.getLocale(),S=g.split("-"),E="",m=h.transientDocumentIds,A=m.length,v=h.agreementName,C=h.signerRecipients,I=h.approverRecipients,O=h.agreementNameModified,T=h.agreementMessages,F=h.CCRecipients,b=h.recipientIDs,P=this.options.sfsAppLandingPageUiModel.get("showSFSNewLandingPage");return g=_.isEmpty(g)||_.isEmpty(S)?"en_US":S[0]+"_"+S[1].toUpperCase(),u.rnaApi.done(_.bind(function(u){if(a=u.esApi.getEchoSignServiceParams(),s=a.apiURL,r=h.esAuthUiModel.get("access_token"),_.isEmpty(s)||_.isEmpty(r))return void f.reject();c=P?t.API_SUBPATH_NEW:t.API_SUBPATH_OLD,e=s+c+"/agreements",_.each(h.transientDocumentIds,function(e,i){E+='{"transientDocumentId": "'+e+'"}',i!==A-1&&(E+=",")}),p={transient_document_ids:E,locale:g},_.isUndefined(O)||_.isEmpty(O)?_.isUndefined(v)||_.isEmpty(v)||(d=v.lastIndexOf("."),-1!==d&&(v=v.substr(0,d)),p.agreement_name=v):p.agreement_name=O,P?(p.agreement_message="",_.isUndefined(T)||_.isEmpty(T)||(p.agreement_message=T),p.recipients_ids=!_.isUndefined(C)&&!_.isEmpty(C)||!_.isUndefined(I)&&!_.isEmpty(I)?this._getRecipientIDsString(C,I):"",p.cc_recipientsids=_.isUndefined(F)||_.isEmpty(F)?"":this._getCCRecipientIDsString(F)):p.recipients_ids=_.isUndefined(b)||_.isEmpty(b)?"":this._getRecipientIDsStringOld(b),this._generateJSONforAgreementsCall(P),i=_.template(o,p);var S=n.getClientIdQueryParam(),m=S.lastIndexOf("=");l={Accept:"application/json","Access-Token":r,"x-api-client-id":S.substr(m+1)},$.ajax({url:e,data:i,type:"POST",modal:!1,headers:l,contentType:"application/json",dataType:"json",success:_.bind(function(e){f.resolve(e)},this),error:_.bind(function(e){f.reject({httpRespCode:e.status,httpRespBody:e.responseText})},this)})},this)),f},_generateJSONforAgreementsCall:function(e){e?(o+="{",o+='  "documentCreationInfo": {',o+='    "fileInfos": [<%= transient_document_ids%>],',o+='    "name": "<%= agreement_name%>",',o+='    "message": "<%= agreement_message%>",',o+='    "signatureFlow": "SENDER_SIGNATURE_NOT_REQUIRED",',o+='    "signatureType": "ESIGN"',o+="<%= recipients_ids %>",o+="<%= cc_recipientsids %>",o+="  },",o+='  "options": {',o+='    "noChrome": "true",',o+='    "sendThroughWebOptions": {',o+='      "fileUploadOptions": {',o+='        "webConnectors": "false",',o+='        "localFile": "false",',o+='        "libraryDocument": "true"',o+="      }",o+="    },",o+='    "sendThroughWeb": "false",',o+='    "locale": "<%= locale %>",',o+='    "authoringRequested": "true",',o+='    "autoLoginUser": "true"',o+="  }",o+="}"):(o+="{",o+='  "documentCreationInfo": {',o+='    "fileInfos": [<%= transient_document_ids%>],',o+='    "name": "<%= agreement_name%>"',s.isAcrobat()&&(o+="<%= recipients_ids %>"),o+="  },",o+='  "options": {',o+='    "noChrome": "true",',o+='    "sendThroughWebOptions": {',o+='      "fileUploadOptions": {',o+='        "webConnectors": "false",',o+='        "localFile": "false",',o+='        "libraryDocument": "true"',o+="      }",o+="    },",o+='    "sendThroughWeb": "true",',o+='    "locale": "<%= locale %>",',o+=s.isAcrobat()?'    "authoringRequested": "false",':'    "authoringRequested": "true",',o+='    "autoLoginUser": "true"',o+="  }",o+="}")},_getRecipientIDsString:function(e,i){var t,s="";return _.isUndefined(e)&&_.isUndefined(i)?s:(s=', "recipientSetInfos" : [',_.isEmpty(e)||(t=e.split(","),_.each(t,function(e){s+='{ "recipientSetMemberInfos" :[{"email": "'+e+'"}], "recipientSetRole": "SIGNER"},'})),_.isEmpty(i)||(t=i.split(","),_.each(t,function(e){s+='{ "recipientSetMemberInfos" :[{"email": "'+e+'"}], "recipientSetRole": "APPROVER"},'})),s=s.slice(0,-1),s=s.replace(/\,$/,""),s+="]")},_getCCRecipientIDsString:function(e){var i,t="";return _.isUndefined(e)?t:(i=e.split(","),t=', "ccs" :[',_.each(i,function(e){t+='"'+e+'",'}),t=t.replace(/\,$/,""),t+="]")},_getRecipientIDsStringOld:function(e){var i,t="";return _.isUndefined(e)?t:(i=e.split(","),t=',"recipients":[',_.each(i,function(e){t+='{"email":"'+e+'"},'}),t=t.replace(/\,$/,""),t+="]")}}),i.FetchSendForSignPageUrlOp}),define("pdmplugins/send-for-sign/js/ops/plugin/open-send-for-sign-page-in-app-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){return i.OpenSendForSignPageInAppOp=e.Op.extend({run:function(){var e=this.options,i=e.sendPageUrl,t=e.workflowUiModel,s=$.Deferred();return t.set("send_page_status",{url:i}),t.on("change:send_page_status",function(e,i){i.isLoaded?s.resolve():s.reject()}),s}}),i.OpenSendForSignPageInAppOp}),define("pdmplugins/send-for-sign/js/ops/plugin/show-sfs-landing-page-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","core/utils/util","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","pdmplugins/send-for-sign/js/constants/sfs-sc-constants"],function(e,i,t,s,n){return i.ShowSFSLandingPageOp=e.Op.extend({run:function(){var e=this.options;return this.landingPageUiModel=e.sfsAppLandingPageUiModel,this.landingPageUiModel.set("selected_files",e.selectedFiles),this._updateLandingPageFileCollectionFields(),this._updateLandingPageAppInfoFields(),this._updateLandingPageActionBtnFields(),this._updateLandingPageVisibility(!0),this.addUiModelEventListeners(),this._getResolvedPromise()},addUiModelEventListeners:function(){this.landingPageUiModel.on("change:selected_files",this._onSelectedFilesChange),this.landingPageUiModel.on("change:is_visible",this._onVisibilityChange)},_getSelectedFilesCount:function(){var e=this.landingPageUiModel.get("selected_files");return _.isEmpty(e)?0:e.length},_onSelectedFilesChange:function(){this._updateLandingPageActionBtnFields(),this._updateLandingPageAppInfoFields(),this._updateLandingPageFileCollectionFields(),this._refreshLandingPage()},_onVisibilityChange:function(e,i){this._updateLandingPageVisibility(i)},_updateLandingPageVisibility:function(e){this.landingPageUiModel.set("is_visible",e>0)},_refreshLandingPage:function(){this.landingPageUiModel.clearLastRefreshState(),this.landingPageUiModel.set("is_refreshed",!0)},_updateLandingPageFileCollectionFields:function(){var e=this._getSelectedFilesCount();0>=e?(this.options.appApi.siteCatalystApi.logScEvent([n.TOOLS,n.SEND_FOR_SIG,n.SELECT_FILES,n.SHOWN]),this.landingPageUiModel.set("file_collection_visible",!1,{silent:!0})):(this.options.appApi.siteCatalystApi.logScEvent([n.TOOLS,n.SEND_FOR_SIG,n.OPTION_DLG,n.SHOWN]),this.landingPageUiModel.set("file_collection_visible",!0,{silent:!0}))},_updateLandingPageAppInfoFields:function(){this._updateAppInfoFieldsVisibility(),this._updateAppInfoFieldsContent()},_updateLandingPageActionBtnFields:function(){this._updateActionBtnsVisibility(),this._updateActionBtnsUpdateState(),this._updateActionBtnsLabels(),this._updateActionBtnsDescriptionVisibility(),this._updateActionBtnsDescriptionText()},_updateAppInfoFieldsVisibility:function(){this.landingPageUiModel.set("app_info_txt_visible",!1,{silent:!0})},_updateAppInfoFieldsContent:function(){t.isReader()&&(this.landingPageUiModel.set("app_info_txt1",s.LP_RDR_APP_INFO_TXT_1,{silent:!0}),this.landingPageUiModel.set("app_info_txt2",s.LP_RDR_APP_INFO_TXT_2,{silent:!0}),this.landingPageUiModel.set("app_info_txt3",s.LP_RDR_APP_INFO_TXT_3,{silent:!0}))},_updateActionBtnsVisibility:function(){this.landingPageUiModel.set("action_btn1_visible",!0,{silent:!0});var e=this._getSelectedFilesCount(),i=e>0;t.isAcrobat()&&this.landingPageUiModel.set("action_btn2_visible",i,{silent:!0})},_updateActionBtnsUpdateState:function(){var e=this._getSelectedFilesCount(),i=e>0;t.isAcrobat()&&(i?this.landingPageUiModel.get("showSFSNewLandingPage")?this.landingPageUiModel.set("action_btn1_enabled",!0,{silent:!0}):this.options.appApi.rnaApi.done(_.bind(function(e){e.isRunningInBrowser()&&this.landingPageUiModel.set("action_btn1_enabled",!1,{silent:!0})},this)):this.landingPageUiModel.set("action_btn1_enabled",!0,{silent:!0}))},_updateActionBtnsLabels:function(){var e=this._getSelectedFilesCount();this.landingPageUiModel.get("showSFSNewLandingPage")?e>0?this.landingPageUiModel.set("action_btn1_label",s.LP_ACTION_BTN1_LABEL_NEW,{silent:!0}):this.landingPageUiModel.set("action_btn1_label",s.LP_SELECT_FILE_BTN_LABEL,{silent:!0}):e>0?t.isReader()?this.landingPageUiModel.set("action_btn1_label",s.LP_RDR_ACTION_BTN1_LABEL,{silent:!0}):t.isAcrobat()&&(this.landingPageUiModel.set("action_btn1_label",s.LP_ACR_ACTION_BTN1_LABEL,{silent:!0}),this.landingPageUiModel.set("action_btn2_label",s.LP_ACR_ACTION_BTN2_LABEL,{silent:!0}),this.landingPageUiModel.set("action_btn_separator_label",s.LP_ACR_ACTION_BTN_SEPARATOR,{silent:!0})):this.landingPageUiModel.set("action_btn1_label",s.LP_SELECT_FILE_BTN_LABEL,{silent:!0})},_updateActionBtnsDescriptionVisibility:function(){var e,i=this._getSelectedFilesCount();t.isAcrobat()&&(e=i>0,this.landingPageUiModel.set("action_btn_descr_visible",e,{silent:!0}))
},_updateActionBtnsDescriptionText:function(){this.landingPageUiModel.get("showSFSNewLandingPage")||(this.landingPageUiModel.set("action_btn1_descr_txt",s.LP_ACR_ACTION_BTN1_INFO,{silent:!0}),this.landingPageUiModel.set("action_btn2_descr_txt",s.LP_ACR_ACTION_BTN2_INFO,{silent:!0}))}}),i.ShowSFSLandingPageOp}),define("pdmplugins/send-for-sign/js/ops/plugin/fetch-manage-agreements-url-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-constants"],function(e,i,t){var s="";return s+="{",s+='  "autoLogin": true,',s+='  "noChrome": false,',s+='  "agreementAssetId": "<%= agreementId%>"',s+="}",i.FetchManageAgreementsURLOp=e.Op.extend({run:function(){var e,i,n,o,r,a,l=this.options,p=l.appApi,d=$.Deferred();return p.rnaApi.done(_.bind(function(p){if(o=p.esApi.getEchoSignServiceParams(),i=o.apiURL,n=l.esAuthUiModel.get("access_token"),a=l.agreementId,_.isEmpty(i)||_.isEmpty(n))return void d.reject();var c;c=this.options.sfsAppLandingPageUiModel.get("showSFSNewLandingPage")?t.API_SUBPATH_NEW:t.API_SUBPATH_OLD,e=i+c+"/views/agreementAssetList",r={Accept:"application/json","Access-Token":n},s=_.template(s,{agreementId:a}),$.ajax({url:e,data:s,type:"POST",modal:!1,headers:r,contentType:"application/json",dataType:"json",success:_.bind(function(e){_.isEmpty(e)||_.isEmpty(e.viewURL)?d.reject():d.resolve(e)},this),error:_.bind(function(){d.reject()},this)})},this)),d}}),i.FetchManageAgreementsURLOp}),define("pdmplugins/send-for-sign/js/ops/plugin/sfs-files-validator-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-error-codes","pdmplugins/send-for-sign/js/constants/sfs-constants"],function(e,i,t,s){var n=["",t.PDFIsPortfolio,t.PDFIsPasswordProtected,t.PDFIsCertificateProtected,t.PDFIsPolicyProtected,t.PDFIsDynamicXFA,t.PDFIsOfInvalidType];return i.SFSFilesValidatorOp=e.Op.extend({run:function(){var e,i,o,r,a=this.options,l=$.Deferred(),p=a.inputFiles,d=[],c=[],h=[];return _.each(p,_.bind(function(i){return _.isEmpty(i)?void c.push(i):_.isEmpty(i.get("assetId"))&&(e=i.get("ext"),_.isEmpty(e)||!_.some(s.SUPPORTED_EXTENSIONS,function(i){return i.toLowerCase()===e.toLowerCase()}))?void c.push({file:i,errorCode:t.InvalidFileExtn}):_.isEmpty(i.get("assetId"))||(e=i.get("ext"),_.isEmpty(e)||_.some(s.SUPPORTED_EXTENSIONS,function(i){return i.toLowerCase()===e.toLowerCase()}))?void d.push(i):void c.push({file:i,errorCode:t.InvalidFileExtn})},this)),_.isEmpty(d)?(l.resolve(d,c),l):(r=_.map(d,function(e){return e._proxy}),i={methodName:"canSendForSign",methodArgs:r},a.appApi.rnaApi.done(_.bind(function(e){e.servicesApi(i).then(_.bind(function(e){_.each(d,_.bind(function(i,t){e[t].errorSet?(o=e[t].errorCode,c.push({file:i,errorCode:n[o]})):h.push(i)},this)),l.resolve(h,c)},this),function(){l.reject()})},this)),l)}}),i.SFSFilesValidatorOp}),define("pdmplugins/send-for-sign/js/ops/plugin/sfs-combine-files-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","pdmplugins/send-for-sign/js/constants/sfs-sc-constants"],function(e,i,t,s){return i.SFSCombineFilesOp=e.Op.extend({run:function(){var i,n,o,r,a,l=this.options,p=this.options.appApi.dialogApi,d=$.Deferred(),c=0,h=l.inputFiles,u=[],f=[],g=0;return _.each(h,_.bind(function(e){_.isEmpty(e)||u.push(e)},this)),_.isEmpty(u)?(d.resolve(u),d):(a=_.map(u,function(e){return e._proxy}),c=u.length,l.appApi.siteCatalystApi.logScEvent([s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.SHOWN]),i=t.SFS_COMBINE_MESSAGE_TITLE,n=t.SFS_COMBINE_MESSAGE_TEXT,p.displayHtmlAlert(p.SEVERITY_WARNING,i,n,t.YES,t.NO).then(_.bind(function(){l.appApi.siteCatalystApi.logScEvent([s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.YES_CLICKED]),l.appApi.siteCatalystApi.logScEvent([s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.STARTED,c,s.FILES]),l.appApi.rnaApi.done(_.bind(function(i){i.rnaServicesAPI.combineMultipleFilesToSinglePDFApi(a).then(_.bind(function(i){l.appApi.siteCatalystApi.logScEvent([s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.SUCCESS]),o=i,r=new e.LocalItemModel(void 0,{_proxy:o}),f.push(r),d.resolve(f)},this),function(e){l.appApi.siteCatalystApi.logScEvent(e?[s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.FAILURE]:[s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.CANCELLED]),g=1,d.reject(g)})},this))},this),_.bind(function(){l.appApi.siteCatalystApi.logScEvent([s.TOOLS,s.SEND_FOR_SIG,s.OPTION_DLG,s.COMBINE,s.NO_CLICKED]),d.reject(g)},this)),d)}}),i.SFSCombineFilesOp}),define("pdmplugins/send-for-sign/js/templates/sfs-subscribe-page-template",[],function(){return'<div class="sfs-subscribe-page-container"><div class="sfs-subcribe-page-title theme-text"><%= pageTitle %></div><div class="sfs-subscribe-page-msg-content theme-text"><div><%= messageContent1 %></div></div><div class="sfs-sign-in-btns-group"><div class="sfs-sign-in-btn"><input id="sfs-subscribe-sign" class="control-button dialog-control-button"type="button"tabindex="1" value="<%= signInLabel %>"></input></div><div class="sfs-sign-in-upgrade-grp"><div class="sfs-upgrade-label  theme-text"><%= upgradeLabelNotSubscribed %></div><div role ="link" class="sfs-upgrade-link theme-hyperlink" tabindex=0><%= upgradeLabel %></div><div class="sfs-upgrade-grp-terminator"></div></div></div><div class="sfs-upgrade-btns-group"><div class="sfs-upgrade-btn"><input class="control-button dialog-control-button"type="button"tabindex="1" value="<%= upgradeNowLabel %>"></input></div></div><div class="sfs-start-now-btns-group"><div class="sfs-start-now-btn"><input class="control-button dialog-control-button"type="button"tabindex="1" value="<%= startNowLabel %>"></input></div></div></div>'}),define("pdmplugins/send-for-sign/js/views/sfs-subscribe-page-view",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/templates/sfs-subscribe-page-template","i18n!pdmplugins/send-for-sign/js/nls/ui-strings"],function(e,i,t,s){i.SFSSubscribePageView=e.View.extend({events:function(){return{"click   .sfs-upgrade-btn .control-button":"_onUpgradeNowBtnClick","click   .sfs-start-now-btn .control-button":"_onStartNowBtnClick","click   .sfs-sign-in-btn .control-button":"_onSignInBtnClick","click   .sfs-upgrade-link":"_onUpgradeNowBtnClick"}},initialize:function(){this._template=_.template(t)},show:function(){this._pageViewId=this.options.parentView.addChildView(this),this.options.parentView.$el.append(this.$el),this.render()},render:function(){e.View.prototype.render.call(this),this.options.appApi.rnaApi.done(_.bind(function(e){var i=s.SFS_SUBSCRIBE_UPGRADE_NOT_SUBCRIBED,t=s.SFS_SUBSCRIBE_UPGRADE,n=s.SFS_SUBSCRIBE_SIGN_IN;e.rnaServicesAPI.isSFSUpsellExperimentEnabled()===!0&&(i=s.SFS_SUBSCRIBE_UPGRADE_ALREADY_SUBSCRIBED_EXPERIMENT,t=s.SFS_SUBSCRIBE_SIGN_IN,n=s.SFS_SUBSCRIBE_LEARN_MORE_EXPERIMENT),0===this.$el.children().length&&(this.$el.html(this._template({pageTitle:s.SFS_SUBSCRIBE_TITLE,messageContent1:s.SFS_SUBSCRIBE_MSG_CONTENT_1,signInLabel:n,upgradeLabelNotSubscribed:i,upgradeNowLabel:s.SFS_SUBSCRIBE_UPGRADE_NOW,startNowLabel:s.SFS_SUBSCRIBE_START_NOW,upgradeLabel:t})),this._initWrappers())},this)),this.$signInBtnGrpElem.addClass("hidden"),this.$startNowBtnGrpElem.addClass("hidden"),this.$upgradeNowBtnGrpElem.addClass("hidden");var i=this.options.sfsSubscribeUiModel.get("visible_btn_name");return"sign_in"===i?this.$signInBtnGrpElem.removeClass("hidden"):"start_now"===i?this.$startNowBtnGrpElem.removeClass("hidden"):"upgrade"===i&&this.$upgradeNowBtnGrpElem.removeClass("hidden"),this._initTabLimits(),$("#sfs-subscribe-sign").focus(),this},_initWrappers:function(){this.$upgradeNowBtnGrpElem=$(".sfs-upgrade-btns-group"),this.$signInBtnGrpElem=$(".sfs-sign-in-btns-group"),this.$startNowBtnGrpElem=$(".sfs-start-now-btns-group")},_initTabLimits:function(){var e;e=this.$("[tabindex][disabled != 'disabled']"),this.$firstTabbable=e.first(),this.$lastTabbable=e.last()},_onUpgradeNowBtnClick:function(){this._close(),this.options.sfsSubscribeUiModel.set("user_action","upgrade_clicked")},_onStartNowBtnClick:function(){this._close(),this.options.sfsSubscribeUiModel.set("user_action","start_now_clicked")},_onSignInBtnClick:function(){this._close(),this.options.sfsSubscribeUiModel.set("user_action","sign_in_clicked")},_onCloseBtnClick:function(){this._close(),this.options.sfsSubscribeUiModel.set("user_action","cancel_clicked")},_close:function(){_.defer(_.bind(function(){this.options.parentView.removeChildViewById(this._pageViewId),this.remove()},this))}})}),define("pdmplugins/send-for-sign/js/ops/plugin/show-sfs-subscribe-page-op",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","core/ops/op","pdmplugins/send-for-sign/js/views/sfs-subscribe-page-view"],function(e,i){return i.ShowSFSSubscribePageOp=e.Op.extend({run:function(){var e,t=this.options;e=new i.SFSSubscribePageView(_.extend({parentView:t.parentView},t)),e.show()}}),i.ShowSFSSubscribePageOp}),define("pdmplugins/send-for-sign/js/ops/op-factory",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/ops/plugin/initializing-plugin-op","pdmplugins/send-for-sign/js/ops/plugin/running-plugin-op","pdmplugins/send-for-sign/js/ops/plugin/starting-plugin-op","pdmplugins/send-for-sign/js/ops/listening/listening-for-view-events-op","pdmplugins/send-for-sign/js/ops/listening/listening-for-workflow-events-op","pdmplugins/send-for-sign/js/ops/listening/listening-for-send-page-events-op","pdmplugins/send-for-sign/js/ops/plugin/fetch-send-for-sign-page-url-op","pdmplugins/send-for-sign/js/ops/plugin/open-send-for-sign-page-in-app-op","pdmplugins/send-for-sign/js/ops/plugin/show-sfs-landing-page-op","pdmplugins/send-for-sign/js/ops/plugin/fetch-manage-agreements-url-op","pdmplugins/send-for-sign/js/ops/plugin/sfs-files-validator-op","pdmplugins/send-for-sign/js/ops/plugin/sfs-combine-files-op","pdmplugins/send-for-sign/js/ops/plugin/show-sfs-subscribe-page-op"],function(e,i){i.OpFactory=e.Op.extend({create:function(e,t){var s=i[e];return s?new s(t):void LOG(0,"AcSendForSign.OpFactory.create: Unrecognized class: "+e)}})}),define("pdmplugins/send-for-sign/js/fsm/sfs-app-fsm",["pdmplugins/esign/js/fsm/fsm","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-error-codes","pdmplugins/esign/js/ac-esign","pdmplugins/send-for-sign/js/constants/sfs-sc-constants"],function(e,i,t,s,n){var o={IDLE:0,WAITING_FOR_WORKFLOW_STATUS:1,WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS:2,WAITING_FOR_LANDING_PAGE_STATUS:3,SHOWING_FILE_SELECTION_DIALOG:4,SHOWING_NETWORK_OFFLINE_MODE:5,SHOWING_ERROR_MSG:6};return i.SFSAppFSM=e.extend({_initFSM:function(){this._setSupportedStates(_.values(o)),this._setCurrentState(o.IDLE),this._defineEventTransitions()},_defineEventTransitions:function(){this._defineTransition(o.IDLE,"AppStartNewWorkflow",function(e){this._setCurrentState(o.WAITING_FOR_WORKFLOW_STATUS),this._invokeController("AppListenForESAuthStatusChangeOp",e),this._invokeController("AppStartNewWorkflowOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppShowLandingPage",function(e){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_STATUS),this._invokeController("AppShowLandingPageOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppHideLandingPage",function(e){this._setCurrentState(o.WAITING_FOR_WORKFLOW_STATUS),this._invokeController("AppHideLandingPageOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"UserClickedBrowseFileDlg",function(e){this._setCurrentState(o.SHOWING_FILE_SELECTION_DIALOG),this._invokeController("AppNotifyWorkflowToShowBrowseFileDlgOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"UserClickedSendFilesBtn",function(e){e.appApi.networkConnectivityApi.isOnline()?this.options.appApi.rnaApi.done(_.bind(function(i){i.esApi.isAnySFSWorkflowsRunning().then(_.bind(function(i){i?(e.errorOptions={errorType:t.MultipleWorkflowsRunning,noResetApp:!0},this._setCurrentState(o.SHOWING_ERROR_MSG),this._invokeController("AppShowErrorMessageOp",e)):(this._setCurrentState(o.WAITING_FOR_WORKFLOW_STATUS),this._invokeController("AppNotifyLandingPageSuccess",e))},this))},this)):(i.sfsAppApi.handleNetworkDisconnectedEvent(),i.sfsAppApi.workflowApi.handleNetworkDisconnectedEvent(),i.sfsAppApi.subscriptionApi.handleNetworkDisconnectedEvent(),s.esApi.authApi.handleNetworkDisconnectedEvent())}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"UserClickedPrepareFormBtn",function(e){_.size(e.appSelectedFiles)>1?(e.errorOptions={errorType:t.PrepareFormsMultipleFilesSelect,noResetApp:!0},this._setCurrentState(o.SHOWING_ERROR_MSG),this._invokeController("AppShowErrorMessageOp",e)):this._invokeController("AppLaunchFormsAppOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"UserClickedRemoveFile",function(e){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_STATUS),this._invokeController("AppRemoveFileFromSelectedFileListOp",e),this._invokeController("AppNotifyFileSelectionToLandingPageOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"ErrorOccured",function(e){this._setCurrentState(o.WAITING_FOR_WORKFLOW_STATUS),this._invokeController("AppNotifyLandingPageErrorOp",e)}),this._defineTransition(o.SHOWING_FILE_SELECTION_DIALOG,"FilesAreSelected",function(e){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_STATUS),this._invokeController("AppNotifyFileSelectionToLandingPageOp",e)}),this._defineTransition(o.SHOWING_FILE_SELECTION_DIALOG,"FilesNotSelected",function(){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_STATUS)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppEvaluateESUserSubscription",function(e){this._setCurrentState(o.WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS),this._invokeController("AppEvaluateESUserSubscriptionOp",e)}),this._defineTransition(o.WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS,"AppESUserFoundPaid",function(e){this._setCurrentState(o.WAITING_FOR_WORKFLOW_STATUS),this._invokeController("AppNotifyESUserGotPaidSubscriptionOp",e)}),this._defineTransition(o.WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS,"AppESUserFoundFree",function(e){this._setCurrentState(o.WAITING_FOR_WORKFLOW_STATUS),this._invokeController("AppNotifyESUserGotFreeSubscriptionOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppUploadProgressEvent",function(e){this._invokeController("AppHandleUploadProgressEventOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"ESAuthSessionCreateSuccess",function(e){this._invokeController("ShowDummyProgressOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"ESAuthSessionInProgress",function(e){this._invokeController("ShowDummyProgressOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppWorkflowStatusEvent",function(e){this._invokeController("AppHandleWorkflowStatusEventOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppWorkflowSendPageEvent",function(e){this._invokeController("AppHandleWorkflowSendPageEventOp",e),e.send_page_status.isVisible&&this.options.appApi.siteCatalystApi.logScEvent([n.SEND_FOR_SIG,n.AUTHORING_PAGE,n.LOADED])}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppWorkflowSuccess",function(e){this._setCurrentState(o.IDLE),this._invokeController("AppUnListenForESAuthStatusChangeOp",e),this._invokeController("AppHandleWorkflowSuccessOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppWorkflowFailure",function(e){this._setCurrentState(o.IDLE),this._invokeController("HideDummyProgressOp",e),this._invokeController("AppUnListenForESAuthStatusChangeOp",e),this._invokeController("AppHandleWorkflowFailureOp",e),this._invokeController("RestartAppOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"AppAbortWorkflowEvent",function(e){this._invokeController("AppAbortWorkflowOp",e),this._setCurrentState(o.IDLE)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"ShowWaitCursor",function(e){this._invokeController("ShowWaitCursorOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"HideWaitCursor",function(e){this._invokeController("HideWaitCursorOp",e)}),this._defineTransition(o.WAITING_FOR_WORKFLOW_STATUS,"RestartApp",function(e){this._invokeController("RestartAppOp",e)}),this._defineTransition(this.SPECIAL_FSM_STATE,"AppSessionSignOut",function(e){this._setCurrentState(o.IDLE),this._invokeController("HideDummyProgressOp",e),this._invokeController("AppUnListenForESAuthStatusChangeOp",e),this._invokeController("RestartAppOp",e)}),this._defineTransition(this.SPECIAL_FSM_STATE,"AppShowErrorMessage",function(e){this._getCurrentState()!==o.SHOWING_NETWORK_OFFLINE_MODE&&(this._setCurrentState(o.SHOWING_ERROR_MSG),this._invokeController("AppShowErrorMessageOp",e)),this._invokeController("HideDummyProgressOp",e),this._invokeController("AppUnListenForESAuthStatusChangeOp",e)}),this._defineTransition(o.SHOWING_ERROR_MSG,"AppErrorDialogDismissed",function(e){this._invokeController("AppHideErrorMessageOp",e),e.errorOptions&&(e.errorOptions.noResetApp?this._setCurrentState(this._getPreviousState()):(this._invokeController("RestartAppOp",e),this._setCurrentState(o.IDLE)))}),this._defineTransition(this.SPECIAL_FSM_STATE,"AppNetworkDisconnectedEvent",function(e){var i=this._getCurrentState();i!==o.SHOWING_ERROR_MSG&&(this._setCurrentState(o.SHOWING_NETWORK_OFFLINE_MODE),this._invokeController("AppShowNetworkOfflineViewOp",e)),this._invokeController("HideDummyProgressOp",e),this._invokeController("AppUnListenForESAuthStatusChangeOp",e)}),this._defineTransition(o.SHOWING_NETWORK_OFFLINE_MODE,"AppOfflineViewDismissed",function(e){this._setCurrentState(o.IDLE),this._invokeController("AppHideNetworkOfflineViewOp",e),this._invokeController("RestartAppOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"CombineSelectedFilesEvent",function(e){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_STATUS),this._invokeController("SFSCombineFilesOp",e),this.options.appApi.displayApi.showSpinner(!1)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_STATUS,"CombineSelectedFilesEventFailed",function(e){e.errorOptions={errorType:t.CombineFilesFailed,noResetApp:!0,appErrorPromise:$.Deferred()},this._setCurrentState(o.SHOWING_ERROR_MSG),this._invokeController("AppShowErrorMessageOp",e)})}}),i.SFSAppFSM}),define("pdmplugins/send-for-sign/js/fsm/sfs-workflow-fsm",["core/ac-core","pdmplugins/esign/js/fsm/fsm","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-error-codes","pdmplugins/send-for-sign/js/constants/sfs-sc-constants","core/utils/util"],function(e,i,t,s,n){var o={IDLE:0,FETCHING_ACTIVE_DOCUMENT:1,WAITING_FOR_LANDING_PAGE_ACTION:2,VALIDATING_OPENED_FILE:3,VALIDATING_DLG_SELECTED_FILES:4,WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS:5,UPLOADING_ALL_FILES_TO_ECHOSIGN:6,FETCHING_PREPARE_FORMS_RECIPIENTS:7,FETCHING_SEND_FOR_SIGN_PAGE_URL_OP:8,OPENING_SEND_FOR_SIGN_PAGE_IN_APP:9,LISTENING_FOR_SEND_PAGE_EVENTS:10,CREATING_ES_AUTH_SESSION:11,FETCHING_MANAGE_AGREEMENTS_URL:12,CREATING_ES_AUTH_SESSION_FOR_MANAGE_URL:13,SHOWING_FILE_BROWSE_DLG:14,SHOWING_INVALID_FILES_ERROR_MSG:15,SHOWING_WORKFLOW_FAILURE_MSG:16};return t.SFSWorkflowFSM=i.extend({_initFSM:function(){this._setSupportedStates(_.values(o)),this._setCurrentState(o.IDLE),this._defineEventTransitions()},_defineEventTransitions:function(){this._defineTransition(o.IDLE,"StartWorkflow",function(e){var i=e.workflowUiModel;i.get("workflow_restarted_once")?(this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_ACTION),this._invokeController("ShowAppLandingPageOp",e)):(this._setCurrentState(o.FETCHING_ACTIVE_DOCUMENT),this._invokeController("FetchActiveDocumentOp",e))}),this._defineTransition(this.SPECIAL_FSM_STATE,"AbortWorkflow",function(e){this._setCurrentState(o.IDLE),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("NotifyWorkflowFailureOp",e)}),this._defineTransition(o.FETCHING_ACTIVE_DOCUMENT,"ActiveDocFound",function(e){e.filesToValidate=e.workflowSelectedFiles,this._setCurrentState(o.VALIDATING_OPENED_FILE),this._invokeController("ValidateSelectedFilesOp",e)}),this._defineTransition(o.VALIDATING_OPENED_FILE,"FilesValidationComplete",function(e){e.workflowSelectedFiles=e.validFiles,this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_ACTION),this._invokeController("ShowAppLandingPageOp",e)}),this._defineTransition(o.FETCHING_ACTIVE_DOCUMENT,"ActiveDocNotFound",function(e){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_ACTION),this._invokeController("ShowAppLandingPageOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_ACTION,"ShowFileBrowseDlg",function(e){this._setCurrentState(o.SHOWING_FILE_BROWSE_DLG),this._invokeController("ShowFileSelectionDlgOp",e)}),this._defineTransition(o.SHOWING_FILE_BROWSE_DLG,"FilesAreSelected",function(e){e.filesToValidate=e.dlgSelectedFiles,this._setCurrentState(o.VALIDATING_DLG_SELECTED_FILES),this._invokeController("ValidateSelectedFilesOp",e)}),this._defineTransition(o.SHOWING_FILE_BROWSE_DLG,"FilesNotSelected",function(e){this._invokeController("NotifyDlgFilesNotSelectedToClientsOp",e),this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_ACTION)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_ACTION,"FileSelectedInLandingPage",function(e){this._setCurrentState(o.WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS),this._invokeController("HideAppLandingPageOp",e),this._invokeController("SetSFSWorkflowInProgressOp",e),this._invokeController("CheckESUserSubscriptionOp",e)}),this._defineTransition(o.WAITING_FOR_LANDING_PAGE_ACTION,"ErrorOccuredInLandingPage",function(e){this._setCurrentState(o.IDLE),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("NotifyWorkflowFailureOp",e)}),this._defineTransition(o.VALIDATING_DLG_SELECTED_FILES,"FilesValidationComplete",function(e){var i=e.invalidFiles,t=e.validFiles;e.dlgSelectedFiles=t,_.isEmpty(e.dlgSelectedFiles)?this._invokeController("NotifyDlgFilesNotSelectedToClientsOp",e):this._invokeController("NotifyDlgFilesSelectedToClientsOp",e),_.isEmpty(i)?this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_ACTION):(e.errorOptions={errorType:i[0].errorCode,invalidFiles:i,multipleFiles:_.size(i)>1,noResetApp:!0},this._setCurrentState(o.SHOWING_INVALID_FILES_ERROR_MSG),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e))}),this._defineTransition(o.SHOWING_INVALID_FILES_ERROR_MSG,"ErrorDialogDismissed",function(e){this._setCurrentState(o.WAITING_FOR_LANDING_PAGE_ACTION),this._invokeController("ShowAppLandingPageOp",e)}),this._defineTransition(o.WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS,"ESUserFoundPaid",function(e){this._setCurrentState(o.CREATING_ES_AUTH_SESSION),this._invokeController("CreateESAuthSessionOp",e)}),this._defineTransition(o.CREATING_ES_AUTH_SESSION,"ESAuthSessionCreateSuccess",function(e){this._setCurrentState(o.UPLOADING_ALL_FILES_TO_ECHOSIGN),this._invokeController("CreateUploadRequestsQueueOp",e),this._invokeController("NotifyUploadStartedOp",e),this._invokeController("StartUploadRequestForAllFilesOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"BeginNextFileUpload",function(e){this._invokeController("UploadFileToEchoSignOp",e)}),this._defineTransition(o.CREATING_ES_AUTH_SESSION,"ESAuthSessionCreateFailure",function(e){this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG),this._invokeController("ClearSFSWorkflowInProgressOp",e),e.errorOptions={errorType:s.GeneralWorkflowError},this._invokeController("ShowWorkflowErrorMsgOp",e)}),this._defineTransition(o.SHOWING_WORKFLOW_FAILURE_MSG,"ErrorDialogDismissed",function(e){this._setCurrentState(o.IDLE),this._invokeController("NotifyWorkflowFailureOp",e)}),this._defineTransition(o.SHOWING_WORKFLOW_FAILURE_MSG,"ErrorDialogAlreadyShown",function(e){this._setCurrentState(o.IDLE),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("NotifyWorkflowFailureOp",e)}),this._defineTransition(o.WAITING_FOR_ES_USER_SUBSCRIPTION_STATUS,"ESUserFoundFree",function(e){this._setCurrentState(o.IDLE),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("NotifyWorkflowFailureOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"UploadStarted",function(e){this._invokeController("ListenForUploadProgressEventsOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"UploadFinished",function(e){this._invokeController("ProcessUploadFinishedResultOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"UploadQueued",function(e){this._setCurrentState(o.UPLOADING_ALL_FILES_TO_ECHOSIGN),this._invokeController("ListenForUploadProgressEventsOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"UploadProgress",function(e){this._setCurrentState(o.UPLOADING_ALL_FILES_TO_ECHOSIGN),this._invokeController("NotifyUploadProgressOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"UploadSuccess",function(e){this._invokeController("NotifyUploadSuccessOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"UploadFailure",function(e){var i=e.currentFileUploadReq,t=i.responseObj,n=t.respStatusCode,r=t.respBody,a=s.GeneralWorkflowError;try{r=JSON.parse(r)}catch(l){}403===n?"LARGE_FILE_SIZE"===r.code&&(a=s.LargeFileSize):401===n&&this._invokeController("ClearESAuthSessionOp",e),e.errorOptions={errorType:a},this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e),this._invokeController("NotifyUploadFailureOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"AbortWorkflow",function(e){this._setCurrentState(o.IDLE),this._invokeController("CancelUploadOp",e),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("NotifyWorkflowFailureOp",e)}),this._defineTransition(o.UPLOADING_ALL_FILES_TO_ECHOSIGN,"FetchPrepareFormRecipients",function(e){this._setCurrentState(o.FETCHING_PREPARE_FORMS_RECIPIENTS),this._invokeController("FetchPrepareFormRecipientsOp",e)}),this._defineTransition(o.FETCHING_PREPARE_FORMS_RECIPIENTS,"FetchSendForSignPageUrl",function(e){this._setCurrentState(o.FETCHING_SEND_FOR_SIGN_PAGE_URL_OP),this._invokeController("FetchSendForSignaturePageUrlOp",e)}),this._defineTransition(o.FETCHING_SEND_FOR_SIGN_PAGE_URL_OP,"SendUrlFetchSuccess",function(e){this._setCurrentState(o.OPENING_SEND_FOR_SIGN_PAGE_IN_APP),this._invokeController("NotifySendUrlFetchSuccessOp",e),this._invokeController("OpenSendForSignPageInAppOp",e)}),this._defineTransition(o.FETCHING_SEND_FOR_SIGN_PAGE_URL_OP,"SendUrlFetchFailure",function(e){this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG);var i=e.sendUrlFetchHttpCode,t=e.sendUrlFetchRespBody,n=s.GeneralWorkflowError;try{t=JSON.parse(t)}catch(r){}401===i&&("AUTOLOGIN_DENIED"===t.code&&(n=s.ESAutoLoginDenied),this._invokeController("ClearESAuthSessionOp",e)),e.errorOptions={errorType:n},this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e)}),this._defineTransition(o.OPENING_SEND_FOR_SIGN_PAGE_IN_APP,"OpenSendPageSuccess",function(e){this._setCurrentState(o.LISTENING_FOR_SEND_PAGE_EVENTS),this._invokeController("HandleOpenSendPageSuccessOp",e),this._invokeController("ListenForSendPageEventsOp",e)}),this._defineTransition(o.OPENING_SEND_FOR_SIGN_PAGE_IN_APP,"OpenSendPageFailure",function(e){this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG),e.errorOptions={errorType:s.GeneralWorkflowError},this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e)}),this._defineTransition(o.LISTENING_FOR_SEND_PAGE_EVENTS,"PostSendPageLoadEvent",function(e){this._invokeController("ClearSFSWorkflowInProgressOp",e)}),this._defineTransition(o.LISTENING_FOR_SEND_PAGE_EVENTS,"AuthoringSendPageLoadEvent",function(){}),this._defineTransition(this.SPECIAL_FSM_STATE,"PostSendPageLoadEvent",function(e){this._invokeController("HideWaitCursorOp",e),this._invokeController("ClearSFSWorkflowInProgressOp",e)}),this._defineTransition(o.LISTENING_FOR_SEND_PAGE_EVENTS,"PostSendPageClickEvent",function(e){var i=e.sendPageEventData,t=i.target;switch(t){case"MANAGE_LINK":this.options.appApi.siteCatalystApi.logScEvent([n.SEND_FOR_SIG,n.POST_SEND_PAGE,n.MANAGE,n.CLICKED]),e.agreementId=i.apiAgreementId,this._setCurrentState(o.CREATING_ES_AUTH_SESSION_FOR_MANAGE_URL),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWaitCursorOp",e),this._invokeController("CreateESAuthSessionOp",e);break;case"SEND_ANOTHER_LINK":this.options.appApi.siteCatalystApi.logScEvent([n.SEND_FOR_SIG,n.POST_SEND_PAGE,n.SEND_ANOTHER,n.CLICKED]),this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("RestartWorkflowOp",e)}}),this._defineTransition(o.LISTENING_FOR_SEND_PAGE_EVENTS,"SendPageSessionTimeOutEvent",function(e){var i=e.sendPageEventData,t=e.sendPageName;_.isUndefined(i)||("AUTHORING"!==t||"PRE_SESSION_TIMEOUT"!==i.message)&&("PRE_SESSION_TIMEOUT"===i.message||"POST_SESSION_TIMEOUT"===i.message)&&(this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG),e.errorOptions={errorType:s.SendPageSessionTimeOut},this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e))}),this._defineTransition(o.LISTENING_FOR_SEND_PAGE_EVENTS,"SendPageErrorEvent",function(e){this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG),e.errorOptions={errorType:s.GeneralWorkflowError,showOpaqueOverlay:!0},this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e)}),this._defineTransition(o.CREATING_ES_AUTH_SESSION_FOR_MANAGE_URL,"ESAuthSessionCreateSuccess",function(e){this._setCurrentState(o.FETCHING_MANAGE_AGREEMENTS_URL),this._invokeController("FetchManageAgreementsURLOp",e)}),this._defineTransition(o.CREATING_ES_AUTH_SESSION_FOR_MANAGE_URL,"ESAuthSessionCreateFailure",function(e){this._setCurrentState(o.LISTENING_FOR_SEND_PAGE_EVENTS),this._invokeController("HideWaitCursorOp",e)}),this._defineTransition(o.FETCHING_MANAGE_AGREEMENTS_URL,"FetchManageAgreementURLSuccess",function(e){this._setCurrentState(o.LISTENING_FOR_SEND_PAGE_EVENTS),this._invokeController("LaunchManageAgreementsURLOp",e),this._invokeController("HideWaitCursorOp",e)}),this._defineTransition(o.FETCHING_MANAGE_AGREEMENTS_URL,"FetchManageAgreementURLFailure",function(e){this._setCurrentState(o.SHOWING_WORKFLOW_FAILURE_MSG),this._invokeController("HideWaitCursorOp",e),e.errorOptions={errorType:s.GeneralWorkflowError},this._invokeController("ClearSFSWorkflowInProgressOp",e),this._invokeController("ShowWorkflowErrorMsgOp",e)}),this._defineTransition(this.SPECIAL_FSM_STATE,"SessionSignOut",function(e){this._setCurrentState(o.IDLE),this._invokeController("ClearSFSWorkflowInProgressOp",e),this.options.appApi.displayApi.showSpinner(!1)}),this._defineTransition(this.SPECIAL_FSM_STATE,"NetworkDisconnectedEvent",function(e){this._setCurrentState(o.IDLE),this._invokeController("ClearSFSWorkflowInProgressOp",e),this.options.appApi.displayApi.showSpinner(!1)})}}),t.SFSWorkflowFSM}),define("pdmplugins/send-for-sign/js/templates/sfs-error-body-template",[],function(){return"<div>  <div class='sfs-error-body-heading'></div>  <div class='sfs-error-body-content'></div></div>"}),define("pdmplugins/send-for-sign/js/fsm/sfs-error-fsm",["pdmplugins/esign/js/fsm/fsm","pdmplugins/send-for-sign/js/ac-send-for-sign","i18n!pdmplugins/send-for-sign/js/nls/ui-strings","pdmplugins/send-for-sign/js/templates/sfs-error-body-template","pdmplugins/send-for-sign/js/constants/sfs-error-codes"],function(e,i,t,s,n){var o={IDLE:0,SHOWING_GENERIC_ERROR_DIALOG:1};return i.SFSErrorFSM=e.extend({_initFSM:function(){this._setSupportedStates(_.values(o)),this._setCurrentState(o.IDLE),this._defineEventTransitions()},_defineEventTransitions:function(){this._defineTransition(o.IDLE,n.PDFIsPortfolio,function(e){this._handleInvalidFileTypeErrorEvent(e)}),this._defineTransition(o.IDLE,n.PDFIsPasswordProtected,function(e){this._handleInvalidFileTypeErrorEvent(e)
}),this._defineTransition(o.IDLE,n.PDFIsCertificateProtected,function(e){this._handleInvalidFileTypeErrorEvent(e)}),this._defineTransition(o.IDLE,n.PDFIsPolicyProtected,function(e){this._handleInvalidFileTypeErrorEvent(e)}),this._defineTransition(o.IDLE,n.PDFIsDynamicXFA,function(e){this._handleInvalidFileTypeErrorEvent(e)}),this._defineTransition(o.IDLE,n.PDFIsOfInvalidType,function(e){this._handleInvalidFileTypeErrorEvent(e)}),this._defineTransition(o.IDLE,n.InvalidFileExtn,function(e){this._handleInvalidFileTypeErrorEvent(e)}),this._defineTransition(o.IDLE,n.GeneralWorkflowError,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_GENERIC_TITLE,errorBodyTitle:t.SFS_ERR_GENERAL_WORKFLOW_FAILURE,closeLabel:t.SFS_ERR_CLOSE_BTN})}),this._defineTransition(o.IDLE,n.LargeFileSize,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_GENERIC_TITLE,errorBodyTitle:t.SFS_ERR_LARGE_FILE_SIZE,closeLabel:t.SFS_ERR_CLOSE_BTN})}),this._defineTransition(o.IDLE,n.ESAutoLoginDenied,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_GENERIC_TITLE,errorBodyTitle:t.SFS_ERR_ES_AUTO_LOGIN_DENIED,closeLabel:t.SFS_ERR_CLOSE_BTN})}),this._defineTransition(o.IDLE,n.SendPageSessionTimeOut,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_TIMEOUT_TITLE,errorBodyTitle:t.SFS_ERR_CONTENT_TIMEOUT_TITLE,errorBodyContent:t.SFS_ERR_CONTENT_TIMEOUT_BODY,closeLabel:t.SFS_ERR_CLOSE_BTN,width:650})}),this._defineTransition(o.IDLE,n.EnterpriseServiceAccessDenied,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_GENERIC_TITLE,errorBodyTitle:t.SFS_ERR_ENTERPRISE_SERVICE_ACCS_DENIED,closeLabel:t.SFS_ERR_CLOSE_BTN})}),this._defineTransition(o.IDLE,n.PrepareFormsMultipleFilesSelect,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_GENERIC_TITLE,errorBodyTitle:t.SFS_ERR_PREPARE_FORM_MUL_FILES_SEL,closeLabel:t.SFS_ERR_CLOSE_BTN})}),this._defineTransition(o.IDLE,n.MultipleWorkflowsRunning,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_FILE_NOT_SENT,errorBodyTitle:t.SFS_MULTIPLE_WORKFLOWS_DENIED,closeLabel:t.SFS_ERR_OK_BUTTON})}),this._defineTransition(o.IDLE,n.CombineFilesFailed,function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_FILES_NOT_COMBINED_ERROR_TITLE,errorBodyTitle:t.SFS_FILES_NOT_COMBINED_ERROR,closeLabel:t.SFS_ERR_OK_BUTTON})}),this._defineTransition(this.SPECIAL_FSM_STATE,"HideErrorDialog",function(e){this._setCurrentState(o.IDLE),this._invokeController("HideGenericErrorDialogOp",e)})},_handleErrorEvent:function(e,i){var t=this._prepareErrorContentTitle(e,i.errorBodyTitle,i.errorBodyTitle_N),s=this._prepareErrorContentBody(e,i.errorBodyContent);e.titleTag=i.errorTitle,e.bodyTag=this._createErrorBodyTag(t,s),e.closeTag=i.closeLabel,e.width=i.width,e.height=i.height,this._setCurrentState(o.SHOWING_GENERIC_ERROR_DIALOG),this._invokeController("ShowGenericErrorDialogOp",e)},_handleInvalidFileTypeErrorEvent:function(e){this._handleErrorEvent(e,{errorTitle:t.SFS_ERR_GENERIC_TITLE,errorBodyTitle:t.SFS_ERR_CONTENT_TITLE_UNSUPPORTED,errorBodyTitle_N:t.SFS_ERR_CONTENT_TITLE_UNSUPPORTED_N,errorBodyContent:t.SFS_ERR_CONTENT_BODY_UNSUPPORTED,closeLabel:t.SFS_ERR_CLOSE_BTN})},_cheapTruncate:function(e,i){return e.length>i-5&&(i-=5,e=e.substr(0,i/2)+" ... "+e.substr(e.length-i/2)),e},_createErrorBodyTag:function(e,i){var t,n,o=$(_.template(s,{}));return t=o.find(".sfs-error-body-heading"),n=o.find(".sfs-error-body-content"),_.isEmpty(e)?t.addClass("hidden"):t.html(e),_.isEmpty(i)?n.addClass("hidden"):n.html(i),o[0].outerHTML},_prepareFileListDisplayString:function(e){var i,t=0,s="";return t=_.size(e),_.each(e,_.bind(function(e,n){i=e.file.get("name"),i=this._cheapTruncate(i,30),s+=i,t-1>n&&(s+=", ")},this)),s},_prepareErrorContentTitle:function(e,i,t){var s="",n="",o=i;return _.size(e.invalidFiles)>1&&(_.isEmpty(t)||(o=t)),n=this._prepareFileListDisplayString(e.invalidFiles),_.isUndefined(o)||(s=_.template(o,{name:n})),s},_prepareErrorContentBody:function(e,i){var t="",s="";return s=this._prepareFileListDisplayString(e.invalidFiles),_.isUndefined(i)||(t=_.template(i,{name:s})),t}}),i.SFSErrorFSM}),define("pdmplugins/send-for-sign/js/fsm/sfs-subscription-fsm",["core/ac-core","pdmplugins/esign/js/fsm/fsm","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/constants/sfs-error-codes"],function(e,i,t,s){var n={IDLE:0,EVALUATING_IMS_USER_LOGIN_STATUS:1,CHECKING_FOR_ES_USER_LOGIN_STATUS:2,FETCHING_ES_USER_SUBSCRIPTION_STATUS:3,SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN:4,SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN:5,WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE:6,SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN_AND_UPGRADE_CLICKED:7,CHECKING_FOR_ENTERPRISE_ACCOUNT_TYPE:8,SHOWING_SUBSCRIPTION_ERR_MSG:9,UPDATING_IMS_AUTH_SESSION_OP:10};return t.SFSSubscriptionFSM=i.extend({_initFSM:function(){this._setSupportedStates(_.values(n)),this._setCurrentState(n.IDLE),this._defineEventTransitions()},_defineEventTransitions:function(){this._defineTransition(n.IDLE,"EvaluateSubscriptionStatus",function(e){this._setCurrentState(n.EVALUATING_IMS_USER_LOGIN_STATUS),this._invokeController("ShowWaitCursorOp",e),this._invokeController("EvaluateIMSUserLoginStatusOp",e)}),this._defineTransition(n.EVALUATING_IMS_USER_LOGIN_STATUS,"IMSUserSignedIn",function(e){this._setCurrentState(n.UPDATING_IMS_AUTH_SESSION_OP),this._invokeController("UpdateIMSAuthSessionOp",e)}),this._defineTransition(n.UPDATING_IMS_AUTH_SESSION_OP,"IMSSessionUpdateSuccess",function(e){this._setCurrentState(n.FETCHING_ES_USER_SUBSCRIPTION_STATUS),this._invokeController("FetchESUserSubscriptionStatusOp",e)}),this._defineTransition(n.UPDATING_IMS_AUTH_SESSION_OP,"IMSSessionUpdateFailure",function(e){this._setCurrentState(n.IDLE),this._invokeController("HideWaitCursorOp",e),this._invokeController("NotifyESUserGotFreeSubscriptionOp",e)}),this._defineTransition(n.EVALUATING_IMS_USER_LOGIN_STATUS,"IMSUserNotSignedIn",function(e){this._invokeController("HideWaitCursorOp",e),this._setCurrentState(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN),this._invokeController("ShowSubscribePageESUserNotSignedInOp",e),this._invokeController("ClearSFSWorkflowInProgressOp",e)}),this._defineTransition(n.FETCHING_ES_USER_SUBSCRIPTION_STATUS,"ESUserFoundFree",function(e){this._setCurrentState(n.CHECKING_FOR_ENTERPRISE_ACCOUNT_TYPE),this._invokeController("CheckIfUserOfEnterpriseTypeOp",e),this._invokeController("ClearSFSWorkflowInProgressOp",e)}),this._defineTransition(n.FETCHING_ES_USER_SUBSCRIPTION_STATUS,"ESUserFoundPaid",function(e){this._setCurrentState(n.IDLE),this._invokeController("HideWaitCursorOp",e),this._invokeController("NotifyESUserGotPaidSubscriptionOp",e)}),this._defineTransition(n.FETCHING_ES_USER_SUBSCRIPTION_STATUS,"ESSubscriptionError",function(e){this._setCurrentState(n.IDLE),this._invokeController("HideWaitCursorOp",e),this._invokeController("NotifyESUserGotFreeSubscriptionOp",e)}),this._defineTransition(n.CHECKING_FOR_ENTERPRISE_ACCOUNT_TYPE,"EnterpriseUser",function(e){this._invokeController("HideWaitCursorOp",e),this._setCurrentState(n.SHOWING_SUBSCRIPTION_ERR_MSG),e.errorOptions={errorType:s.EnterpriseServiceAccessDenied},this._invokeController("ShowSubscriptionErrorMsgOp",e)}),this._defineTransition(n.CHECKING_FOR_ENTERPRISE_ACCOUNT_TYPE,"NotAnEnterpriseUser",function(e){this._invokeController("HideWaitCursorOp",e),this._setCurrentState(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN),this._invokeController("ShowSubscribePageESUserSignedInOp",e)}),this._defineTransition(n.SHOWING_SUBSCRIPTION_ERR_MSG,"ErrorDialogDismissed",function(e){this._setCurrentState(n.IDLE),this._invokeController("NotifyESUserGotFreeSubscriptionOp",e)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN,"UserClickedCancel",function(e){this._setCurrentState(n.IDLE),this._invokeController("NotifyESUserGotFreeSubscriptionOp",e)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN,"UserClickedUpgradeNow",function(e){this._setCurrentState(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN_AND_UPGRADE_CLICKED),this._invokeController("LaunchSubscribeWebPageOp",e),this._invokeController("ShowSubscribePageESUserSignedInAndUpgradeClickedOp",e)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN,"UserClickedCancel",function(e){this._setCurrentState(n.IDLE),this._invokeController("NotifyESUserGotFreeSubscriptionOp",e)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN,"UserClickedUpgradeNow",function(e){this._setCurrentState(n.WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE),this.options.appApi.rnaApi.done(_.bind(function(i){0==i.rnaServicesAPI.isSFSUpsellExperimentEnabled()&&this._invokeController("LaunchSubscribeWebPageOp",e)},this)),this._invokeController("CreateIMSAuthSessionOp",e)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN,"UserClickedSignIn",function(e){this._setCurrentState(n.WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE),this.options.appApi.rnaApi.done(_.bind(function(i){1==i.rnaServicesAPI.isSFSUpsellExperimentEnabled()&&this._invokeController("LaunchSubscribeWebPageOp",e)},this)),this._invokeController("CreateIMSAuthSessionOp",e)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN,"SessionSignOut",function(){this._setCurrentState(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN)}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN,"SessionSignedIn",function(){}),this._defineTransition(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_SIGNED_IN_AND_UPGRADE_CLICKED,"UserClickedStartNow",function(e){this._invokeController("ShowWaitCursorOp",e),this._setCurrentState(n.FETCHING_ES_USER_SUBSCRIPTION_STATUS),this._invokeController("FetchESUserSubscriptionStatusOp",e)}),this._defineTransition(n.WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE,"SessionSignedIn",function(e){this._setCurrentState(n.WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE),this._invokeController("ShowWaitCursorOp",e)}),this._defineTransition(n.WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE,"IMSAuthSessionCreateSuccess",function(e){this._setCurrentState(n.FETCHING_ES_USER_SUBSCRIPTION_STATUS),this._invokeController("FetchESUserSubscriptionStatusOp",e)}),this._defineTransition(n.WAITING_FOR_IMS_AUTH_SESSION_TO_CREATE,"IMSAuthSessionCreateFailure",function(e){this._setCurrentState(n.SHOWING_ES_SUBSCRIBE_PAGE_USER_NOT_SIGNED_IN),this._invokeController("ShowSubscribePageESUserNotSignedInOp",e)}),this._defineTransition(this.SPECIAL_FSM_STATE,"SessionSignOut",function(e){this._setCurrentState(n.IDLE),this._invokeController("HideWaitCursorOp",e)}),this._defineTransition(this.SPECIAL_FSM_STATE,"NetworkDisconnectedEvent",function(e){this._setCurrentState(n.IDLE),this._invokeController("HideWaitCursorOp",e)})}}),t.SFSSubscriptionFSM}),define("pdmplugins/send-for-sign/js/fsm/fsm-factory",["core/ac-core","pdmplugins/esign/js/fsm/fsm","pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/fsm/sfs-app-fsm","pdmplugins/send-for-sign/js/fsm/sfs-workflow-fsm","pdmplugins/send-for-sign/js/fsm/sfs-error-fsm","pdmplugins/send-for-sign/js/fsm/sfs-subscription-fsm"],function(e,i,t){return t.FSMFactory=i.extend({create:function(e,i){var s=t[e];return s?new s(i):void LOG(0,"AcCore.OpFactory.create: Unrecognized class: "+e)}}),t.FSMFactory}),define("pdmplugins/send-for-sign/js/models/ui/sfs-workflow-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){i.SFSWorkflowUiModel=e.UiModel.extend({recognized:{workflow_id:{type:"string",optional:!0},workfow_status:{type:"object",optional:!0},send_page_status:{type:"object",optional:!0},upload_req_queue:{type:"array",optional:!0},workflow_restarted_once:{type:"array",optional:!0}},defaults:{workflow_id:"",workfow_status:{},send_page_status:{},upload_req_queue:[]}})}),define("pdmplugins/send-for-sign/js/models/ui/sfs-app-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){var t=!1;i.SFSAppUiModel=e.UiModel.extend({recognized:{network_connected:{type:"boolean",optional:!0},user_signed_in:{type:"boolean",optional:!0},app_state_updated:{type:"boolean",optional:!0},workflow_ui_model:{type:"object",optional:!0},wait_cursor_visible:{type:"boolean",optional:!0},restart_app:{type:"boolean",optional:!0},mode_type:{type:"string",optional:!0}},defaults:{network_connected:!0,user_signed_in:!1,app_state_updated:!1,workflow_ui_model:{},restart_app:!1},isSendPageVisible:function(){var e=this.get("workflow_ui_model"),i=e.get("send_page_status");return i.isVisible===!0&&!_.isEmpty(i.url)},notifyAppStateChange:function(){this.set("app_state_updated",!1,{silent:!0}),this.set("app_state_updated",!0)},areMultipleFilesSelected:function(){var e=this.get("workflow_ui_model"),i=e.get("upload_req_queue");return!(_.isEmpty(i)&&i.length>1)},setAppWorkflowRestartedOnce:function(e){t=e},hasAppWorkflowRestartedOnce:function(){return t},canRunInUIMode:function(){return _.isEmpty(this.get("mode_type"))}})}),define("pdmplugins/send-for-sign/js/models/ui/sfs-app-progress-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){i.SFSAppUploadProgressUiModel=e.UiModel.extend({recognized:{is_visible:{type:"boolean",optional:!0},dummy_progress_fraction:{type:"boolean",optional:!0},doc_upload_progress_fraction:{type:"number",optional:!0},send_page_url_fetch_progress_fraction:{type:"number",optional:!0},send_page_load_progress_fraction:{type:"number",optional:!0},upload_progress_percentage:{type:"number",optional:!0},send_page_url_fetch_percentage:{type:"number",optional:!0},send_page_load_percentage:{type:"number",optional:!0},max_dummy_percentage:{type:"number",optional:!0},dummy_progress_incr:{type:"number",optional:!0},abort_progress:{type:"boolean",optional:!0}},defaults:{doc_upload_progress_fraction:.6,send_page_url_fetch_progress_fraction:.1,send_page_load_progress_fraction:.3,is_visible:!1,upload_progress_percentage:0,send_page_url_fetch_percentage:0,send_page_load_percentage:0,max_dummy_percentage:30,dummy_progress_incr:10,abort_progress:!1},setProgressName:function(e){"send_page_url_fetch"===e?(this.set("auth_progress_percentage",100),this.set("upload_progress_percentage",100)):"send_page_load"===e&&(this.set("auth_progress_percentage",100),this.set("upload_progress_percentage",100),this.set("send_page_url_fetch_percentage",100))},getTotalProgressPercentage:function(){return this.get("doc_upload_progress_fraction")*this.get("upload_progress_percentage")+this.get("send_page_url_fetch_progress_fraction")*this.get("send_page_url_fetch_percentage")+this.get("send_page_load_progress_fraction")*this.get("send_page_load_percentage")}})}),define("pdmplugins/send-for-sign/js/models/ui/sfs-app-send-page-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){i.SFSAppSendPageUiModel=e.UiModel.extend({recognized:{url:{type:"string",optional:!0},is_visible:{type:"boolean",optional:!0},is_loaded:{type:"boolean",optional:!0}},defaults:{url:"",is_visible:!1,is_loaded:!1}})}),define("pdmplugins/send-for-sign/js/models/ui/sfs-app-landing-page-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){i.SFSAppLandingPageUiModel=e.UiModel.extend({recognized:{is_visible:{type:"boolean",optional:!0},is_refreshed:{type:"boolean",optional:!0},user_action:{type:"string",optional:!0},selected_files:{type:"array",optional:!0},user_removed_file:{type:"object",optional:!0},file_collection_visible:{type:"boolean",optional:!0},app_info_txt_visible:{type:"boolean",optional:!0},app_info_txt1:{type:"string",optional:!0},app_info_txt2:{type:"string",optional:!0},app_info_txt3:{type:"string",optional:!0},action_btn1_visible:{type:"boolean",optional:!0},action_btn2_visible:{type:"boolean",optional:!0},action_btn1_enabled:{type:"boolean",optional:!0},action_btn2_enabled:{type:"boolean",optional:!0},action_btn1_label:{type:"string",optional:!0},action_btn2_label:{type:"string",optional:!0},action_btn_descr_visible:{type:"boolean",optional:!0},action_btn1_descr_txt:{type:"string",optional:!0},action_btn2_descr_txt:{type:"string",optional:!0},action_btn_separator_label:{type:"string",optional:!0},enable_autocomplete:{type:"boolean",optional:!1},enable_autoc_arrows:{type:"boolean",optional:!1},autocomplete_local_contacts_imported:{type:"boolean",optional:!1},autocomplete_scroll:{type:"boolean",optional:!1},autocomplete_eventual_click:{type:"boolean",optional:!1},autocomplete_immediate_click:{type:"boolean",optional:!1},autocomplete_avoided:{type:"boolean",optional:!1},showSFSNewLandingPage:{type:"boolean",optional:!0},decidedWhichPageToShow:{type:"boolean",optional:!0}},defaults:{is_visible:!1,user_action:"",selected_files:[],user_removed_file:{},action_btn1_enabled:!0,action_btn2_enabled:!0,action_btn1_visible:!0,enable_autocomplete:!0,enable_autoc_arrows:!0,autocomplete_local_contacts_imported:!1,autocomplete_scroll:!1,autocomplete_eventual_click:!1,autocomplete_immediate_click:!1,autocomplete_avoided:!1,showSFSNewLandingPage:!0,decidedWhichPageToShow:!1},clearLastUserAction:function(){this.set("user_action","",{silent:!0})},clearLastRefreshState:function(){this.set("is_refreshed","",{silent:!0})},resetTodefaults:function(){this.set({enable_autocomplete:!0,enable_autoc_arrows:!0,autocomplete_local_contacts_imported:!1,showSFSNewLandingPage:!0,decidedWhichPageToShow:!1}),this.set("user_removed_file",{},{silent:!0}),this.set("selected_files",[],{silent:!0}),this.resetAutocomplete()},resetAutocomplete:function(){this.set({autocomplete_avoided:!1,autocomplete_scroll:!1,autocomplete_immediate_click:!1,autocomplete_eventual_click:!1})}})}),define("pdmplugins/send-for-sign/js/models/ui/sfs-es-web-page-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){i.SFSEchoSignWebPageUiModel=e.UiModel.extend({recognized:{eventData:{type:"object",optional:!0}},defaults:{eventData:{}},clearLastEventState:function(){this.set("eventData",{},{silent:!0})}})}),define("pdmplugins/send-for-sign/js/models/ui/sfs-subscribe-ui-model",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign"],function(e,i){return i.SFSSubscribeUiModel=e.UiModel.extend({recognized:{close:{type:"boolean",optional:!0},visible_btn_name:{type:"string",optional:!0},user_action:{type:"string",optional:!0},cancel_clicked:{type:"boolean",optional:!0},upgrade_clicked:{type:"boolean",optional:!0},sign_in_clicked:{type:"boolean",optional:!0},wait_cursor_visible:{type:"boolean",optional:!0}},defaults:{user_action:"",visible_btn_name:"",cancel_clicked:!1,upgrade_clicked:!1,sign_in_clicked:!1},reset:function(){this.set({user_action:"",visible_btn_name:"",cancel_clicked:!1,upgrade_clicked:!1,sign_in_clicked:!1})}}),i.SFSSubscribeUiModel}),define("pdmplugins/send-for-sign/js/models/ui/ui-model-factory",["core/ac-core","pdmplugins/send-for-sign/js/ac-send-for-sign","core/models/model","pdmplugins/send-for-sign/js/models/ui/sfs-workflow-ui-model","pdmplugins/send-for-sign/js/models/ui/sfs-app-ui-model","pdmplugins/send-for-sign/js/models/ui/sfs-app-progress-ui-model","pdmplugins/send-for-sign/js/models/ui/sfs-app-send-page-ui-model","pdmplugins/send-for-sign/js/models/ui/sfs-app-landing-page-ui-model","pdmplugins/send-for-sign/js/models/ui/sfs-es-web-page-ui-model","pdmplugins/send-for-sign/js/models/ui/sfs-subscribe-ui-model"],function(e,i){return i.UiModelFactory=e.Model.extend({create:function(e,t,s){var n=i[e];return n?new n(t,s):void LOG(0,"AcSendForSign.UiModelFactory.create: Unrecognized class: "+e)}}),i.UiModelFactory}),define("pdmplugins/send-for-sign/js/send-for-sign",["pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/esign/js/ac-esign-init","pdmplugins/send-for-sign/js/views/plugin-view","pdmplugins/send-for-sign/js/ops/op-factory","pdmplugins/send-for-sign/js/fsm/fsm-factory","pdmplugins/send-for-sign/js/models/ui/ui-model-factory"],function(e){_.extend(e,{init:function(){e.opFactory=new e.OpFactory,e.fsmFactory=new e.FSMFactory,e.uiModelFactory=new e.UiModelFactory}})}),define("pdmplugins/send-for-sign/js/plugin",["pdmplugins/send-for-sign/js/ac-send-for-sign","pdmplugins/send-for-sign/js/send-for-sign"],function(e){e.init()});